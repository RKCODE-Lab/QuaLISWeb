{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getWidgetsForFieldOp = exports.getWidgetForFieldOp = exports.getValueSourcesForFieldOp = exports.getValueLabel = exports.getOperatorsForField = exports.getNewValueForFieldOp = exports.getFuncPathLabels = exports.getFirstOperator = exports.getFirstField = exports.getFieldPathLabels = exports.getFieldPath = exports.getFieldPartsConfigs = exports.formatFieldName = exports.filterValueSourcesForField = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _configUtils = require(\"./configUtils\");\n\nvar _stuff = require(\"../utils/stuff\");\n\nvar _immutable = _interopRequireDefault(require(\"immutable\"));\n\nvar _validation = require(\"../utils/validation\");\n\nvar _last = _interopRequireDefault(require(\"lodash/last\"));\n\nvar selectTypes = [\"select\", \"multiselect\", \"treeselect\", \"treemultiselect\"];\n/**\n * @param {object} config\n * @param {object} oldConfig\n * @param {Immutable.Map} current\n * @param {string} newField\n * @param {string} newOperator\n * @param {string} changedProp\n * @return {object} - {canReuseValue, newValue, newValueSrc, newValueType, newValueError}\n */\n\nvar getNewValueForFieldOp = function getNewValueForFieldOp(config) {\n  var oldConfig = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var current = arguments.length > 2 ? arguments[2] : undefined;\n  var newField = arguments.length > 3 ? arguments[3] : undefined;\n  var newOperator = arguments.length > 4 ? arguments[4] : undefined;\n  var changedProp = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;\n  var canFix = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : true;\n  if (!oldConfig) oldConfig = config;\n  var currentField = current.get(\"field\");\n  var currentOperator = current.get(\"operator\");\n  var currentValue = current.get(\"value\");\n  var currentValueSrc = current.get(\"valueSrc\", new _immutable[\"default\"].List());\n  var currentValueType = current.get(\"valueType\", new _immutable[\"default\"].List());\n  var currentAsyncListValues = current.get(\"asyncListValues\"); //const isValidatingTree = (changedProp === null);\n\n  var _config$settings = config.settings,\n      convertableWidgets = _config$settings.convertableWidgets,\n      clearValueOnChangeField = _config$settings.clearValueOnChangeField,\n      clearValueOnChangeOp = _config$settings.clearValueOnChangeOp,\n      showErrorMessage = _config$settings.showErrorMessage; //const currentOperatorConfig = getOperatorConfig(oldConfig, currentOperator, currentField);\n\n  var newOperatorConfig = (0, _configUtils.getOperatorConfig)(config, newOperator, newField); //const currentOperatorCardinality = currentOperator ? defaultValue(currentOperatorConfig.cardinality, 1) : null;\n\n  var operatorCardinality = newOperator ? (0, _stuff.defaultValue)(newOperatorConfig.cardinality, 1) : null;\n  var currentFieldConfig = (0, _configUtils.getFieldConfig)(oldConfig, currentField);\n  var newFieldConfig = (0, _configUtils.getFieldConfig)(config, newField);\n  var canReuseValue = currentField && currentOperator && newOperator && currentValue != undefined && (!changedProp || changedProp == \"field\" && !clearValueOnChangeField || changedProp == \"operator\" && !clearValueOnChangeOp) && currentFieldConfig && newFieldConfig && currentFieldConfig.type == newFieldConfig.type;\n\n  if (canReuseValue && selectTypes.includes(currentFieldConfig.type) && changedProp == \"field\") {\n    // different fields of select types has different listValues\n    canReuseValue = false;\n  } // compare old & new widgets\n\n\n  for (var i = 0; i < operatorCardinality; i++) {\n    var vs = currentValueSrc.get(i) || null;\n    var currentWidget = getWidgetForFieldOp(oldConfig, currentField, currentOperator, vs);\n    var newWidget = getWidgetForFieldOp(config, newField, newOperator, vs); // need to also check value widgets if we changed operator and current value source was 'field'\n    // cause for select type op '=' requires single value and op 'in' requires array value\n\n    var currentValueWidget = vs == \"value\" ? currentWidget : getWidgetForFieldOp(oldConfig, currentField, currentOperator, \"value\");\n    var newValueWidget = vs == \"value\" ? newWidget : getWidgetForFieldOp(config, newField, newOperator, \"value\");\n    var canReuseWidget = newValueWidget == currentValueWidget || (convertableWidgets[currentValueWidget] || []).includes(newValueWidget);\n    if (!canReuseWidget) canReuseValue = false;\n  }\n\n  if (currentOperator != newOperator && [currentOperator, newOperator].includes(\"proximity\")) canReuseValue = false;\n  var firstWidgetConfig = (0, _configUtils.getFieldWidgetConfig)(config, newField, newOperator, null, currentValueSrc.first());\n  var valueSources = getValueSourcesForFieldOp(config, newField, newOperator);\n  var valueFixes = {};\n  var valueErrors = Array.from({\n    length: operatorCardinality\n  }, function () {\n    return null;\n  });\n\n  if (canReuseValue) {\n    var _loop = function _loop(_i) {\n      var v = currentValue.get(_i);\n      var vType = currentValueType.get(_i) || null;\n      var vSrc = currentValueSrc.get(_i) || null;\n      var isValidSrc = valueSources.find(function (v) {\n        return v == vSrc;\n      }) != null;\n      if (!isValidSrc && _i > 0 && vSrc == null) isValidSrc = true; // make exception for range widgets (when changing op from '==' to 'between')\n\n      var isEndValue = !canFix;\n      var asyncListValues = currentAsyncListValues;\n\n      var _validateValue = (0, _validation.validateValue)(config, newField, newField, newOperator, v, vType, vSrc, asyncListValues, canFix, isEndValue),\n          _validateValue2 = (0, _slicedToArray2[\"default\"])(_validateValue, 2),\n          validateError = _validateValue2[0],\n          fixedValue = _validateValue2[1];\n\n      var isValid = !validateError;\n\n      if (!isValid && showErrorMessage && changedProp != \"field\") {\n        // allow bad value\n        // but not on field change - in that case just drop bad value that can't be reused\n        // ? maybe we should also drop bad value on op change?\n        valueErrors[_i] = validateError;\n      } else if (!isValidSrc || !isValid) {\n        canReuseValue = false;\n        return \"break\";\n      } else if (canFix && fixedValue !== v) {\n        valueFixes[_i] = fixedValue;\n      }\n    };\n\n    for (var _i = 0; _i < operatorCardinality; _i++) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  } // reuse value OR get defaultValue for cardinality 1 (it means default range values is not supported yet, todo)\n\n\n  var newValue = null,\n      newValueSrc = null,\n      newValueType = null,\n      newValueError = null;\n  newValue = new _immutable[\"default\"].List(Array.from({\n    length: operatorCardinality\n  }, function (_ignore, i) {\n    var v = undefined;\n\n    if (canReuseValue) {\n      if (i < currentValue.size) {\n        v = currentValue.get(i);\n\n        if (valueFixes[i] !== undefined) {\n          v = valueFixes[i];\n        }\n      }\n    } else if (operatorCardinality == 1) {\n      var _newFieldConfig$field;\n\n      v = (0, _stuff.getFirstDefined)([newFieldConfig === null || newFieldConfig === void 0 ? void 0 : newFieldConfig.defaultValue, newFieldConfig === null || newFieldConfig === void 0 ? void 0 : (_newFieldConfig$field = newFieldConfig.fieldSettings) === null || _newFieldConfig$field === void 0 ? void 0 : _newFieldConfig$field.defaultValue, firstWidgetConfig === null || firstWidgetConfig === void 0 ? void 0 : firstWidgetConfig.defaultValue]);\n    }\n\n    return v;\n  }));\n  newValueSrc = new _immutable[\"default\"].List(Array.from({\n    length: operatorCardinality\n  }, function (_ignore, i) {\n    var vs = null;\n\n    if (canReuseValue) {\n      if (i < currentValueSrc.size) vs = currentValueSrc.get(i);\n    } else if (valueSources.length == 1) {\n      vs = valueSources[0];\n    } else if (valueSources.length > 1) {\n      vs = valueSources[0];\n    }\n\n    return vs;\n  }));\n\n  if (showErrorMessage) {\n    if (newOperatorConfig && newOperatorConfig.validateValues && newValueSrc.toJS().filter(function (vs) {\n      return vs == \"value\" || vs == null;\n    }).length == operatorCardinality) {\n      // last element in `valueError` list is for range validation error\n      var jsValues = firstWidgetConfig && firstWidgetConfig.toJS ? newValue.toJS().map(function (v) {\n        return firstWidgetConfig.toJS(v, firstWidgetConfig);\n      }) : newValue.toJS();\n      var rangeValidateError = newOperatorConfig.validateValues(jsValues);\n\n      if (showErrorMessage) {\n        valueErrors.push(rangeValidateError);\n      }\n    }\n\n    newValueError = new _immutable[\"default\"].List(valueErrors);\n  }\n\n  newValueType = new _immutable[\"default\"].List(Array.from({\n    length: operatorCardinality\n  }, function (_ignore, i) {\n    var vt = null;\n\n    if (canReuseValue) {\n      if (i < currentValueType.size) vt = currentValueType.get(i);\n    } else if (operatorCardinality == 1 && firstWidgetConfig && firstWidgetConfig.type !== undefined) {\n      vt = firstWidgetConfig.type;\n    } else if (operatorCardinality == 1 && newFieldConfig && newFieldConfig.type !== undefined) {\n      vt = newFieldConfig.type == \"!group\" ? \"number\" : newFieldConfig.type;\n    }\n\n    return vt;\n  }));\n  return {\n    canReuseValue: canReuseValue,\n    newValue: newValue,\n    newValueSrc: newValueSrc,\n    newValueType: newValueType,\n    newValueError: newValueError,\n    operatorCardinality: operatorCardinality\n  };\n};\n\nexports.getNewValueForFieldOp = getNewValueForFieldOp;\n\nvar getFirstField = function getFirstField(config) {\n  var parentRuleGroupPath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parentPathArr = typeof parentRuleGroupPath == \"string\" ? parentRuleGroupPath.split(fieldSeparator) : parentRuleGroupPath;\n  var parentField = parentRuleGroupPath ? (0, _configUtils.getFieldRawConfig)(config, parentRuleGroupPath) : config;\n  var firstField = parentField,\n      key = null,\n      keysPath = [];\n\n  do {\n    var subfields = firstField === config ? config.fields : firstField.subfields;\n\n    if (!subfields || !Object.keys(subfields).length) {\n      firstField = key = null;\n      break;\n    }\n\n    key = Object.keys(subfields)[0];\n    keysPath.push(key);\n    firstField = subfields[key];\n  } while (firstField.type == \"!struct\" || firstField.type == \"!group\");\n\n  return (parentPathArr || []).concat(keysPath).join(fieldSeparator);\n};\n\nexports.getFirstField = getFirstField;\n\nvar getOperatorsForField = function getOperatorsForField(config, field) {\n  var fieldConfig = (0, _configUtils.getFieldConfig)(config, field);\n  var fieldOps = fieldConfig ? fieldConfig.operators : [];\n  return fieldOps;\n};\n\nexports.getOperatorsForField = getOperatorsForField;\n\nvar getFirstOperator = function getFirstOperator(config, field) {\n  var fieldOps = getOperatorsForField(config, field);\n  return fieldOps ? fieldOps[0] : null;\n};\n\nexports.getFirstOperator = getFirstOperator;\n\nvar getFieldPath = function getFieldPath(field, config) {\n  var onlyKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  if (!field) return null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  if (onlyKeys) return parts;else return parts.map(function (_curr, ind, arr) {\n    return arr.slice(0, ind + 1);\n  }).map(function (parts) {\n    return parts.join(fieldSeparator);\n  });\n};\n\nexports.getFieldPath = getFieldPath;\n\nvar getFuncPathLabels = function getFuncPathLabels(field, config) {\n  var parentField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  return getFieldPathLabels(field, config, parentField, \"funcs\", \"subfields\");\n};\n\nexports.getFuncPathLabels = getFuncPathLabels;\n\nvar getFieldPathLabels = function getFieldPathLabels(field, config) {\n  var parentField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var fieldsKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"fields\";\n  var subfieldsKey = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : \"subfields\";\n  if (!field) return null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var parentParts = parentField ? Array.isArray(parentField) ? parentField : parentField.split(fieldSeparator) : [];\n  return parts.slice(parentParts.length).map(function (_curr, ind, arr) {\n    return arr.slice(0, ind + 1);\n  }).map(function (parts) {\n    return [].concat((0, _toConsumableArray2[\"default\"])(parentParts), (0, _toConsumableArray2[\"default\"])(parts)).join(fieldSeparator);\n  }).map(function (part) {\n    var cnf = (0, _configUtils.getFieldRawConfig)(config, part, fieldsKey, subfieldsKey);\n    return cnf && cnf.label || cnf && (0, _last[\"default\"])(part.split(fieldSeparator));\n  }).filter(function (label) {\n    return label != null;\n  });\n};\n\nexports.getFieldPathLabels = getFieldPathLabels;\n\nvar getFieldPartsConfigs = function getFieldPartsConfigs(field, config) {\n  var parentField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  if (!field) return null;\n  var parentFieldDef = parentField && (0, _configUtils.getFieldRawConfig)(config, parentField) || null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var parentParts = parentField ? Array.isArray(parentField) ? parentField : parentField.split(fieldSeparator) : [];\n  return parts.slice(parentParts.length).map(function (_curr, ind, arr) {\n    return arr.slice(0, ind + 1);\n  }).map(function (parts) {\n    return {\n      part: [].concat((0, _toConsumableArray2[\"default\"])(parentParts), (0, _toConsumableArray2[\"default\"])(parts)).join(fieldSeparator),\n      key: parts[parts.length - 1]\n    };\n  }).map(function (_ref) {\n    var part = _ref.part,\n        key = _ref.key;\n    var cnf = (0, _configUtils.getFieldRawConfig)(config, part);\n    return {\n      key: key,\n      cnf: cnf\n    };\n  }).map(function (_ref2, ind, arr) {\n    var key = _ref2.key,\n        cnf = _ref2.cnf;\n    var parentCnf = ind > 0 ? arr[ind - 1].cnf : parentFieldDef;\n    return [key, cnf, parentCnf];\n  });\n};\n\nexports.getFieldPartsConfigs = getFieldPartsConfigs;\n\nvar getValueLabel = function getValueLabel(config, field, operator, delta) {\n  var valueSrc = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n  var isSpecialRange = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n  var isFuncArg = field && (0, _typeof2[\"default\"])(field) == \"object\" && !!field.func && !!field.arg;\n  var showLabels = config.settings.showLabels;\n  var fieldConfig = (0, _configUtils.getFieldConfig)(config, field);\n  var fieldWidgetConfig = (0, _configUtils.getFieldWidgetConfig)(config, field, operator, null, valueSrc) || {};\n  var mergedOpConfig = (0, _configUtils.getOperatorConfig)(config, operator, field) || {};\n  var cardinality = isSpecialRange ? 1 : mergedOpConfig.cardinality;\n  var ret = null;\n\n  if (cardinality > 1) {\n    var valueLabels = fieldWidgetConfig.valueLabels || mergedOpConfig.valueLabels;\n    if (valueLabels) ret = valueLabels[delta];\n\n    if (ret && (0, _typeof2[\"default\"])(ret) != \"object\") {\n      ret = {\n        label: ret,\n        placeholder: ret\n      };\n    }\n\n    if (!ret) {\n      ret = {\n        label: config.settings.valueLabel + \" \" + (delta + 1),\n        placeholder: config.settings.valuePlaceholder + \" \" + (delta + 1)\n      };\n    }\n  } else {\n    var label = fieldWidgetConfig.valueLabel;\n    var placeholder = fieldWidgetConfig.valuePlaceholder;\n\n    if (isFuncArg) {\n      if (!label) label = fieldConfig.label || field.arg;\n      if (!placeholder && !showLabels) placeholder = fieldConfig.label || field.arg;\n    }\n\n    ret = {\n      label: label || config.settings.valueLabel,\n      placeholder: placeholder || config.settings.valuePlaceholder\n    };\n  }\n\n  return ret;\n};\n\nexports.getValueLabel = getValueLabel;\n\nfunction _getWidgetsAndSrcsForFieldOp(config, field) {\n  var operator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var valueSrc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var widgets = [];\n  var valueSrcs = [];\n  if (!field) return {\n    widgets: widgets,\n    valueSrcs: valueSrcs\n  };\n\n  var isFuncArg = (0, _typeof2[\"default\"])(field) == \"object\" && (!!field.func && !!field.arg || field._isFuncArg);\n\n  var fieldConfig = (0, _configUtils.getFieldConfig)(config, field);\n  var opConfig = operator ? config.operators[operator] : null;\n\n  if (fieldConfig && fieldConfig.widgets) {\n    var _loop2 = function _loop2(widget) {\n      var widgetConfig = fieldConfig.widgets[widget]; // if (!config.widgets[widget]) {\n      //   continue;\n      // }\n\n      var widgetValueSrc = config.widgets[widget].valueSrc || \"value\";\n      var canAdd = true;\n\n      if (widget == \"field\") {\n        canAdd = canAdd && filterValueSourcesForField(config, [\"field\"], fieldConfig).length > 0;\n      }\n\n      if (widget == \"func\") {\n        canAdd = canAdd && filterValueSourcesForField(config, [\"func\"], fieldConfig).length > 0;\n      } // If can't check operators, don't add\n      // Func args don't have operators\n\n\n      if (valueSrc == \"value\" && !widgetConfig.operators && !isFuncArg && field != \"!case_value\") canAdd = false;\n      if (widgetConfig.operators && operator) canAdd = canAdd && widgetConfig.operators.indexOf(operator) != -1;\n      if (valueSrc && valueSrc != widgetValueSrc && valueSrc != \"const\") canAdd = false;\n      if (opConfig && opConfig.cardinality == 0 && widgetValueSrc != \"value\") canAdd = false;\n\n      if (canAdd) {\n        widgets.push(widget);\n        var canAddValueSrc = fieldConfig.valueSources && fieldConfig.valueSources.indexOf(widgetValueSrc) != -1;\n        if (opConfig && opConfig.valueSources && opConfig.valueSources.indexOf(widgetValueSrc) == -1) canAddValueSrc = false;\n        if (canAddValueSrc && !valueSrcs.find(function (v) {\n          return v == widgetValueSrc;\n        })) valueSrcs.push(widgetValueSrc);\n      }\n    };\n\n    for (var widget in fieldConfig.widgets) {\n      _loop2(widget);\n    }\n  }\n\n  var widgetWeight = function widgetWeight(w) {\n    var wg = 0;\n\n    if (fieldConfig.preferWidgets) {\n      if (fieldConfig.preferWidgets.includes(w)) wg += 10 - fieldConfig.preferWidgets.indexOf(w);\n    } else if (w == fieldConfig.mainWidget) {\n      wg += 100;\n    }\n\n    if (w == \"field\") {\n      wg -= 1;\n    }\n\n    if (w == \"func\") {\n      wg -= 2;\n    }\n\n    return wg;\n  };\n\n  widgets.sort(function (w1, w2) {\n    return widgetWeight(w2) - widgetWeight(w1);\n  });\n  return {\n    widgets: widgets,\n    valueSrcs: valueSrcs\n  };\n}\n\nvar getWidgetsForFieldOp = function getWidgetsForFieldOp(config, field, operator) {\n  var valueSrc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var _getWidgetsAndSrcsFor = _getWidgetsAndSrcsForFieldOp(config, field, operator, valueSrc),\n      widgets = _getWidgetsAndSrcsFor.widgets;\n\n  return widgets;\n};\n\nexports.getWidgetsForFieldOp = getWidgetsForFieldOp;\n\nvar filterValueSourcesForField = function filterValueSourcesForField(config, valueSrcs, fieldDefinition) {\n  if (!fieldDefinition) return valueSrcs;\n  return valueSrcs.filter(function (vs) {\n    var canAdd = true;\n\n    if (vs == \"field\") {\n      if (config._fieldsCntByType) {\n        // tip: LHS field can be used as arg in RHS function\n        var minCnt = fieldDefinition._isFuncArg ? 0 : 1;\n        canAdd = canAdd && config._fieldsCntByType[fieldDefinition.type] > minCnt;\n      }\n    }\n\n    if (vs == \"func\") {\n      if (config._funcsCntByType) canAdd = canAdd && !!config._funcsCntByType[fieldDefinition.type];\n      if (fieldDefinition.funcs) canAdd = canAdd && fieldDefinition.funcs.length > 0;\n    }\n\n    return canAdd;\n  });\n};\n\nexports.filterValueSourcesForField = filterValueSourcesForField;\n\nvar getValueSourcesForFieldOp = function getValueSourcesForFieldOp(config, field, operator) {\n  var fieldDefinition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var leftFieldForFunc = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n\n  var _getWidgetsAndSrcsFor2 = _getWidgetsAndSrcsForFieldOp(config, field, operator, null),\n      valueSrcs = _getWidgetsAndSrcsFor2.valueSrcs;\n\n  var filteredValueSrcs = filterValueSourcesForField(config, valueSrcs, fieldDefinition);\n  return filteredValueSrcs;\n};\n\nexports.getValueSourcesForFieldOp = getValueSourcesForFieldOp;\n\nvar getWidgetForFieldOp = function getWidgetForFieldOp(config, field, operator) {\n  var valueSrc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var _getWidgetsAndSrcsFor3 = _getWidgetsAndSrcsForFieldOp(config, field, operator, valueSrc),\n      widgets = _getWidgetsAndSrcsFor3.widgets;\n\n  var widget = null;\n  if (widgets.length) widget = widgets[0];\n  return widget;\n};\n\nexports.getWidgetForFieldOp = getWidgetForFieldOp;\n\nvar formatFieldName = function formatFieldName(field, config, meta) {\n  var parentField = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  if (!field) return;\n  var fieldDef = (0, _configUtils.getFieldConfig)(config, field) || {};\n  var fieldSeparator = config.settings.fieldSeparator;\n  var fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var fieldName = Array.isArray(field) ? field.join(fieldSeparator) : field;\n\n  if (fieldDef.tableName) {\n    // legacy\n    var fieldPartsCopy = (0, _toConsumableArray2[\"default\"])(fieldParts);\n    fieldPartsCopy[0] = fieldDef.tableName;\n    fieldName = fieldPartsCopy.join(fieldSeparator);\n  }\n\n  if (fieldDef.fieldName) {\n    fieldName = fieldDef.fieldName;\n  }\n\n  if (parentField) {\n    var parentFieldDef = (0, _configUtils.getFieldConfig)(config, parentField) || {};\n    var parentFieldName = parentField;\n\n    if (parentFieldDef.fieldName) {\n      parentFieldName = parentFieldDef.fieldName;\n    }\n\n    if (fieldName.indexOf(parentFieldName + fieldSeparator) == 0) {\n      fieldName = fieldName.slice((parentFieldName + fieldSeparator).length);\n    } else {\n      meta.errors.push(\"Can't cut group \".concat(parentFieldName, \" from field \").concat(fieldName));\n    }\n  }\n\n  return fieldName;\n};\n\nexports.formatFieldName = formatFieldName;","map":{"version":3,"sources":["D:/LIMSWFH/LIMSPOSTGRESQL/QuaLISWeb/node_modules/react-awesome-query-builder/lib/utils/ruleUtils.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","getWidgetsForFieldOp","getWidgetForFieldOp","getValueSourcesForFieldOp","getValueLabel","getOperatorsForField","getNewValueForFieldOp","getFuncPathLabels","getFirstOperator","getFirstField","getFieldPathLabels","getFieldPath","getFieldPartsConfigs","formatFieldName","filterValueSourcesForField","_typeof2","_toConsumableArray2","_slicedToArray2","_configUtils","_stuff","_immutable","_validation","_last","selectTypes","config","oldConfig","arguments","length","undefined","current","newField","newOperator","changedProp","canFix","currentField","get","currentOperator","currentValue","currentValueSrc","List","currentValueType","currentAsyncListValues","_config$settings","settings","convertableWidgets","clearValueOnChangeField","clearValueOnChangeOp","showErrorMessage","newOperatorConfig","getOperatorConfig","operatorCardinality","defaultValue","cardinality","currentFieldConfig","getFieldConfig","newFieldConfig","canReuseValue","type","includes","i","vs","currentWidget","newWidget","currentValueWidget","newValueWidget","canReuseWidget","firstWidgetConfig","getFieldWidgetConfig","first","valueSources","valueFixes","valueErrors","Array","from","_loop","_i","v","vType","vSrc","isValidSrc","find","isEndValue","asyncListValues","_validateValue","validateValue","_validateValue2","validateError","fixedValue","isValid","_ret","newValue","newValueSrc","newValueType","newValueError","_ignore","size","_newFieldConfig$field","getFirstDefined","fieldSettings","validateValues","toJS","filter","jsValues","map","rangeValidateError","push","vt","parentRuleGroupPath","fieldSeparator","parentPathArr","split","parentField","getFieldRawConfig","firstField","key","keysPath","subfields","fields","keys","concat","join","field","fieldConfig","fieldOps","operators","onlyKeys","parts","isArray","_curr","ind","arr","slice","fieldsKey","subfieldsKey","parentParts","part","cnf","label","parentFieldDef","_ref","_ref2","parentCnf","operator","delta","valueSrc","isSpecialRange","isFuncArg","func","arg","showLabels","fieldWidgetConfig","mergedOpConfig","ret","valueLabels","placeholder","valueLabel","valuePlaceholder","_getWidgetsAndSrcsForFieldOp","widgets","valueSrcs","_isFuncArg","opConfig","_loop2","widget","widgetConfig","widgetValueSrc","canAdd","indexOf","canAddValueSrc","widgetWeight","w","wg","preferWidgets","mainWidget","sort","w1","w2","_getWidgetsAndSrcsFor","fieldDefinition","_fieldsCntByType","minCnt","_funcsCntByType","funcs","leftFieldForFunc","_getWidgetsAndSrcsFor2","filteredValueSrcs","_getWidgetsAndSrcsFor3","meta","fieldDef","fieldParts","fieldName","tableName","fieldPartsCopy","parentFieldName","errors"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getWidgetsForFieldOp = exports.getWidgetForFieldOp = exports.getValueSourcesForFieldOp = exports.getValueLabel = exports.getOperatorsForField = exports.getNewValueForFieldOp = exports.getFuncPathLabels = exports.getFirstOperator = exports.getFirstField = exports.getFieldPathLabels = exports.getFieldPath = exports.getFieldPartsConfigs = exports.formatFieldName = exports.filterValueSourcesForField = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _configUtils = require(\"./configUtils\");\n\nvar _stuff = require(\"../utils/stuff\");\n\nvar _immutable = _interopRequireDefault(require(\"immutable\"));\n\nvar _validation = require(\"../utils/validation\");\n\nvar _last = _interopRequireDefault(require(\"lodash/last\"));\n\nvar selectTypes = [\"select\", \"multiselect\", \"treeselect\", \"treemultiselect\"];\n/**\n * @param {object} config\n * @param {object} oldConfig\n * @param {Immutable.Map} current\n * @param {string} newField\n * @param {string} newOperator\n * @param {string} changedProp\n * @return {object} - {canReuseValue, newValue, newValueSrc, newValueType, newValueError}\n */\n\nvar getNewValueForFieldOp = function getNewValueForFieldOp(config) {\n  var oldConfig = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var current = arguments.length > 2 ? arguments[2] : undefined;\n  var newField = arguments.length > 3 ? arguments[3] : undefined;\n  var newOperator = arguments.length > 4 ? arguments[4] : undefined;\n  var changedProp = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;\n  var canFix = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : true;\n  if (!oldConfig) oldConfig = config;\n  var currentField = current.get(\"field\");\n  var currentOperator = current.get(\"operator\");\n  var currentValue = current.get(\"value\");\n  var currentValueSrc = current.get(\"valueSrc\", new _immutable[\"default\"].List());\n  var currentValueType = current.get(\"valueType\", new _immutable[\"default\"].List());\n  var currentAsyncListValues = current.get(\"asyncListValues\"); //const isValidatingTree = (changedProp === null);\n\n  var _config$settings = config.settings,\n      convertableWidgets = _config$settings.convertableWidgets,\n      clearValueOnChangeField = _config$settings.clearValueOnChangeField,\n      clearValueOnChangeOp = _config$settings.clearValueOnChangeOp,\n      showErrorMessage = _config$settings.showErrorMessage; //const currentOperatorConfig = getOperatorConfig(oldConfig, currentOperator, currentField);\n\n  var newOperatorConfig = (0, _configUtils.getOperatorConfig)(config, newOperator, newField); //const currentOperatorCardinality = currentOperator ? defaultValue(currentOperatorConfig.cardinality, 1) : null;\n\n  var operatorCardinality = newOperator ? (0, _stuff.defaultValue)(newOperatorConfig.cardinality, 1) : null;\n  var currentFieldConfig = (0, _configUtils.getFieldConfig)(oldConfig, currentField);\n  var newFieldConfig = (0, _configUtils.getFieldConfig)(config, newField);\n  var canReuseValue = currentField && currentOperator && newOperator && currentValue != undefined && (!changedProp || changedProp == \"field\" && !clearValueOnChangeField || changedProp == \"operator\" && !clearValueOnChangeOp) && currentFieldConfig && newFieldConfig && currentFieldConfig.type == newFieldConfig.type;\n\n  if (canReuseValue && selectTypes.includes(currentFieldConfig.type) && changedProp == \"field\") {\n    // different fields of select types has different listValues\n    canReuseValue = false;\n  } // compare old & new widgets\n\n\n  for (var i = 0; i < operatorCardinality; i++) {\n    var vs = currentValueSrc.get(i) || null;\n    var currentWidget = getWidgetForFieldOp(oldConfig, currentField, currentOperator, vs);\n    var newWidget = getWidgetForFieldOp(config, newField, newOperator, vs); // need to also check value widgets if we changed operator and current value source was 'field'\n    // cause for select type op '=' requires single value and op 'in' requires array value\n\n    var currentValueWidget = vs == \"value\" ? currentWidget : getWidgetForFieldOp(oldConfig, currentField, currentOperator, \"value\");\n    var newValueWidget = vs == \"value\" ? newWidget : getWidgetForFieldOp(config, newField, newOperator, \"value\");\n    var canReuseWidget = newValueWidget == currentValueWidget || (convertableWidgets[currentValueWidget] || []).includes(newValueWidget);\n    if (!canReuseWidget) canReuseValue = false;\n  }\n\n  if (currentOperator != newOperator && [currentOperator, newOperator].includes(\"proximity\")) canReuseValue = false;\n  var firstWidgetConfig = (0, _configUtils.getFieldWidgetConfig)(config, newField, newOperator, null, currentValueSrc.first());\n  var valueSources = getValueSourcesForFieldOp(config, newField, newOperator);\n  var valueFixes = {};\n  var valueErrors = Array.from({\n    length: operatorCardinality\n  }, function () {\n    return null;\n  });\n\n  if (canReuseValue) {\n    var _loop = function _loop(_i) {\n      var v = currentValue.get(_i);\n      var vType = currentValueType.get(_i) || null;\n      var vSrc = currentValueSrc.get(_i) || null;\n      var isValidSrc = valueSources.find(function (v) {\n        return v == vSrc;\n      }) != null;\n      if (!isValidSrc && _i > 0 && vSrc == null) isValidSrc = true; // make exception for range widgets (when changing op from '==' to 'between')\n\n      var isEndValue = !canFix;\n      var asyncListValues = currentAsyncListValues;\n\n      var _validateValue = (0, _validation.validateValue)(config, newField, newField, newOperator, v, vType, vSrc, asyncListValues, canFix, isEndValue),\n          _validateValue2 = (0, _slicedToArray2[\"default\"])(_validateValue, 2),\n          validateError = _validateValue2[0],\n          fixedValue = _validateValue2[1];\n\n      var isValid = !validateError;\n\n      if (!isValid && showErrorMessage && changedProp != \"field\") {\n        // allow bad value\n        // but not on field change - in that case just drop bad value that can't be reused\n        // ? maybe we should also drop bad value on op change?\n        valueErrors[_i] = validateError;\n      } else if (!isValidSrc || !isValid) {\n        canReuseValue = false;\n        return \"break\";\n      } else if (canFix && fixedValue !== v) {\n        valueFixes[_i] = fixedValue;\n      }\n    };\n\n    for (var _i = 0; _i < operatorCardinality; _i++) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  } // reuse value OR get defaultValue for cardinality 1 (it means default range values is not supported yet, todo)\n\n\n  var newValue = null,\n      newValueSrc = null,\n      newValueType = null,\n      newValueError = null;\n  newValue = new _immutable[\"default\"].List(Array.from({\n    length: operatorCardinality\n  }, function (_ignore, i) {\n    var v = undefined;\n\n    if (canReuseValue) {\n      if (i < currentValue.size) {\n        v = currentValue.get(i);\n\n        if (valueFixes[i] !== undefined) {\n          v = valueFixes[i];\n        }\n      }\n    } else if (operatorCardinality == 1) {\n      var _newFieldConfig$field;\n\n      v = (0, _stuff.getFirstDefined)([newFieldConfig === null || newFieldConfig === void 0 ? void 0 : newFieldConfig.defaultValue, newFieldConfig === null || newFieldConfig === void 0 ? void 0 : (_newFieldConfig$field = newFieldConfig.fieldSettings) === null || _newFieldConfig$field === void 0 ? void 0 : _newFieldConfig$field.defaultValue, firstWidgetConfig === null || firstWidgetConfig === void 0 ? void 0 : firstWidgetConfig.defaultValue]);\n    }\n\n    return v;\n  }));\n  newValueSrc = new _immutable[\"default\"].List(Array.from({\n    length: operatorCardinality\n  }, function (_ignore, i) {\n    var vs = null;\n\n    if (canReuseValue) {\n      if (i < currentValueSrc.size) vs = currentValueSrc.get(i);\n    } else if (valueSources.length == 1) {\n      vs = valueSources[0];\n    } else if (valueSources.length > 1) {\n      vs = valueSources[0];\n    }\n\n    return vs;\n  }));\n\n  if (showErrorMessage) {\n    if (newOperatorConfig && newOperatorConfig.validateValues && newValueSrc.toJS().filter(function (vs) {\n      return vs == \"value\" || vs == null;\n    }).length == operatorCardinality) {\n      // last element in `valueError` list is for range validation error\n      var jsValues = firstWidgetConfig && firstWidgetConfig.toJS ? newValue.toJS().map(function (v) {\n        return firstWidgetConfig.toJS(v, firstWidgetConfig);\n      }) : newValue.toJS();\n      var rangeValidateError = newOperatorConfig.validateValues(jsValues);\n\n      if (showErrorMessage) {\n        valueErrors.push(rangeValidateError);\n      }\n    }\n\n    newValueError = new _immutable[\"default\"].List(valueErrors);\n  }\n\n  newValueType = new _immutable[\"default\"].List(Array.from({\n    length: operatorCardinality\n  }, function (_ignore, i) {\n    var vt = null;\n\n    if (canReuseValue) {\n      if (i < currentValueType.size) vt = currentValueType.get(i);\n    } else if (operatorCardinality == 1 && firstWidgetConfig && firstWidgetConfig.type !== undefined) {\n      vt = firstWidgetConfig.type;\n    } else if (operatorCardinality == 1 && newFieldConfig && newFieldConfig.type !== undefined) {\n      vt = newFieldConfig.type == \"!group\" ? \"number\" : newFieldConfig.type;\n    }\n\n    return vt;\n  }));\n  return {\n    canReuseValue: canReuseValue,\n    newValue: newValue,\n    newValueSrc: newValueSrc,\n    newValueType: newValueType,\n    newValueError: newValueError,\n    operatorCardinality: operatorCardinality\n  };\n};\n\nexports.getNewValueForFieldOp = getNewValueForFieldOp;\n\nvar getFirstField = function getFirstField(config) {\n  var parentRuleGroupPath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parentPathArr = typeof parentRuleGroupPath == \"string\" ? parentRuleGroupPath.split(fieldSeparator) : parentRuleGroupPath;\n  var parentField = parentRuleGroupPath ? (0, _configUtils.getFieldRawConfig)(config, parentRuleGroupPath) : config;\n  var firstField = parentField,\n      key = null,\n      keysPath = [];\n\n  do {\n    var subfields = firstField === config ? config.fields : firstField.subfields;\n\n    if (!subfields || !Object.keys(subfields).length) {\n      firstField = key = null;\n      break;\n    }\n\n    key = Object.keys(subfields)[0];\n    keysPath.push(key);\n    firstField = subfields[key];\n  } while (firstField.type == \"!struct\" || firstField.type == \"!group\");\n\n  return (parentPathArr || []).concat(keysPath).join(fieldSeparator);\n};\n\nexports.getFirstField = getFirstField;\n\nvar getOperatorsForField = function getOperatorsForField(config, field) {\n  var fieldConfig = (0, _configUtils.getFieldConfig)(config, field);\n  var fieldOps = fieldConfig ? fieldConfig.operators : [];\n  return fieldOps;\n};\n\nexports.getOperatorsForField = getOperatorsForField;\n\nvar getFirstOperator = function getFirstOperator(config, field) {\n  var fieldOps = getOperatorsForField(config, field);\n  return fieldOps ? fieldOps[0] : null;\n};\n\nexports.getFirstOperator = getFirstOperator;\n\nvar getFieldPath = function getFieldPath(field, config) {\n  var onlyKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  if (!field) return null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  if (onlyKeys) return parts;else return parts.map(function (_curr, ind, arr) {\n    return arr.slice(0, ind + 1);\n  }).map(function (parts) {\n    return parts.join(fieldSeparator);\n  });\n};\n\nexports.getFieldPath = getFieldPath;\n\nvar getFuncPathLabels = function getFuncPathLabels(field, config) {\n  var parentField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  return getFieldPathLabels(field, config, parentField, \"funcs\", \"subfields\");\n};\n\nexports.getFuncPathLabels = getFuncPathLabels;\n\nvar getFieldPathLabels = function getFieldPathLabels(field, config) {\n  var parentField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var fieldsKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"fields\";\n  var subfieldsKey = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : \"subfields\";\n  if (!field) return null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var parentParts = parentField ? Array.isArray(parentField) ? parentField : parentField.split(fieldSeparator) : [];\n  return parts.slice(parentParts.length).map(function (_curr, ind, arr) {\n    return arr.slice(0, ind + 1);\n  }).map(function (parts) {\n    return [].concat((0, _toConsumableArray2[\"default\"])(parentParts), (0, _toConsumableArray2[\"default\"])(parts)).join(fieldSeparator);\n  }).map(function (part) {\n    var cnf = (0, _configUtils.getFieldRawConfig)(config, part, fieldsKey, subfieldsKey);\n    return cnf && cnf.label || cnf && (0, _last[\"default\"])(part.split(fieldSeparator));\n  }).filter(function (label) {\n    return label != null;\n  });\n};\n\nexports.getFieldPathLabels = getFieldPathLabels;\n\nvar getFieldPartsConfigs = function getFieldPartsConfigs(field, config) {\n  var parentField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  if (!field) return null;\n  var parentFieldDef = parentField && (0, _configUtils.getFieldRawConfig)(config, parentField) || null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var parentParts = parentField ? Array.isArray(parentField) ? parentField : parentField.split(fieldSeparator) : [];\n  return parts.slice(parentParts.length).map(function (_curr, ind, arr) {\n    return arr.slice(0, ind + 1);\n  }).map(function (parts) {\n    return {\n      part: [].concat((0, _toConsumableArray2[\"default\"])(parentParts), (0, _toConsumableArray2[\"default\"])(parts)).join(fieldSeparator),\n      key: parts[parts.length - 1]\n    };\n  }).map(function (_ref) {\n    var part = _ref.part,\n        key = _ref.key;\n    var cnf = (0, _configUtils.getFieldRawConfig)(config, part);\n    return {\n      key: key,\n      cnf: cnf\n    };\n  }).map(function (_ref2, ind, arr) {\n    var key = _ref2.key,\n        cnf = _ref2.cnf;\n    var parentCnf = ind > 0 ? arr[ind - 1].cnf : parentFieldDef;\n    return [key, cnf, parentCnf];\n  });\n};\n\nexports.getFieldPartsConfigs = getFieldPartsConfigs;\n\nvar getValueLabel = function getValueLabel(config, field, operator, delta) {\n  var valueSrc = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n  var isSpecialRange = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n  var isFuncArg = field && (0, _typeof2[\"default\"])(field) == \"object\" && !!field.func && !!field.arg;\n  var showLabels = config.settings.showLabels;\n  var fieldConfig = (0, _configUtils.getFieldConfig)(config, field);\n  var fieldWidgetConfig = (0, _configUtils.getFieldWidgetConfig)(config, field, operator, null, valueSrc) || {};\n  var mergedOpConfig = (0, _configUtils.getOperatorConfig)(config, operator, field) || {};\n  var cardinality = isSpecialRange ? 1 : mergedOpConfig.cardinality;\n  var ret = null;\n\n  if (cardinality > 1) {\n    var valueLabels = fieldWidgetConfig.valueLabels || mergedOpConfig.valueLabels;\n    if (valueLabels) ret = valueLabels[delta];\n\n    if (ret && (0, _typeof2[\"default\"])(ret) != \"object\") {\n      ret = {\n        label: ret,\n        placeholder: ret\n      };\n    }\n\n    if (!ret) {\n      ret = {\n        label: config.settings.valueLabel + \" \" + (delta + 1),\n        placeholder: config.settings.valuePlaceholder + \" \" + (delta + 1)\n      };\n    }\n  } else {\n    var label = fieldWidgetConfig.valueLabel;\n    var placeholder = fieldWidgetConfig.valuePlaceholder;\n\n    if (isFuncArg) {\n      if (!label) label = fieldConfig.label || field.arg;\n      if (!placeholder && !showLabels) placeholder = fieldConfig.label || field.arg;\n    }\n\n    ret = {\n      label: label || config.settings.valueLabel,\n      placeholder: placeholder || config.settings.valuePlaceholder\n    };\n  }\n\n  return ret;\n};\n\nexports.getValueLabel = getValueLabel;\n\nfunction _getWidgetsAndSrcsForFieldOp(config, field) {\n  var operator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var valueSrc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var widgets = [];\n  var valueSrcs = [];\n  if (!field) return {\n    widgets: widgets,\n    valueSrcs: valueSrcs\n  };\n\n  var isFuncArg = (0, _typeof2[\"default\"])(field) == \"object\" && (!!field.func && !!field.arg || field._isFuncArg);\n\n  var fieldConfig = (0, _configUtils.getFieldConfig)(config, field);\n  var opConfig = operator ? config.operators[operator] : null;\n\n  if (fieldConfig && fieldConfig.widgets) {\n    var _loop2 = function _loop2(widget) {\n      var widgetConfig = fieldConfig.widgets[widget]; // if (!config.widgets[widget]) {\n      //   continue;\n      // }\n\n      var widgetValueSrc = config.widgets[widget].valueSrc || \"value\";\n      var canAdd = true;\n\n      if (widget == \"field\") {\n        canAdd = canAdd && filterValueSourcesForField(config, [\"field\"], fieldConfig).length > 0;\n      }\n\n      if (widget == \"func\") {\n        canAdd = canAdd && filterValueSourcesForField(config, [\"func\"], fieldConfig).length > 0;\n      } // If can't check operators, don't add\n      // Func args don't have operators\n\n\n      if (valueSrc == \"value\" && !widgetConfig.operators && !isFuncArg && field != \"!case_value\") canAdd = false;\n      if (widgetConfig.operators && operator) canAdd = canAdd && widgetConfig.operators.indexOf(operator) != -1;\n      if (valueSrc && valueSrc != widgetValueSrc && valueSrc != \"const\") canAdd = false;\n      if (opConfig && opConfig.cardinality == 0 && widgetValueSrc != \"value\") canAdd = false;\n\n      if (canAdd) {\n        widgets.push(widget);\n        var canAddValueSrc = fieldConfig.valueSources && fieldConfig.valueSources.indexOf(widgetValueSrc) != -1;\n        if (opConfig && opConfig.valueSources && opConfig.valueSources.indexOf(widgetValueSrc) == -1) canAddValueSrc = false;\n        if (canAddValueSrc && !valueSrcs.find(function (v) {\n          return v == widgetValueSrc;\n        })) valueSrcs.push(widgetValueSrc);\n      }\n    };\n\n    for (var widget in fieldConfig.widgets) {\n      _loop2(widget);\n    }\n  }\n\n  var widgetWeight = function widgetWeight(w) {\n    var wg = 0;\n\n    if (fieldConfig.preferWidgets) {\n      if (fieldConfig.preferWidgets.includes(w)) wg += 10 - fieldConfig.preferWidgets.indexOf(w);\n    } else if (w == fieldConfig.mainWidget) {\n      wg += 100;\n    }\n\n    if (w == \"field\") {\n      wg -= 1;\n    }\n\n    if (w == \"func\") {\n      wg -= 2;\n    }\n\n    return wg;\n  };\n\n  widgets.sort(function (w1, w2) {\n    return widgetWeight(w2) - widgetWeight(w1);\n  });\n  return {\n    widgets: widgets,\n    valueSrcs: valueSrcs\n  };\n}\n\nvar getWidgetsForFieldOp = function getWidgetsForFieldOp(config, field, operator) {\n  var valueSrc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var _getWidgetsAndSrcsFor = _getWidgetsAndSrcsForFieldOp(config, field, operator, valueSrc),\n      widgets = _getWidgetsAndSrcsFor.widgets;\n\n  return widgets;\n};\n\nexports.getWidgetsForFieldOp = getWidgetsForFieldOp;\n\nvar filterValueSourcesForField = function filterValueSourcesForField(config, valueSrcs, fieldDefinition) {\n  if (!fieldDefinition) return valueSrcs;\n  return valueSrcs.filter(function (vs) {\n    var canAdd = true;\n\n    if (vs == \"field\") {\n      if (config._fieldsCntByType) {\n        // tip: LHS field can be used as arg in RHS function\n        var minCnt = fieldDefinition._isFuncArg ? 0 : 1;\n        canAdd = canAdd && config._fieldsCntByType[fieldDefinition.type] > minCnt;\n      }\n    }\n\n    if (vs == \"func\") {\n      if (config._funcsCntByType) canAdd = canAdd && !!config._funcsCntByType[fieldDefinition.type];\n      if (fieldDefinition.funcs) canAdd = canAdd && fieldDefinition.funcs.length > 0;\n    }\n\n    return canAdd;\n  });\n};\n\nexports.filterValueSourcesForField = filterValueSourcesForField;\n\nvar getValueSourcesForFieldOp = function getValueSourcesForFieldOp(config, field, operator) {\n  var fieldDefinition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var leftFieldForFunc = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n\n  var _getWidgetsAndSrcsFor2 = _getWidgetsAndSrcsForFieldOp(config, field, operator, null),\n      valueSrcs = _getWidgetsAndSrcsFor2.valueSrcs;\n\n  var filteredValueSrcs = filterValueSourcesForField(config, valueSrcs, fieldDefinition);\n  return filteredValueSrcs;\n};\n\nexports.getValueSourcesForFieldOp = getValueSourcesForFieldOp;\n\nvar getWidgetForFieldOp = function getWidgetForFieldOp(config, field, operator) {\n  var valueSrc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var _getWidgetsAndSrcsFor3 = _getWidgetsAndSrcsForFieldOp(config, field, operator, valueSrc),\n      widgets = _getWidgetsAndSrcsFor3.widgets;\n\n  var widget = null;\n  if (widgets.length) widget = widgets[0];\n  return widget;\n};\n\nexports.getWidgetForFieldOp = getWidgetForFieldOp;\n\nvar formatFieldName = function formatFieldName(field, config, meta) {\n  var parentField = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  if (!field) return;\n  var fieldDef = (0, _configUtils.getFieldConfig)(config, field) || {};\n  var fieldSeparator = config.settings.fieldSeparator;\n  var fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var fieldName = Array.isArray(field) ? field.join(fieldSeparator) : field;\n\n  if (fieldDef.tableName) {\n    // legacy\n    var fieldPartsCopy = (0, _toConsumableArray2[\"default\"])(fieldParts);\n    fieldPartsCopy[0] = fieldDef.tableName;\n    fieldName = fieldPartsCopy.join(fieldSeparator);\n  }\n\n  if (fieldDef.fieldName) {\n    fieldName = fieldDef.fieldName;\n  }\n\n  if (parentField) {\n    var parentFieldDef = (0, _configUtils.getFieldConfig)(config, parentField) || {};\n    var parentFieldName = parentField;\n\n    if (parentFieldDef.fieldName) {\n      parentFieldName = parentFieldDef.fieldName;\n    }\n\n    if (fieldName.indexOf(parentFieldName + fieldSeparator) == 0) {\n      fieldName = fieldName.slice((parentFieldName + fieldSeparator).length);\n    } else {\n      meta.errors.push(\"Can't cut group \".concat(parentFieldName, \" from field \").concat(fieldName));\n    }\n  }\n\n  return fieldName;\n};\n\nexports.formatFieldName = formatFieldName;"]},"metadata":{},"sourceType":"script"}