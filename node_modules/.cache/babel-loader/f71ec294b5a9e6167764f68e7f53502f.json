{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.normalizeField = exports.getOperatorConfig = exports.getFuncConfig = exports.getFuncArgConfig = exports.getFieldWidgetConfig = exports.getFieldRawConfig = exports.getFieldConfig = exports.extendConfig = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _merge = _interopRequireDefault(require(\"lodash/merge\"));\n\nvar _mergeWith = _interopRequireDefault(require(\"lodash/mergeWith\"));\n\nvar _default = require(\"../config/default\");\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _stuff = require(\"./stuff\");\n\nvar _ruleUtils = require(\"./ruleUtils\");\n\nvar _clone = _interopRequireDefault(require(\"clone\"));\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nvar extendConfig = function extendConfig(config) {\n  //operators, defaultOperator - merge\n  //widgetProps (including valueLabel, valuePlaceholder, hideOperator, operatorInlineLabel) - concrete by widget\n  if (config.__extended) {\n    return config;\n  }\n\n  config.settings = (0, _merge[\"default\"])({}, _default.settings, config.settings);\n  config._fieldsCntByType = {};\n  config._funcsCntByType = {};\n  config.types = (0, _clone[\"default\"])(config.types);\n\n  _extendTypesConfig(config.types, config);\n\n  config.fields = (0, _clone[\"default\"])(config.fields);\n  config.__fieldNames = {};\n\n  _extendFieldsConfig(config.fields, config);\n\n  config.funcs = (0, _clone[\"default\"])(config.funcs);\n\n  _extendFuncArgsConfig(config.funcs, config);\n\n  _moment[\"default\"].locale(config.settings.locale.moment);\n\n  Object.defineProperty(config, \"__extended\", {\n    enumerable: false,\n    writable: false,\n    value: true\n  });\n  return config;\n};\n\nexports.extendConfig = extendConfig;\n\nfunction _extendTypesConfig(typesConfig, config) {\n  for (var type in typesConfig) {\n    var typeConfig = typesConfig[type];\n\n    _extendTypeConfig(type, typeConfig, config);\n  }\n}\n\nfunction _extendTypeConfig(type, typeConfig, config) {\n  var operators = null,\n      defaultOperator = null;\n  typeConfig.mainWidget = typeConfig.mainWidget || Object.keys(typeConfig.widgets).filter(function (w) {\n    return w != \"field\" && w != \"func\";\n  })[0];\n\n  for (var widget in typeConfig.widgets) {\n    var typeWidgetConfig = typeConfig.widgets[widget];\n\n    if (typeWidgetConfig.operators) {\n      var typeWidgetOperators = typeWidgetConfig.operators;\n\n      if (typeConfig.excludeOperators) {\n        typeWidgetOperators = typeWidgetOperators.filter(function (op) {\n          return !typeConfig.excludeOperators.includes(op);\n        });\n      }\n\n      operators = (0, _stuff.mergeArraysSmart)(operators, typeWidgetOperators);\n    }\n\n    if (typeWidgetConfig.defaultOperator) defaultOperator = typeWidgetConfig.defaultOperator;\n\n    if (widget == typeConfig.mainWidget) {\n      typeWidgetConfig = (0, _merge[\"default\"])({}, {\n        widgetProps: typeConfig.mainWidgetProps || {}\n      }, typeWidgetConfig);\n    }\n\n    typeConfig.widgets[widget] = typeWidgetConfig;\n  }\n\n  if (!typeConfig.valueSources) typeConfig.valueSources = Object.keys(config.settings.valueSourcesInfo);\n\n  var _iterator = _createForOfIteratorHelper(typeConfig.valueSources),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var valueSrc = _step.value;\n\n      if (valueSrc != \"value\" && !typeConfig.widgets[valueSrc]) {\n        typeConfig.widgets[valueSrc] = {};\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  if (!typeConfig.operators && operators) typeConfig.operators = Array.from(new Set(operators)); //unique\n\n  if (!typeConfig.defaultOperator && defaultOperator) typeConfig.defaultOperator = defaultOperator;\n}\n\nfunction _extendFieldsConfig(subconfig, config) {\n  var path = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n  for (var field in subconfig) {\n    _extendFieldConfig(subconfig[field], config, [].concat((0, _toConsumableArray2[\"default\"])(path), [field]));\n\n    if (subconfig[field].subfields) {\n      _extendFieldsConfig(subconfig[field].subfields, config, [].concat((0, _toConsumableArray2[\"default\"])(path), [field]));\n    }\n  }\n}\n\nfunction _extendFuncArgsConfig(subconfig, config) {\n  if (!subconfig) return;\n\n  for (var funcKey in subconfig) {\n    var funcDef = subconfig[funcKey];\n\n    if (funcDef.returnType) {\n      if (!config._funcsCntByType[funcDef.returnType]) config._funcsCntByType[funcDef.returnType] = 0;\n      config._funcsCntByType[funcDef.returnType]++;\n    }\n\n    for (var argKey in funcDef.args) {\n      _extendFieldConfig(funcDef.args[argKey], config, null, true);\n    } // isOptional can be only in the end\n\n\n    if (funcDef.args) {\n      var argKeys = Object.keys(funcDef.args);\n      var tmpIsOptional = true;\n\n      var _iterator2 = _createForOfIteratorHelper(argKeys.reverse()),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var _argKey = _step2.value;\n          var argDef = funcDef.args[_argKey];\n\n          if (!tmpIsOptional && argDef.isOptional) {\n            delete argDef.isOptional;\n          }\n\n          if (!argDef.isOptional) tmpIsOptional = false;\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n\n    if (funcDef.subfields) {\n      _extendFuncArgsConfig(funcDef.subfields, config);\n    }\n  }\n}\n\nfunction _extendFieldConfig(fieldConfig, config) {\n  var path = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var isFuncArg = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var operators = null,\n      defaultOperator = null;\n  var typeConfig = config.types[fieldConfig.type];\n  var excludeOperatorsForField = fieldConfig.excludeOperators || [];\n\n  if (fieldConfig.type != \"!struct\" && fieldConfig.type != \"!group\") {\n    if (!typeConfig) {\n      //console.warn(`No type config for ${fieldConfig.type}`);\n      fieldConfig.disabled = true;\n      return;\n    }\n\n    if (!isFuncArg) {\n      if (!config._fieldsCntByType[fieldConfig.type]) config._fieldsCntByType[fieldConfig.type] = 0;\n      config._fieldsCntByType[fieldConfig.type]++;\n    }\n\n    if (!fieldConfig.widgets) fieldConfig.widgets = {};\n    if (isFuncArg) fieldConfig._isFuncArg = true;\n    fieldConfig.mainWidget = fieldConfig.mainWidget || typeConfig.mainWidget;\n    fieldConfig.valueSources = fieldConfig.valueSources || typeConfig.valueSources;\n    var excludeOperatorsForType = typeConfig.excludeOperators || [];\n\n    for (var widget in typeConfig.widgets) {\n      var fieldWidgetConfig = fieldConfig.widgets[widget] || {};\n      var typeWidgetConfig = typeConfig.widgets[widget] || {};\n\n      if (!isFuncArg) {\n        (function () {\n          //todo: why I've excluded isFuncArg ?\n          var excludeOperators = [].concat((0, _toConsumableArray2[\"default\"])(excludeOperatorsForField), (0, _toConsumableArray2[\"default\"])(excludeOperatorsForType));\n          var shouldIncludeOperators = fieldConfig.preferWidgets && (widget == \"field\" || fieldConfig.preferWidgets.includes(widget)) || excludeOperators.length > 0;\n\n          if (fieldWidgetConfig.operators) {\n            var addOperators = fieldWidgetConfig.operators.filter(function (o) {\n              return !excludeOperators.includes(o);\n            });\n            operators = [].concat((0, _toConsumableArray2[\"default\"])(operators || []), (0, _toConsumableArray2[\"default\"])(addOperators));\n          } else if (shouldIncludeOperators && typeWidgetConfig.operators) {\n            var _addOperators = typeWidgetConfig.operators.filter(function (o) {\n              return !excludeOperators.includes(o);\n            });\n\n            operators = [].concat((0, _toConsumableArray2[\"default\"])(operators || []), (0, _toConsumableArray2[\"default\"])(_addOperators));\n          }\n\n          if (fieldWidgetConfig.defaultOperator) defaultOperator = fieldWidgetConfig.defaultOperator;\n        })();\n      }\n\n      if (widget == fieldConfig.mainWidget) {\n        fieldWidgetConfig = (0, _merge[\"default\"])({}, {\n          widgetProps: fieldConfig.mainWidgetProps || {}\n        }, fieldWidgetConfig);\n      }\n\n      fieldConfig.widgets[widget] = fieldWidgetConfig;\n    }\n\n    if (!isFuncArg) {\n      if (!fieldConfig.operators && operators) fieldConfig.operators = Array.from(new Set(operators));\n      if (!fieldConfig.defaultOperator && defaultOperator) fieldConfig.defaultOperator = defaultOperator;\n    }\n\n    var keysToPutInFieldSettings = [\"listValues\", \"allowCustomValues\", \"validateValue\"];\n    if (!fieldConfig.fieldSettings) fieldConfig.fieldSettings = {};\n\n    for (var _i = 0, _keysToPutInFieldSett = keysToPutInFieldSettings; _i < _keysToPutInFieldSett.length; _i++) {\n      var k = _keysToPutInFieldSett[_i];\n\n      if (fieldConfig[k]) {\n        fieldConfig.fieldSettings[k] = fieldConfig[k];\n        delete fieldConfig[k];\n      }\n    }\n\n    if (fieldConfig.fieldSettings.listValues) {\n      fieldConfig.fieldSettings.listValues = (0, _stuff.normalizeListValues)(fieldConfig.fieldSettings.listValues, fieldConfig.type, fieldConfig.fieldSettings);\n    }\n  }\n\n  var computedFieldName = computeFieldName(config, path);\n\n  if (computedFieldName) {\n    fieldConfig.fieldName = computedFieldName;\n  }\n\n  if (path && fieldConfig.fieldName) {\n    config.__fieldNames[fieldConfig.fieldName] = path;\n  }\n}\n\nvar getFieldRawConfig = function getFieldRawConfig(config, field) {\n  var fieldsKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"fields\";\n  var subfieldsKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"subfields\";\n  if (!field) return null;\n\n  if (field == \"!case_value\") {\n    return {\n      type: \"case_value\",\n      mainWidget: \"case_value\",\n      widgets: {\n        \"case_value\": config.widgets[\"case_value\"]\n      }\n    };\n  }\n\n  var fieldSeparator = config.settings.fieldSeparator; //field = normalizeField(config, field);\n\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var targetFields = config[fieldsKey];\n  if (!targetFields) return null;\n  var fields = targetFields;\n  var fieldConfig = null;\n  var path = [];\n\n  for (var i = 0; i < parts.length; i++) {\n    var part = parts[i];\n    path.push(part);\n    var pathKey = path.join(fieldSeparator);\n    fieldConfig = fields[pathKey];\n\n    if (i < parts.length - 1) {\n      if (fieldConfig && fieldConfig[subfieldsKey]) {\n        fields = fieldConfig[subfieldsKey];\n        path = [];\n      } else {\n        fieldConfig = null;\n      }\n    }\n  }\n\n  return fieldConfig;\n};\n\nexports.getFieldRawConfig = getFieldRawConfig;\n\nvar computeFieldName = function computeFieldName(config, path) {\n  if (!path) return null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var l = (0, _toConsumableArray2[\"default\"])(path),\n      r = [],\n      f,\n      fConfig;\n\n  while ((f = l.pop()) !== undefined && l.length > 0) {\n    r.unshift(f);\n    fConfig = getFieldRawConfig(config, l);\n\n    if (fConfig.fieldName) {\n      return [fConfig.fieldName].concat(r).join(fieldSeparator);\n    }\n  }\n\n  return null;\n};\n\nvar normalizeField = function normalizeField(config, field) {\n  var fieldSeparator = config.settings.fieldSeparator;\n  var fieldStr = Array.isArray(field) ? field.join(fieldSeparator) : field;\n\n  if (config.__fieldNames[fieldStr]) {\n    return config.__fieldNames[fieldStr].join(fieldSeparator);\n  }\n\n  return fieldStr;\n};\n\nexports.normalizeField = normalizeField;\n\nvar getFuncConfig = function getFuncConfig(config, func) {\n  if (!func) return null;\n  var funcConfig = getFieldRawConfig(config, func, \"funcs\", \"subfields\");\n  if (!funcConfig) return null; //throw new Error(\"Can't find func \" + func + \", please check your config\");\n\n  return funcConfig;\n};\n\nexports.getFuncConfig = getFuncConfig;\n\nvar getFuncArgConfig = function getFuncArgConfig(config, funcKey, argKey) {\n  var funcConfig = getFuncConfig(config, funcKey);\n  if (!funcConfig) return null; //throw new Error(`Can't find func ${funcKey}, please check your config`);\n\n  var argConfig = funcConfig.args && funcConfig.args[argKey] || null;\n  if (!argConfig) return null; //throw new Error(`Can't find arg ${argKey} for func ${funcKey}, please check your config`);\n  //merge, but don't merge operators (rewrite instead)\n\n  var typeConfig = config.types[argConfig.type] || {};\n  var ret = (0, _mergeWith[\"default\"])({}, typeConfig, argConfig || {}, function (objValue, srcValue, _key, _object, _source, _stack) {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n  return ret;\n};\n\nexports.getFuncArgConfig = getFuncArgConfig;\n\nvar getFieldConfig = function getFieldConfig(config, field) {\n  if (!field) return null;\n  if ((0, _typeof2[\"default\"])(field) == \"object\" && !field.func && !!field.type) return field;\n  if ((0, _typeof2[\"default\"])(field) == \"object\" && field.func && field.arg) return getFuncArgConfig(config, field.func, field.arg);\n  var fieldConfig = getFieldRawConfig(config, field);\n  if (!fieldConfig) return null; //throw new Error(\"Can't find field \" + field + \", please check your config\");\n  //merge, but don't merge operators (rewrite instead)\n\n  var typeConfig = config.types[fieldConfig.type] || {};\n  var ret = (0, _mergeWith[\"default\"])({}, typeConfig, fieldConfig || {}, function (objValue, srcValue, _key, _object, _source, _stack) {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n  return ret;\n};\n\nexports.getFieldConfig = getFieldConfig;\n\nvar getOperatorConfig = function getOperatorConfig(config, operator) {\n  var field = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  if (!operator) return null;\n  var opConfig = config.operators[operator];\n\n  if (field) {\n    var fieldConfig = getFieldConfig(config, field);\n    var widget = (0, _ruleUtils.getWidgetForFieldOp)(config, field, operator);\n    var widgetConfig = config.widgets[widget] || {};\n    var fieldWidgetConfig = (fieldConfig && fieldConfig.widgets ? fieldConfig.widgets[widget] : {}) || {};\n    var widgetOpProps = (widgetConfig.opProps || {})[operator];\n    var fieldWidgetOpProps = (fieldWidgetConfig.opProps || {})[operator];\n    var mergedOpConfig = (0, _merge[\"default\"])({}, opConfig, widgetOpProps, fieldWidgetOpProps);\n    return mergedOpConfig;\n  } else {\n    return opConfig;\n  }\n};\n\nexports.getOperatorConfig = getOperatorConfig;\n\nvar getFieldWidgetConfig = function getFieldWidgetConfig(config, field, operator) {\n  var widget = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var valueSrc = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n  if (!field) return null;\n  if (!(operator || widget) && valueSrc != \"const\" && field != \"!case_value\") return null;\n  var fieldConfig = getFieldConfig(config, field);\n  if (!widget) widget = (0, _ruleUtils.getWidgetForFieldOp)(config, field, operator, valueSrc);\n  var widgetConfig = config.widgets[widget] || {};\n  var fieldWidgetConfig = (fieldConfig && fieldConfig.widgets ? fieldConfig.widgets[widget] : {}) || {};\n  var fieldWidgetProps = fieldWidgetConfig.widgetProps || {};\n  var valueFieldSettings = (valueSrc == \"value\" || !valueSrc) && fieldConfig && fieldConfig.fieldSettings || {}; // useful to take 'validateValue'\n\n  var mergedConfig = (0, _merge[\"default\"])({}, widgetConfig, fieldWidgetProps, valueFieldSettings);\n  return mergedConfig;\n};\n\nexports.getFieldWidgetConfig = getFieldWidgetConfig;","map":{"version":3,"sources":["D:/LIMSWFH/LIMSPOSTGRESQL/QuaLISWeb/node_modules/react-awesome-query-builder/lib/utils/configUtils.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","normalizeField","getOperatorConfig","getFuncConfig","getFuncArgConfig","getFieldWidgetConfig","getFieldRawConfig","getFieldConfig","extendConfig","_typeof2","_toConsumableArray2","_merge","_mergeWith","_default","_moment","_stuff","_ruleUtils","_clone","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","minLen","_arrayLikeToArray","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","config","__extended","settings","_fieldsCntByType","_funcsCntByType","types","_extendTypesConfig","fields","__fieldNames","_extendFieldsConfig","funcs","_extendFuncArgsConfig","locale","moment","enumerable","writable","typesConfig","type","typeConfig","_extendTypeConfig","operators","defaultOperator","mainWidget","keys","widgets","filter","w","widget","typeWidgetConfig","typeWidgetOperators","excludeOperators","op","includes","mergeArraysSmart","widgetProps","mainWidgetProps","valueSources","valueSourcesInfo","_iterator","_step","valueSrc","Set","subconfig","path","arguments","undefined","field","_extendFieldConfig","concat","subfields","funcKey","funcDef","returnType","argKey","args","argKeys","tmpIsOptional","_iterator2","reverse","_step2","_argKey","argDef","isOptional","fieldConfig","isFuncArg","excludeOperatorsForField","disabled","_isFuncArg","excludeOperatorsForType","fieldWidgetConfig","shouldIncludeOperators","preferWidgets","addOperators","_addOperators","keysToPutInFieldSettings","fieldSettings","_i","_keysToPutInFieldSett","k","listValues","normalizeListValues","computedFieldName","computeFieldName","fieldName","fieldsKey","subfieldsKey","fieldSeparator","parts","split","targetFields","part","push","pathKey","join","l","r","fConfig","pop","unshift","fieldStr","func","funcConfig","argConfig","ret","objValue","srcValue","_key","_object","_source","_stack","arg","operator","opConfig","getWidgetForFieldOp","widgetConfig","widgetOpProps","opProps","fieldWidgetOpProps","mergedOpConfig","fieldWidgetProps","valueFieldSettings","mergedConfig"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.normalizeField = exports.getOperatorConfig = exports.getFuncConfig = exports.getFuncArgConfig = exports.getFieldWidgetConfig = exports.getFieldRawConfig = exports.getFieldConfig = exports.extendConfig = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _merge = _interopRequireDefault(require(\"lodash/merge\"));\n\nvar _mergeWith = _interopRequireDefault(require(\"lodash/mergeWith\"));\n\nvar _default = require(\"../config/default\");\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _stuff = require(\"./stuff\");\n\nvar _ruleUtils = require(\"./ruleUtils\");\n\nvar _clone = _interopRequireDefault(require(\"clone\"));\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar extendConfig = function extendConfig(config) {\n  //operators, defaultOperator - merge\n  //widgetProps (including valueLabel, valuePlaceholder, hideOperator, operatorInlineLabel) - concrete by widget\n  if (config.__extended) {\n    return config;\n  }\n\n  config.settings = (0, _merge[\"default\"])({}, _default.settings, config.settings);\n  config._fieldsCntByType = {};\n  config._funcsCntByType = {};\n  config.types = (0, _clone[\"default\"])(config.types);\n\n  _extendTypesConfig(config.types, config);\n\n  config.fields = (0, _clone[\"default\"])(config.fields);\n  config.__fieldNames = {};\n\n  _extendFieldsConfig(config.fields, config);\n\n  config.funcs = (0, _clone[\"default\"])(config.funcs);\n\n  _extendFuncArgsConfig(config.funcs, config);\n\n  _moment[\"default\"].locale(config.settings.locale.moment);\n\n  Object.defineProperty(config, \"__extended\", {\n    enumerable: false,\n    writable: false,\n    value: true\n  });\n  return config;\n};\n\nexports.extendConfig = extendConfig;\n\nfunction _extendTypesConfig(typesConfig, config) {\n  for (var type in typesConfig) {\n    var typeConfig = typesConfig[type];\n\n    _extendTypeConfig(type, typeConfig, config);\n  }\n}\n\nfunction _extendTypeConfig(type, typeConfig, config) {\n  var operators = null,\n      defaultOperator = null;\n  typeConfig.mainWidget = typeConfig.mainWidget || Object.keys(typeConfig.widgets).filter(function (w) {\n    return w != \"field\" && w != \"func\";\n  })[0];\n\n  for (var widget in typeConfig.widgets) {\n    var typeWidgetConfig = typeConfig.widgets[widget];\n\n    if (typeWidgetConfig.operators) {\n      var typeWidgetOperators = typeWidgetConfig.operators;\n\n      if (typeConfig.excludeOperators) {\n        typeWidgetOperators = typeWidgetOperators.filter(function (op) {\n          return !typeConfig.excludeOperators.includes(op);\n        });\n      }\n\n      operators = (0, _stuff.mergeArraysSmart)(operators, typeWidgetOperators);\n    }\n\n    if (typeWidgetConfig.defaultOperator) defaultOperator = typeWidgetConfig.defaultOperator;\n\n    if (widget == typeConfig.mainWidget) {\n      typeWidgetConfig = (0, _merge[\"default\"])({}, {\n        widgetProps: typeConfig.mainWidgetProps || {}\n      }, typeWidgetConfig);\n    }\n\n    typeConfig.widgets[widget] = typeWidgetConfig;\n  }\n\n  if (!typeConfig.valueSources) typeConfig.valueSources = Object.keys(config.settings.valueSourcesInfo);\n\n  var _iterator = _createForOfIteratorHelper(typeConfig.valueSources),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var valueSrc = _step.value;\n\n      if (valueSrc != \"value\" && !typeConfig.widgets[valueSrc]) {\n        typeConfig.widgets[valueSrc] = {};\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  if (!typeConfig.operators && operators) typeConfig.operators = Array.from(new Set(operators)); //unique\n\n  if (!typeConfig.defaultOperator && defaultOperator) typeConfig.defaultOperator = defaultOperator;\n}\n\nfunction _extendFieldsConfig(subconfig, config) {\n  var path = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n  for (var field in subconfig) {\n    _extendFieldConfig(subconfig[field], config, [].concat((0, _toConsumableArray2[\"default\"])(path), [field]));\n\n    if (subconfig[field].subfields) {\n      _extendFieldsConfig(subconfig[field].subfields, config, [].concat((0, _toConsumableArray2[\"default\"])(path), [field]));\n    }\n  }\n}\n\nfunction _extendFuncArgsConfig(subconfig, config) {\n  if (!subconfig) return;\n\n  for (var funcKey in subconfig) {\n    var funcDef = subconfig[funcKey];\n\n    if (funcDef.returnType) {\n      if (!config._funcsCntByType[funcDef.returnType]) config._funcsCntByType[funcDef.returnType] = 0;\n      config._funcsCntByType[funcDef.returnType]++;\n    }\n\n    for (var argKey in funcDef.args) {\n      _extendFieldConfig(funcDef.args[argKey], config, null, true);\n    } // isOptional can be only in the end\n\n\n    if (funcDef.args) {\n      var argKeys = Object.keys(funcDef.args);\n      var tmpIsOptional = true;\n\n      var _iterator2 = _createForOfIteratorHelper(argKeys.reverse()),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var _argKey = _step2.value;\n          var argDef = funcDef.args[_argKey];\n\n          if (!tmpIsOptional && argDef.isOptional) {\n            delete argDef.isOptional;\n          }\n\n          if (!argDef.isOptional) tmpIsOptional = false;\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n\n    if (funcDef.subfields) {\n      _extendFuncArgsConfig(funcDef.subfields, config);\n    }\n  }\n}\n\nfunction _extendFieldConfig(fieldConfig, config) {\n  var path = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var isFuncArg = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var operators = null,\n      defaultOperator = null;\n  var typeConfig = config.types[fieldConfig.type];\n  var excludeOperatorsForField = fieldConfig.excludeOperators || [];\n\n  if (fieldConfig.type != \"!struct\" && fieldConfig.type != \"!group\") {\n    if (!typeConfig) {\n      //console.warn(`No type config for ${fieldConfig.type}`);\n      fieldConfig.disabled = true;\n      return;\n    }\n\n    if (!isFuncArg) {\n      if (!config._fieldsCntByType[fieldConfig.type]) config._fieldsCntByType[fieldConfig.type] = 0;\n      config._fieldsCntByType[fieldConfig.type]++;\n    }\n\n    if (!fieldConfig.widgets) fieldConfig.widgets = {};\n    if (isFuncArg) fieldConfig._isFuncArg = true;\n    fieldConfig.mainWidget = fieldConfig.mainWidget || typeConfig.mainWidget;\n    fieldConfig.valueSources = fieldConfig.valueSources || typeConfig.valueSources;\n    var excludeOperatorsForType = typeConfig.excludeOperators || [];\n\n    for (var widget in typeConfig.widgets) {\n      var fieldWidgetConfig = fieldConfig.widgets[widget] || {};\n      var typeWidgetConfig = typeConfig.widgets[widget] || {};\n\n      if (!isFuncArg) {\n        (function () {\n          //todo: why I've excluded isFuncArg ?\n          var excludeOperators = [].concat((0, _toConsumableArray2[\"default\"])(excludeOperatorsForField), (0, _toConsumableArray2[\"default\"])(excludeOperatorsForType));\n          var shouldIncludeOperators = fieldConfig.preferWidgets && (widget == \"field\" || fieldConfig.preferWidgets.includes(widget)) || excludeOperators.length > 0;\n\n          if (fieldWidgetConfig.operators) {\n            var addOperators = fieldWidgetConfig.operators.filter(function (o) {\n              return !excludeOperators.includes(o);\n            });\n            operators = [].concat((0, _toConsumableArray2[\"default\"])(operators || []), (0, _toConsumableArray2[\"default\"])(addOperators));\n          } else if (shouldIncludeOperators && typeWidgetConfig.operators) {\n            var _addOperators = typeWidgetConfig.operators.filter(function (o) {\n              return !excludeOperators.includes(o);\n            });\n\n            operators = [].concat((0, _toConsumableArray2[\"default\"])(operators || []), (0, _toConsumableArray2[\"default\"])(_addOperators));\n          }\n\n          if (fieldWidgetConfig.defaultOperator) defaultOperator = fieldWidgetConfig.defaultOperator;\n        })();\n      }\n\n      if (widget == fieldConfig.mainWidget) {\n        fieldWidgetConfig = (0, _merge[\"default\"])({}, {\n          widgetProps: fieldConfig.mainWidgetProps || {}\n        }, fieldWidgetConfig);\n      }\n\n      fieldConfig.widgets[widget] = fieldWidgetConfig;\n    }\n\n    if (!isFuncArg) {\n      if (!fieldConfig.operators && operators) fieldConfig.operators = Array.from(new Set(operators));\n      if (!fieldConfig.defaultOperator && defaultOperator) fieldConfig.defaultOperator = defaultOperator;\n    }\n\n    var keysToPutInFieldSettings = [\"listValues\", \"allowCustomValues\", \"validateValue\"];\n    if (!fieldConfig.fieldSettings) fieldConfig.fieldSettings = {};\n\n    for (var _i = 0, _keysToPutInFieldSett = keysToPutInFieldSettings; _i < _keysToPutInFieldSett.length; _i++) {\n      var k = _keysToPutInFieldSett[_i];\n\n      if (fieldConfig[k]) {\n        fieldConfig.fieldSettings[k] = fieldConfig[k];\n        delete fieldConfig[k];\n      }\n    }\n\n    if (fieldConfig.fieldSettings.listValues) {\n      fieldConfig.fieldSettings.listValues = (0, _stuff.normalizeListValues)(fieldConfig.fieldSettings.listValues, fieldConfig.type, fieldConfig.fieldSettings);\n    }\n  }\n\n  var computedFieldName = computeFieldName(config, path);\n\n  if (computedFieldName) {\n    fieldConfig.fieldName = computedFieldName;\n  }\n\n  if (path && fieldConfig.fieldName) {\n    config.__fieldNames[fieldConfig.fieldName] = path;\n  }\n}\n\nvar getFieldRawConfig = function getFieldRawConfig(config, field) {\n  var fieldsKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"fields\";\n  var subfieldsKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"subfields\";\n  if (!field) return null;\n\n  if (field == \"!case_value\") {\n    return {\n      type: \"case_value\",\n      mainWidget: \"case_value\",\n      widgets: {\n        \"case_value\": config.widgets[\"case_value\"]\n      }\n    };\n  }\n\n  var fieldSeparator = config.settings.fieldSeparator; //field = normalizeField(config, field);\n\n  var parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  var targetFields = config[fieldsKey];\n  if (!targetFields) return null;\n  var fields = targetFields;\n  var fieldConfig = null;\n  var path = [];\n\n  for (var i = 0; i < parts.length; i++) {\n    var part = parts[i];\n    path.push(part);\n    var pathKey = path.join(fieldSeparator);\n    fieldConfig = fields[pathKey];\n\n    if (i < parts.length - 1) {\n      if (fieldConfig && fieldConfig[subfieldsKey]) {\n        fields = fieldConfig[subfieldsKey];\n        path = [];\n      } else {\n        fieldConfig = null;\n      }\n    }\n  }\n\n  return fieldConfig;\n};\n\nexports.getFieldRawConfig = getFieldRawConfig;\n\nvar computeFieldName = function computeFieldName(config, path) {\n  if (!path) return null;\n  var fieldSeparator = config.settings.fieldSeparator;\n  var l = (0, _toConsumableArray2[\"default\"])(path),\n      r = [],\n      f,\n      fConfig;\n\n  while ((f = l.pop()) !== undefined && l.length > 0) {\n    r.unshift(f);\n    fConfig = getFieldRawConfig(config, l);\n\n    if (fConfig.fieldName) {\n      return [fConfig.fieldName].concat(r).join(fieldSeparator);\n    }\n  }\n\n  return null;\n};\n\nvar normalizeField = function normalizeField(config, field) {\n  var fieldSeparator = config.settings.fieldSeparator;\n  var fieldStr = Array.isArray(field) ? field.join(fieldSeparator) : field;\n\n  if (config.__fieldNames[fieldStr]) {\n    return config.__fieldNames[fieldStr].join(fieldSeparator);\n  }\n\n  return fieldStr;\n};\n\nexports.normalizeField = normalizeField;\n\nvar getFuncConfig = function getFuncConfig(config, func) {\n  if (!func) return null;\n  var funcConfig = getFieldRawConfig(config, func, \"funcs\", \"subfields\");\n  if (!funcConfig) return null; //throw new Error(\"Can't find func \" + func + \", please check your config\");\n\n  return funcConfig;\n};\n\nexports.getFuncConfig = getFuncConfig;\n\nvar getFuncArgConfig = function getFuncArgConfig(config, funcKey, argKey) {\n  var funcConfig = getFuncConfig(config, funcKey);\n  if (!funcConfig) return null; //throw new Error(`Can't find func ${funcKey}, please check your config`);\n\n  var argConfig = funcConfig.args && funcConfig.args[argKey] || null;\n  if (!argConfig) return null; //throw new Error(`Can't find arg ${argKey} for func ${funcKey}, please check your config`);\n  //merge, but don't merge operators (rewrite instead)\n\n  var typeConfig = config.types[argConfig.type] || {};\n  var ret = (0, _mergeWith[\"default\"])({}, typeConfig, argConfig || {}, function (objValue, srcValue, _key, _object, _source, _stack) {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n  return ret;\n};\n\nexports.getFuncArgConfig = getFuncArgConfig;\n\nvar getFieldConfig = function getFieldConfig(config, field) {\n  if (!field) return null;\n  if ((0, _typeof2[\"default\"])(field) == \"object\" && !field.func && !!field.type) return field;\n  if ((0, _typeof2[\"default\"])(field) == \"object\" && field.func && field.arg) return getFuncArgConfig(config, field.func, field.arg);\n  var fieldConfig = getFieldRawConfig(config, field);\n  if (!fieldConfig) return null; //throw new Error(\"Can't find field \" + field + \", please check your config\");\n  //merge, but don't merge operators (rewrite instead)\n\n  var typeConfig = config.types[fieldConfig.type] || {};\n  var ret = (0, _mergeWith[\"default\"])({}, typeConfig, fieldConfig || {}, function (objValue, srcValue, _key, _object, _source, _stack) {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n  return ret;\n};\n\nexports.getFieldConfig = getFieldConfig;\n\nvar getOperatorConfig = function getOperatorConfig(config, operator) {\n  var field = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  if (!operator) return null;\n  var opConfig = config.operators[operator];\n\n  if (field) {\n    var fieldConfig = getFieldConfig(config, field);\n    var widget = (0, _ruleUtils.getWidgetForFieldOp)(config, field, operator);\n    var widgetConfig = config.widgets[widget] || {};\n    var fieldWidgetConfig = (fieldConfig && fieldConfig.widgets ? fieldConfig.widgets[widget] : {}) || {};\n    var widgetOpProps = (widgetConfig.opProps || {})[operator];\n    var fieldWidgetOpProps = (fieldWidgetConfig.opProps || {})[operator];\n    var mergedOpConfig = (0, _merge[\"default\"])({}, opConfig, widgetOpProps, fieldWidgetOpProps);\n    return mergedOpConfig;\n  } else {\n    return opConfig;\n  }\n};\n\nexports.getOperatorConfig = getOperatorConfig;\n\nvar getFieldWidgetConfig = function getFieldWidgetConfig(config, field, operator) {\n  var widget = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var valueSrc = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n  if (!field) return null;\n  if (!(operator || widget) && valueSrc != \"const\" && field != \"!case_value\") return null;\n  var fieldConfig = getFieldConfig(config, field);\n  if (!widget) widget = (0, _ruleUtils.getWidgetForFieldOp)(config, field, operator, valueSrc);\n  var widgetConfig = config.widgets[widget] || {};\n  var fieldWidgetConfig = (fieldConfig && fieldConfig.widgets ? fieldConfig.widgets[widget] : {}) || {};\n  var fieldWidgetProps = fieldWidgetConfig.widgetProps || {};\n  var valueFieldSettings = (valueSrc == \"value\" || !valueSrc) && fieldConfig && fieldConfig.fieldSettings || {}; // useful to take 'validateValue'\n\n  var mergedConfig = (0, _merge[\"default\"])({}, widgetConfig, fieldWidgetProps, valueFieldSettings);\n  return mergedConfig;\n};\n\nexports.getFieldWidgetConfig = getFieldWidgetConfig;"]},"metadata":{},"sourceType":"script"}