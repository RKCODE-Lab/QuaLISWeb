{"ast":null,"code":"import rsapi from \"../rsapi\";\nimport { toast } from \"react-toastify\";\nimport { DEFAULT_RETURN } from \"./LoginTypes\";\nimport Axios from \"axios\";\nimport { initRequest, updateStore } from \"./LoginAction\";\nimport { transactionStatus } from \"../components/Enumeration\";\nimport { constructOptionList, showEsign } from \"../components/CommonScript\";\nimport { crudMaster } from './ServiceAction';\nimport { intl } from \"../components/App\";\nexport function getCommentsCombo(inputParam) {\n  return dispatch => {\n    if (inputParam.masterList && inputParam.masterList.length > 0) {\n      dispatch(initRequest(true));\n      let urlArray = [rsapi.post(\"/sampletestcomments/getSampleTestComments\", {\n        userinfo: inputParam.userInfo\n      })];\n      urlArray.push(rsapi.post(\"/comments/getCommentSubType\", {\n        userinfo: inputParam.userInfo,\n        ncommentsubtypecode: inputParam.editRow && inputParam.editRow.jsondata && inputParam.editRow.jsondata.ncommentsubtypecode && inputParam.editRow.jsondata.ncommentsubtypecode.value\n      })); // if(inputParam.isSampleTestComment&&inputParam.isSampleTestComment===true) \n      // {\n      //  urlArray.push(\n      //      rsapi.post(\"/comments/getSampleTestCommentsListById\", {\n      //          ncommentsubtypecode:inputParam.ncommentsubtypecode,\n      //          userinfo: inputParam.userInfo\n      //      }))\n      // }     \n\n      if (inputParam.operation === \"update\") {\n        urlArray.push(rsapi.post(\"/comments/getEdit\".concat(inputParam.methodUrl), {\n          userinfo: inputParam.userInfo,\n          selectedrecord: inputParam.editRow\n        }));\n      }\n\n      Axios.all(urlArray).then(response => {\n        let predefcomments;\n        let sampleTestComments = response[0].data;\n        let CommentSubType = response[1].data['CommentSubType'];\n        let isAbbrevationneeded;\n        let selectedId = null;\n        let selectedRecord = {};\n        const defaultLink = sampleTestComments.filter(item => item.ndefaultstatus === transactionStatus.YES);\n        const sampleTestCommentsMap = constructOptionList(sampleTestComments || [], \"nsampletestcommentcode\", \"ssampletestcommentname\", undefined, undefined, true);\n        const CommentSubTypesMap = constructOptionList(CommentSubType || [], \"ncommentsubtypecode\", \"scommentsubtype\", undefined, undefined, false);\n        sampleTestComments = sampleTestCommentsMap.get(\"OptionList\");\n        CommentSubType = CommentSubTypesMap.get(\"OptionList\"); // ALPD-4948 Commented because NA value for comment sub type and predefined comments not showing. Instead of showing '-' in jsondata\n        // if(inputParam.isSampleTestComment&&inputParam.isSampleTestComment===true)\n        // {\n\n        predefcomments = response[1].data['SampleTestComments'];\n        const predefcommentssMap = constructOptionList(predefcomments || [], \"nsampletestcommentscode\", \"spredefinedname\", undefined, undefined, false);\n        predefcomments = predefcommentssMap.get(\"OptionList\");\n\n        if (CommentSubType[0].value === 3) {\n          isAbbrevationneeded = true;\n        }\n\n        selectedRecord = { ...inputParam.selectedRecord,\n          ncommentsubtypecode: CommentSubType[0],\n          nsampletestcommentscode: predefcomments[0] && predefcomments[0],\n          spredefinedname: predefcomments[0] && predefcomments[0].label,\n          scomments: predefcomments[0] && predefcomments[0].item.sdescription\n        }; // } \n\n        let editObject = {};\n\n        if (inputParam.operation === \"update\") {\n          editObject = response[2].data;\n          let nsamplecommentscode = {};\n          nsamplecommentscode = {\n            \"label\": editObject.ssampletestcommentname,\n            \"value\": editObject.nsamplecommentscode\n          };\n          selectedRecord = { ...editObject,\n            nsamplecommentscode,\n            scomments: editObject.jsondata.scomments,\n            scommentsubtype: editObject.jsondata.scommentsubtype && editObject.jsondata.scommentsubtype,\n            spredefinedname: editObject.jsondata.spredefinedname && editObject.jsondata.spredefinedname,\n            // scomments: editObject.jsondata.sdescription&&editObject.jsondata.sdescription, \n            ncommentsubtypecode: editObject.jsondata.ncommentsubtypecode && editObject.jsondata.ncommentsubtypecode,\n            nsampletestcommentscode: editObject.jsondata.nsampletestcommentscode && editObject.jsondata.nsampletestcommentscode\n          };\n          selectedId = inputParam.screenName === \"IDS_TESTCOMMENTS\" ? inputParam.editRow.ntestcommentcode : inputParam.screenName === \"IDS_SUBSAMPLECOMMENTS\" ? inputParam.editRow.nsamplecommentcode : inputParam.screenName === \"IDS_SAMPLECOMMENTS\" ? inputParam.editRow.nregcommentcode : null;\n        } else {\n          selectedRecord = { ...selectedRecord,\n            nsamplecommentscode: defaultLink.length > 0 ? {\n              \"label\": defaultLink[0].ssampletestcommentname,\n              \"value\": defaultLink[0].nsampletestcommentcode\n            } : \"\"\n          };\n        }\n\n        dispatch({\n          type: DEFAULT_RETURN,\n          payload: {\n            [inputParam.modalName]: true,\n            operation: inputParam.operation,\n            screenName: inputParam.screenName,\n            ncontrolCode: inputParam.ncontrolCode,\n            selectedRecord,\n            loading: false,\n            sampleTestComments,\n            predefcomments,\n            CommentSubType,\n            isAbbrevationneeded,\n            modalType: 'comment',\n            modalName: [inputParam.modalName],\n            editObject,\n            selectedId //  isSampleTestComment:inputParam.isSampleTestComment\n\n          }\n        });\n      }).catch(error => {\n        dispatch({\n          type: DEFAULT_RETURN,\n          payload: {\n            loading: false\n          }\n        });\n\n        if (error.response.status === 500) {\n          toast.error(error.message);\n        } else {\n          toast.warn(error.response.data);\n        }\n      });\n    } else {\n      toast.warn(intl.formatMessage({\n        id: inputParam.masterAlertStatus\n      }));\n    }\n  };\n}\nexport function deleteComment(deleteParam) {\n  return dispatch => {\n    const methodUrl = deleteParam.methodUrl;\n    const selected = deleteParam.selectedRecord;\n    const Map = {};\n    Map[\"sprimarykey\"] = deleteParam.screenName === \"IDS_SAMPLECOMMENTS\" ? \"nregcommentcode\" : deleteParam.screenName === \"IDS_SUBSAMPLECOMMENTS\" ? \"nsamplecommentcode\" : \"ntestcommentcode\";\n    Map[\"nprimarykey\"] = deleteParam.screenName === \"IDS_SAMPLECOMMENTS\" ? selected.nregcommentcode : deleteParam.screenName === \"IDS_SUBSAMPLECOMMENTS\" ? selected.nsamplecommentcode : selected.ntestcommentcode;\n    const inputParam = {\n      inputData: {\n        [methodUrl.toLowerCase()]: {\n          [Map.sprimarykey]: Map.nprimarykey\n        },\n        npreregno: deleteParam.npreregno,\n        ntransactiontestcode: deleteParam.ntransactiontestcode,\n        ntransactionsamplecode: deleteParam.ntransactionsamplecode,\n        userinfo: deleteParam.userInfo\n      },\n      classUrl: \"comments\",\n      operation: 'delete',\n      methodUrl: methodUrl,\n      screenName: deleteParam.screenName\n    };\n    const masterData = deleteParam.masterData;\n\n    if (showEsign(deleteParam.esignRights, deleteParam.userInfo.nformcode, deleteParam.ncontrolCode)) {\n      // dispatch({\n      //     type: DEFAULT_RETURN,\n      //     payload: {\n      //         loadEsign: true,\n      //         screenData: { inputParam, masterData },\n      //         openCommentModal: true,\n      //         screenName: deleteParam.screenName,\n      //         operation: 'delete',\n      //         selectedRecord: {}\n      //     }\n      // });\n      const updateInfo = {\n        typeName: DEFAULT_RETURN,\n        data: {\n          loadEsign: true,\n          screenData: {\n            inputParam,\n            masterData\n          },\n          openCommentModal: true,\n          screenName: deleteParam.screenName,\n          operation: 'delete',\n          selectedRecord: {},\n          selectedId: null\n        }\n      };\n      dispatch(updateStore(updateInfo));\n    } else {\n      dispatch(crudMaster(inputParam, masterData, \"openCommentModal\", {}));\n    }\n  };\n}\nexport function getSampleTestComments(selectedRecord, userInfo) {\n  return function (dispatch) {\n    dispatch(initRequest(true));\n    rsapi.post(\"/comments/getSampleTestCommentsListById\", {\n      userinfo: userInfo,\n      ncommentsubtypecode: selectedRecord['ncommentsubtypecode'].value\n    }).then(response => {\n      let predefcomments;\n      let isAbbrevationneeded;\n      predefcomments = response.data['SampleTestComments'];\n\n      if (selectedRecord['ncommentsubtypecode'].value === 3) {\n        const predefcommentssMap = constructOptionList(predefcomments || [], \"nsampletestcommentscode\", \"spredefinedname\", undefined, undefined, false);\n        isAbbrevationneeded = true;\n        predefcomments = predefcommentssMap.get(\"OptionList\");\n        selectedRecord = { ...selectedRecord,\n          nsampletestcommentscode: predefcomments[0] && predefcomments[0],\n          scomments: predefcomments[0] && predefcomments[0].item && predefcomments[0].item.sdescription\n        };\n      } else {\n        selectedRecord['nsampletestcommentscode'] && delete selectedRecord['nsampletestcommentscode'];\n        selectedRecord = { ...selectedRecord,\n          scomments: predefcomments[0] && predefcomments[0].sdescription\n        };\n      }\n\n      dispatch({\n        type: DEFAULT_RETURN,\n        payload: {\n          selectedRecord,\n          predefcomments,\n          isAbbrevationneeded,\n          loading: false\n        }\n      });\n    }).catch(error => {\n      dispatch({\n        type: DEFAULT_RETURN,\n        payload: {\n          loading: false\n        }\n      });\n\n      if (error.response.status === 500) {\n        toast.error(error.message);\n      } else {\n        toast.warn(error.response.data);\n      }\n    });\n  };\n}\nexport function getSampleTestCommentsDesc(selectedRecord, userInfo) {\n  return function (dispatch) {\n    dispatch(initRequest(true));\n    rsapi.post(\"/comments/getSampleTestCommentsDescById\", {\n      userinfo: userInfo,\n      ncommentsubtypecode: selectedRecord['ncommentsubtypecode'].value,\n      spredefinedname: selectedRecord['nsampletestcommentscode'].label\n    }).then(response => {\n      let predefcomments;\n      predefcomments = response.data['SampleTestComments'];\n      selectedRecord = { ...selectedRecord,\n        scomments: predefcomments[0] && predefcomments[0].sdescription\n      };\n      dispatch({\n        type: DEFAULT_RETURN,\n        payload: {\n          selectedRecord,\n          loading: false\n        }\n      });\n    }).catch(error => {\n      dispatch({\n        type: DEFAULT_RETURN,\n        payload: {\n          loading: false\n        }\n      });\n\n      if (error.response.status === 500) {\n        toast.error(error.message);\n      } else {\n        toast.warn(error.response.data);\n      }\n    });\n  };\n}","map":{"version":3,"sources":["E:/WorkingFolder/React_Postgres/ALPD/branches/SOURCE-513-PROD/SOURCE-513-ALPD-5500/QuaLISWeb/src/actions/CommentsAction.js"],"names":["rsapi","toast","DEFAULT_RETURN","Axios","initRequest","updateStore","transactionStatus","constructOptionList","showEsign","crudMaster","intl","getCommentsCombo","inputParam","dispatch","masterList","length","urlArray","post","userinfo","userInfo","push","ncommentsubtypecode","editRow","jsondata","value","operation","concat","methodUrl","selectedrecord","all","then","response","predefcomments","sampleTestComments","data","CommentSubType","isAbbrevationneeded","selectedId","selectedRecord","defaultLink","filter","item","ndefaultstatus","YES","sampleTestCommentsMap","undefined","CommentSubTypesMap","get","predefcommentssMap","nsampletestcommentscode","spredefinedname","label","scomments","sdescription","editObject","nsamplecommentscode","ssampletestcommentname","scommentsubtype","screenName","ntestcommentcode","nsamplecommentcode","nregcommentcode","nsampletestcommentcode","type","payload","modalName","ncontrolCode","loading","modalType","catch","error","status","message","warn","formatMessage","id","masterAlertStatus","deleteComment","deleteParam","selected","Map","inputData","toLowerCase","sprimarykey","nprimarykey","npreregno","ntransactiontestcode","ntransactionsamplecode","classUrl","masterData","esignRights","nformcode","updateInfo","typeName","loadEsign","screenData","openCommentModal","getSampleTestComments","getSampleTestCommentsDesc"],"mappings":"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","sourcesContent":["import rsapi from \"../rsapi\";\r\nimport { toast } from \"react-toastify\";\r\nimport { DEFAULT_RETURN } from \"./LoginTypes\";\r\nimport Axios from \"axios\";\r\nimport { initRequest, updateStore } from \"./LoginAction\";\r\nimport { transactionStatus } from \"../components/Enumeration\";\r\nimport { constructOptionList, showEsign } from \"../components/CommonScript\";\r\nimport { crudMaster } from './ServiceAction'\r\nimport { intl } from \"../components/App\";\r\n\r\nexport function getCommentsCombo(inputParam) {\r\n    return (dispatch) => {\r\n        if (inputParam.masterList && inputParam.masterList.length > 0) {\r\n            dispatch(initRequest(true));\r\n            let urlArray = [rsapi.post(\"/sampletestcomments/getSampleTestComments\", { userinfo: inputParam.userInfo })];\r\n            urlArray.push(\r\n                rsapi.post(\"/comments/getCommentSubType\", {\r\n                    userinfo: inputParam.userInfo, ncommentsubtypecode: inputParam.editRow && inputParam.editRow.jsondata && inputParam.editRow.jsondata.ncommentsubtypecode && inputParam.editRow.jsondata.ncommentsubtypecode.value\r\n                })) \r\n                // if(inputParam.isSampleTestComment&&inputParam.isSampleTestComment===true) \r\n                // {\r\n                //  urlArray.push(\r\n                //      rsapi.post(\"/comments/getSampleTestCommentsListById\", {\r\n                //          ncommentsubtypecode:inputParam.ncommentsubtypecode,\r\n                //          userinfo: inputParam.userInfo\r\n                //      }))\r\n                // }     \r\n            if (inputParam.operation === \"update\") {\r\n                urlArray.push(rsapi.post(\"/comments/getEdit\".concat(inputParam.methodUrl), { userinfo: inputParam.userInfo, selectedrecord: inputParam.editRow }))\r\n            }\r\n            Axios.all(urlArray)\r\n                .then(response => {\r\n                    let predefcomments;\r\n                    let sampleTestComments = response[0].data;\r\n                    let CommentSubType = response[1].data['CommentSubType']; \r\n                    let isAbbrevationneeded;\r\n                    let selectedId = null;\r\n\r\n                    let selectedRecord = {};\r\n                    const defaultLink = sampleTestComments.filter(item => item.ndefaultstatus === transactionStatus.YES);\r\n                    const sampleTestCommentsMap  = constructOptionList(sampleTestComments || [], \"nsampletestcommentcode\",\"ssampletestcommentname\" , undefined, undefined, true);\r\n                    const CommentSubTypesMap  = constructOptionList(CommentSubType || [], \"ncommentsubtypecode\",\"scommentsubtype\" , undefined, undefined, false);\r\n                    sampleTestComments = sampleTestCommentsMap.get(\"OptionList\");\r\n                    CommentSubType = CommentSubTypesMap.get(\"OptionList\");\r\n                    // ALPD-4948 Commented because NA value for comment sub type and predefined comments not showing. Instead of showing '-' in jsondata\r\n                    // if(inputParam.isSampleTestComment&&inputParam.isSampleTestComment===true)\r\n                    // {\r\n                         predefcomments = response[1].data['SampleTestComments']; \r\n\r\n                        const predefcommentssMap  = constructOptionList(predefcomments || [], \"nsampletestcommentscode\",\"spredefinedname\" , undefined, undefined, false);\r\n                    \r\n                        predefcomments = predefcommentssMap.get(\"OptionList\"); \r\n                        if(CommentSubType[0].value===3)\r\n                        {\r\n                            isAbbrevationneeded=true\r\n                        }\r\n\r\n                        selectedRecord={...inputParam.selectedRecord,ncommentsubtypecode:CommentSubType[0],\r\n                            nsampletestcommentscode:predefcomments[0]&&predefcomments[0],spredefinedname:predefcomments[0]&&predefcomments[0].label\r\n                            ,scomments:predefcomments[0]&&predefcomments[0].item.sdescription} \r\n                    // } \r\n               \r\n\r\n                    let editObject = {};\r\n                    if (inputParam.operation === \"update\") {\r\n                        editObject =  response[2].data;\r\n                        let nsamplecommentscode = {};\r\n                        nsamplecommentscode = { \"label\": editObject.ssampletestcommentname, \"value\": editObject.nsamplecommentscode }\r\n                        selectedRecord = {\r\n                            ...editObject, nsamplecommentscode,scomments :editObject.jsondata.scomments,  \r\n                            scommentsubtype:editObject.jsondata.scommentsubtype&&editObject.jsondata.scommentsubtype ,\r\n                            spredefinedname:editObject.jsondata.spredefinedname&&editObject.jsondata.spredefinedname ,\r\n                           // scomments: editObject.jsondata.sdescription&&editObject.jsondata.sdescription, \r\n                             ncommentsubtypecode:editObject.jsondata.ncommentsubtypecode&&editObject.jsondata.ncommentsubtypecode,\r\n                             nsampletestcommentscode:editObject.jsondata.nsampletestcommentscode&&editObject.jsondata.nsampletestcommentscode\r\n                        };\r\n                        selectedId = inputParam.screenName === \"IDS_TESTCOMMENTS\" ? inputParam.editRow.ntestcommentcode : inputParam.screenName === \"IDS_SUBSAMPLECOMMENTS\" ? inputParam.editRow.nsamplecommentcode : inputParam.screenName === \"IDS_SAMPLECOMMENTS\" ? inputParam.editRow.nregcommentcode : null;\r\n                    } else {\r\n                        selectedRecord = {...selectedRecord,\r\n                            nsamplecommentscode: defaultLink.length > 0 ? { \"label\": defaultLink[0].ssampletestcommentname, \"value\": defaultLink[0].nsampletestcommentcode } : \"\",\r\n\r\n                        };\r\n                    }\r\n                    dispatch({\r\n                        type: DEFAULT_RETURN,\r\n                        payload: {\r\n                            [inputParam.modalName]: true,\r\n                            operation: inputParam.operation,\r\n                            screenName: inputParam.screenName,\r\n                            ncontrolCode: inputParam.ncontrolCode,\r\n                            selectedRecord, loading: false,\r\n                            sampleTestComments,\r\n                            predefcomments,\r\n                            CommentSubType,\r\n                            isAbbrevationneeded,\r\n                            modalType: 'comment',\r\n                            modalName: [inputParam.modalName],\r\n                            editObject,\r\n                            selectedId\r\n                          //  isSampleTestComment:inputParam.isSampleTestComment\r\n                        }\r\n                    });\r\n                })\r\n                .catch(error => {\r\n                    dispatch({ type: DEFAULT_RETURN, payload: { loading: false } });\r\n                    if (error.response.status === 500) {\r\n                        toast.error(error.message);\r\n                    } else {\r\n                        toast.warn(error.response.data);\r\n                    }\r\n                });\r\n        } else {\r\n            toast.warn(intl.formatMessage({ id: inputParam.masterAlertStatus }));\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport function deleteComment(deleteParam) {\r\n    return (dispatch) => {\r\n        const methodUrl = deleteParam.methodUrl;\r\n        const selected = deleteParam.selectedRecord;\r\nconst Map={}\r\nMap[\"sprimarykey\"]=deleteParam.screenName===\"IDS_SAMPLECOMMENTS\"?\r\n\"nregcommentcode\":deleteParam.screenName===\"IDS_SUBSAMPLECOMMENTS\"?\"nsamplecommentcode\":\"ntestcommentcode\";\r\nMap[\"nprimarykey\"]=deleteParam.screenName===\"IDS_SAMPLECOMMENTS\"?selected.nregcommentcode:deleteParam.screenName===\"IDS_SUBSAMPLECOMMENTS\"?\r\nselected.nsamplecommentcode:selected.ntestcommentcode;\r\n\r\n\r\n        const inputParam = {\r\n            inputData: {\r\n                [methodUrl.toLowerCase()]: {[Map.sprimarykey]:Map.nprimarykey},\r\n                npreregno: deleteParam.npreregno,\r\n                ntransactiontestcode: deleteParam.ntransactiontestcode,\r\n                ntransactionsamplecode: deleteParam.ntransactionsamplecode,\r\n                userinfo: deleteParam.userInfo\r\n            },\r\n            classUrl: \"comments\",\r\n            operation: 'delete',\r\n            methodUrl: methodUrl,\r\n            screenName: deleteParam.screenName\r\n        }\r\n        const masterData = deleteParam.masterData;\r\n        if (showEsign(deleteParam.esignRights, deleteParam.userInfo.nformcode, deleteParam.ncontrolCode)) {\r\n            // dispatch({\r\n            //     type: DEFAULT_RETURN,\r\n            //     payload: {\r\n            //         loadEsign: true,\r\n            //         screenData: { inputParam, masterData },\r\n            //         openCommentModal: true,\r\n            //         screenName: deleteParam.screenName,\r\n            //         operation: 'delete',\r\n            //         selectedRecord: {}\r\n            //     }\r\n            // });\r\n            const updateInfo = {\r\n                typeName: DEFAULT_RETURN,\r\n                data: {   \r\n                    loadEsign: true,\r\n                    screenData: { inputParam, masterData },\r\n                    openCommentModal: true,\r\n                    screenName: deleteParam.screenName,\r\n                    operation: 'delete',\r\n                    selectedRecord: {},\r\n                    selectedId: null}\r\n            }\r\n            dispatch(updateStore(updateInfo));\r\n        } else {\r\n            dispatch(crudMaster(inputParam, masterData, \"openCommentModal\", {}));\r\n        }\r\n    }\r\n}\r\nexport function getSampleTestComments(selectedRecord, userInfo) {\r\n    return function (dispatch) {\r\n        dispatch(initRequest(true));\r\n        rsapi.post(\"/comments/getSampleTestCommentsListById\",\r\n            {\r\n                userinfo:userInfo,\r\n                ncommentsubtypecode:selectedRecord['ncommentsubtypecode'].value\r\n            })\r\n            .then(response => { \r\n                let predefcomments;\r\n                let isAbbrevationneeded;\r\n                predefcomments = response.data['SampleTestComments']; \r\n\r\n                if(selectedRecord['ncommentsubtypecode'].value===3)\r\n                { \r\n                    const predefcommentssMap  = constructOptionList(predefcomments || [], \"nsampletestcommentscode\",\"spredefinedname\" , undefined, undefined, false);\r\n                    isAbbrevationneeded=true\r\n                    predefcomments = predefcommentssMap.get(\"OptionList\"); \r\n                    selectedRecord={ ...selectedRecord,\r\n                        nsampletestcommentscode:predefcomments[0]&&predefcomments[0],scomments:predefcomments[0]&&predefcomments[0].item && predefcomments[0].item.sdescription}\r\n                }else{\r\n                    selectedRecord['nsampletestcommentscode']&&delete selectedRecord['nsampletestcommentscode']\r\n                    selectedRecord={ ...selectedRecord,scomments:predefcomments[0]&&predefcomments[0].sdescription}\r\n                } \r\n              \r\n                dispatch({\r\n                    type: DEFAULT_RETURN,\r\n                    payload: { \r\n                        selectedRecord,\r\n                        predefcomments,\r\n                        isAbbrevationneeded,\r\n                        loading: false\r\n\r\n                    }\r\n                });\r\n            })\r\n            .catch(error => {\r\n                dispatch({\r\n                    type: DEFAULT_RETURN,\r\n                    payload: {\r\n                        loading: false\r\n                    }\r\n                })\r\n                if (error.response.status === 500) {\r\n                    toast.error(error.message);\r\n                } else {\r\n                    toast.warn(error.response.data);\r\n                }\r\n            });\r\n    }\r\n}\r\n\r\n\r\nexport function getSampleTestCommentsDesc(selectedRecord, userInfo) {\r\n    return function (dispatch) {\r\n        dispatch(initRequest(true));\r\n        rsapi.post(\"/comments/getSampleTestCommentsDescById\",\r\n            {\r\n                userinfo:userInfo,\r\n                ncommentsubtypecode:selectedRecord['ncommentsubtypecode'].value,\r\n                spredefinedname:selectedRecord['nsampletestcommentscode'].label\r\n            })\r\n            .then(response => { \r\n                let predefcomments;\r\n                predefcomments = response.data['SampleTestComments']; \r\n                selectedRecord={ ...selectedRecord,scomments:predefcomments[0]&&predefcomments[0].sdescription}\r\n              \r\n                dispatch({\r\n                    type: DEFAULT_RETURN,\r\n                    payload: { \r\n                        selectedRecord,\r\n                        loading: false\r\n\r\n                    }\r\n                });\r\n            })\r\n            .catch(error => {\r\n                dispatch({\r\n                    type: DEFAULT_RETURN,\r\n                    payload: {\r\n                        loading: false\r\n                    }\r\n                })\r\n                if (error.response.status === 500) {\r\n                    toast.error(error.message);\r\n                } else {\r\n                    toast.warn(error.response.data);\r\n                }\r\n            });\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}