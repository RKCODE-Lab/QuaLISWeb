{"ast":null,"code":"import rsapi from \"../rsapi\";\nimport { toast } from \"react-toastify\";\nimport { DEFAULT_RETURN } from \"./LoginTypes\";\nimport Axios from \"axios\";\nimport { initRequest, updateStore } from \"./LoginAction\";\nimport { transactionStatus } from \"../components/Enumeration\";\nimport { constructOptionList, showEsign } from \"../components/CommonScript\";\nimport { crudMaster } from './ServiceAction';\nimport { intl } from \"../components/App\";\nexport function getCommentsCombo(inputParam) {\n  return dispatch => {\n    if (inputParam.masterList && inputParam.masterList.length > 0) {\n      dispatch(initRequest(true));\n      let urlArray = [rsapi.post(\"/sampletestcomments/getSampleTestComments\", {\n        userinfo: inputParam.userInfo\n      })];\n\n      if (inputParam.operation === \"update\") {\n        urlArray.push(rsapi.post(\"/comments/getEdit\".concat(inputParam.methodUrl), {\n          userinfo: inputParam.userInfo,\n          selectedrecord: inputParam.editRow\n        }));\n      }\n\n      Axios.all(urlArray).then(response => {\n        let sampleTestComments = response[0].data;\n        let selectedRecord = {};\n        const defaultLink = sampleTestComments.filter(item => item.ndefaultstatus === transactionStatus.YES);\n        const sampleTestCommentsMap = constructOptionList(sampleTestComments || [], \"nsampletestcommentcode\", \"ssampletestcommentname\", undefined, undefined, true);\n        sampleTestComments = sampleTestCommentsMap.get(\"OptionList\");\n        let editObject = {};\n\n        if (inputParam.operation === \"update\") {\n          editObject = response[1].data;\n          let nsamplecommentscode = {};\n          nsamplecommentscode = {\n            \"label\": editObject.ssampletestcommentname,\n            \"value\": editObject.nsamplecommentscode\n          };\n          selectedRecord = { ...editObject,\n            nsamplecommentscode,\n            scomments: editObject.jsondata.scomments\n          };\n        } else {\n          selectedRecord = {\n            nsamplecommentscode: defaultLink.length > 0 ? {\n              \"label\": defaultLink[0].ssampletestcommentname,\n              \"value\": defaultLink[0].nsampletestcommentcode\n            } : \"\"\n          };\n        }\n\n        dispatch({\n          type: DEFAULT_RETURN,\n          payload: {\n            [inputParam.modalName]: true,\n            operation: inputParam.operation,\n            screenName: inputParam.screenName,\n            ncontrolCode: inputParam.ncontrolCode,\n            selectedRecord,\n            loading: false,\n            sampleTestComments,\n            modalType: 'comment',\n            modalName: [inputParam.modalName],\n            editObject\n          }\n        });\n      }).catch(error => {\n        dispatch({\n          type: DEFAULT_RETURN,\n          payload: {\n            loading: false\n          }\n        });\n\n        if (error.response.status === 500) {\n          toast.error(error.message);\n        } else {\n          toast.warn(error.response.data);\n        }\n      });\n    } else {\n      toast.warn(intl.formatMessage({\n        id: inputParam.masterAlertStatus\n      }));\n    }\n  };\n}\nexport function deleteComment(deleteParam) {\n  return dispatch => {\n    const methodUrl = deleteParam.methodUrl;\n    const selected = deleteParam.selectedRecord;\n    const Map = {};\n    Map[\"sprimarykey\"] = deleteParam.screenName === \"IDS_SAMPLECOMMENTS\" ? \"nregcommentcode\" : deleteParam.screenName === \"IDS_SUBSAMPLECOMMENTS\" ? \"nsamplecommentcode\" : \"ntestcommentcode\";\n    Map[\"nprimarykey\"] = deleteParam.screenName === \"IDS_SAMPLECOMMENTS\" ? selected.nregcommentcode : deleteParam.screenName === \"IDS_SUBSAMPLECOMMENTS\" ? selected.nsamplecommentcode : selected.ntestcommentcode;\n    const inputParam = {\n      inputData: {\n        [methodUrl.toLowerCase()]: {\n          [Map.sprimarykey]: Map.nprimarykey\n        },\n        npreregno: deleteParam.npreregno,\n        ntransactiontestcode: deleteParam.ntransactiontestcode,\n        ntransactionsamplecode: deleteParam.ntransactionsamplecode,\n        userinfo: deleteParam.userInfo\n      },\n      classUrl: \"comments\",\n      operation: 'delete',\n      methodUrl: methodUrl,\n      screenName: deleteParam.screenName\n    };\n    const masterData = deleteParam.masterData;\n\n    if (showEsign(deleteParam.esignRights, deleteParam.userInfo.nformcode, deleteParam.ncontrolCode)) {\n      // dispatch({\n      //     type: DEFAULT_RETURN,\n      //     payload: {\n      //         loadEsign: true,\n      //         screenData: { inputParam, masterData },\n      //         openCommentModal: true,\n      //         screenName: deleteParam.screenName,\n      //         operation: 'delete',\n      //         selectedRecord: {}\n      //     }\n      // });\n      const updateInfo = {\n        typeName: DEFAULT_RETURN,\n        data: {\n          loadEsign: true,\n          screenData: {\n            inputParam,\n            masterData\n          },\n          openCommentModal: true,\n          screenName: deleteParam.screenName,\n          operation: 'delete',\n          selectedRecord: {}\n        }\n      };\n      dispatch(updateStore(updateInfo));\n    } else {\n      dispatch(crudMaster(inputParam, masterData, \"openCommentModal\", {}));\n    }\n  };\n}","map":{"version":3,"sources":["D:/LIMSWFH/LIMSPOSTGRESQL/QuaLISWeb/src/actions/CommentsAction.js"],"names":["rsapi","toast","DEFAULT_RETURN","Axios","initRequest","updateStore","transactionStatus","constructOptionList","showEsign","crudMaster","intl","getCommentsCombo","inputParam","dispatch","masterList","length","urlArray","post","userinfo","userInfo","operation","push","concat","methodUrl","selectedrecord","editRow","all","then","response","sampleTestComments","data","selectedRecord","defaultLink","filter","item","ndefaultstatus","YES","sampleTestCommentsMap","undefined","get","editObject","nsamplecommentscode","ssampletestcommentname","scomments","jsondata","nsampletestcommentcode","type","payload","modalName","screenName","ncontrolCode","loading","modalType","catch","error","status","message","warn","formatMessage","id","masterAlertStatus","deleteComment","deleteParam","selected","Map","nregcommentcode","nsamplecommentcode","ntestcommentcode","inputData","toLowerCase","sprimarykey","nprimarykey","npreregno","ntransactiontestcode","ntransactionsamplecode","classUrl","masterData","esignRights","nformcode","updateInfo","typeName","loadEsign","screenData","openCommentModal"],"mappings":"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","sourcesContent":["import rsapi from \"../rsapi\";\r\nimport { toast } from \"react-toastify\";\r\nimport { DEFAULT_RETURN } from \"./LoginTypes\";\r\nimport Axios from \"axios\";\r\nimport { initRequest, updateStore } from \"./LoginAction\";\r\nimport { transactionStatus } from \"../components/Enumeration\";\r\nimport { constructOptionList, showEsign } from \"../components/CommonScript\";\r\nimport { crudMaster } from './ServiceAction'\r\nimport { intl } from \"../components/App\";\r\n\r\nexport function getCommentsCombo(inputParam) {\r\n    return (dispatch) => {\r\n        if (inputParam.masterList && inputParam.masterList.length > 0) {\r\n            dispatch(initRequest(true));\r\n            let urlArray = [rsapi.post(\"/sampletestcomments/getSampleTestComments\", { userinfo: inputParam.userInfo })];\r\n            if (inputParam.operation === \"update\") {\r\n                urlArray.push(rsapi.post(\"/comments/getEdit\".concat(inputParam.methodUrl), { userinfo: inputParam.userInfo, selectedrecord: inputParam.editRow }))\r\n            }\r\n            Axios.all(urlArray)\r\n                .then(response => {\r\n                    let sampleTestComments = response[0].data;\r\n                    let selectedRecord = {};\r\n                    const defaultLink = sampleTestComments.filter(item => item.ndefaultstatus === transactionStatus.YES);\r\n                    const sampleTestCommentsMap  = constructOptionList(sampleTestComments || [], \"nsampletestcommentcode\",\"ssampletestcommentname\" , undefined, undefined, true);\r\n                    sampleTestComments = sampleTestCommentsMap.get(\"OptionList\");\r\n                    let editObject = {};\r\n                    if (inputParam.operation === \"update\") {\r\n                        editObject = response[1].data;\r\n                        let nsamplecommentscode = {};\r\n                        nsamplecommentscode = { \"label\": editObject.ssampletestcommentname, \"value\": editObject.nsamplecommentscode }\r\n                        selectedRecord = {\r\n                            ...editObject, nsamplecommentscode,scomments :editObject.jsondata.scomments\r\n                        };\r\n                    } else {\r\n                        selectedRecord = {\r\n                            nsamplecommentscode: defaultLink.length > 0 ? { \"label\": defaultLink[0].ssampletestcommentname, \"value\": defaultLink[0].nsampletestcommentcode } : \"\",\r\n\r\n                        };\r\n                    }\r\n                    dispatch({\r\n                        type: DEFAULT_RETURN,\r\n                        payload: {\r\n                            [inputParam.modalName]: true,\r\n                            operation: inputParam.operation,\r\n                            screenName: inputParam.screenName,\r\n                            ncontrolCode: inputParam.ncontrolCode,\r\n                            selectedRecord, loading: false,\r\n                            sampleTestComments,\r\n                            modalType: 'comment',\r\n                            modalName: [inputParam.modalName],\r\n                            editObject\r\n                        }\r\n                    });\r\n                })\r\n                .catch(error => {\r\n                    dispatch({ type: DEFAULT_RETURN, payload: { loading: false } });\r\n                    if (error.response.status === 500) {\r\n                        toast.error(error.message);\r\n                    } else {\r\n                        toast.warn(error.response.data);\r\n                    }\r\n                });\r\n        } else {\r\n            toast.warn(intl.formatMessage({ id: inputParam.masterAlertStatus }));\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport function deleteComment(deleteParam) {\r\n    return (dispatch) => {\r\n        const methodUrl = deleteParam.methodUrl;\r\n        const selected = deleteParam.selectedRecord;\r\nconst Map={}\r\nMap[\"sprimarykey\"]=deleteParam.screenName===\"IDS_SAMPLECOMMENTS\"?\r\n\"nregcommentcode\":deleteParam.screenName===\"IDS_SUBSAMPLECOMMENTS\"?\"nsamplecommentcode\":\"ntestcommentcode\";\r\nMap[\"nprimarykey\"]=deleteParam.screenName===\"IDS_SAMPLECOMMENTS\"?selected.nregcommentcode:deleteParam.screenName===\"IDS_SUBSAMPLECOMMENTS\"?\r\nselected.nsamplecommentcode:selected.ntestcommentcode;\r\n\r\n\r\n        const inputParam = {\r\n            inputData: {\r\n                [methodUrl.toLowerCase()]: {[Map.sprimarykey]:Map.nprimarykey},\r\n                npreregno: deleteParam.npreregno,\r\n                ntransactiontestcode: deleteParam.ntransactiontestcode,\r\n                ntransactionsamplecode: deleteParam.ntransactionsamplecode,\r\n                userinfo: deleteParam.userInfo\r\n            },\r\n            classUrl: \"comments\",\r\n            operation: 'delete',\r\n            methodUrl: methodUrl,\r\n            screenName: deleteParam.screenName\r\n        }\r\n        const masterData = deleteParam.masterData;\r\n        if (showEsign(deleteParam.esignRights, deleteParam.userInfo.nformcode, deleteParam.ncontrolCode)) {\r\n            // dispatch({\r\n            //     type: DEFAULT_RETURN,\r\n            //     payload: {\r\n            //         loadEsign: true,\r\n            //         screenData: { inputParam, masterData },\r\n            //         openCommentModal: true,\r\n            //         screenName: deleteParam.screenName,\r\n            //         operation: 'delete',\r\n            //         selectedRecord: {}\r\n            //     }\r\n            // });\r\n            const updateInfo = {\r\n                typeName: DEFAULT_RETURN,\r\n                data: {   \r\n                    loadEsign: true,\r\n                    screenData: { inputParam, masterData },\r\n                    openCommentModal: true,\r\n                    screenName: deleteParam.screenName,\r\n                    operation: 'delete',\r\n                    selectedRecord: {}}\r\n            }\r\n            dispatch(updateStore(updateInfo));\r\n        } else {\r\n            dispatch(crudMaster(inputParam, masterData, \"openCommentModal\", {}));\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}