{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport * as React from 'react';\nimport * as PropTypes from 'prop-types';\nimport { ButtonGroup, Toolbar, ToolbarSeparator } from '@progress/kendo-react-buttons';\nimport { classNames } from '@progress/kendo-react-common';\nimport { EditorState, Plugin, PluginKey, EditorView, Schema, baseKeymap, keymap, history, dropCursor, gapCursor, getMark, spacesFix, tableEditing } from '@progress/kendo-editor-common';\nimport { marks, nodes } from './config/schema';\nimport { defaultStyle, tablesStyles, rtlStyles } from './config/defaultStyles';\nimport { EditorToolsSettings } from './config/toolsSettings';\nimport { EditorDialogs } from './dialogs/main';\nimport { EditorUtils } from './utils';\nimport { editorPropsKey } from './utils/props-key';\nimport { updateEditorValue } from './utils/controlled-value';\nvar link = EditorToolsSettings.link,\n    bold = EditorToolsSettings.bold,\n    italic = EditorToolsSettings.italic,\n    underline = EditorToolsSettings.underline;\nimport { firefox } from './utils/browser-detection';\nimport * as licensing from '@progress/kendo-licensing';\nimport { packageMetadata } from './package-metadata';\n/**\n * Represents the [KendoReact Editor component]({% slug overview_editor %}).\n *\n * @example\n * ```jsx\n * class App extends React.Component {\n *    render() {\n *       return (\n *           <Editor\n *               defaultContent=\"<p>Hello World</p>\"\n *               tools={[\n *                  [ EditorTools.Bold, EditorTools.Italic ]\n *               ]}\n *           />\n *       );\n *    }\n * }\n * ReactDOM.render(<App />, document.querySelector('my-app'));\n * ```\n */\n\nvar Editor =\n/** @class */\nfunction (_super) {\n  __extends(Editor, _super);\n\n  function Editor(props) {\n    var _this = _super.call(this, props) || this;\n    /**\n     * @hidden\n     */\n\n\n    _this.state = {\n      view: undefined,\n      linkDialog: false\n    };\n    _this.trOnChange = null;\n    _this.htmlOnChange = null;\n    /**\n     * @hidden\n     */\n\n    _this.focus = function () {\n      if (_this.view) {\n        _this.view.focus();\n      }\n    };\n\n    _this.renderDialog = function (Component, settings, stateFlag) {\n      return _this.state[stateFlag] && React.createElement(Component, {\n        view: _this.view,\n        settings: settings,\n        dir: _this.props.dir,\n        onClose: function () {\n          var _a;\n\n          return _this.setState((_a = {}, _a[stateFlag] = false, _a));\n        }\n      });\n    };\n\n    _this.renderTool = function (Tool, index) {\n      var tool = React.createElement(Tool, {\n        view: _this.view,\n        dir: _this.props.dir,\n        key: index\n      });\n      return tool.type === ToolbarSeparator ? React.createElement(Tool, {\n        key: index\n      }) : tool;\n    };\n\n    _this.updateTools = function (view, _prevViewState) {\n      _this.setState({\n        view: view\n      });\n    };\n\n    _this.filterTransaction = function (transaction, state) {\n      var event = {\n        target: _this,\n        transaction: transaction,\n        state: state\n      };\n      return (_this.props.onExecute && _this.props.onExecute.call(undefined, event)) !== false;\n    };\n\n    _this.onPasteHtml = function (html) {\n      if (_this.props.onPasteHtml && _this.pasteEvent) {\n        var event_1 = {\n          target: _this,\n          pastedHtml: html,\n          nativeEvent: _this.pasteEvent\n        };\n\n        var newHtml = _this.props.onPasteHtml.call(undefined, event_1);\n\n        _this.pasteEvent = undefined;\n\n        if (typeof newHtml === 'string') {\n          return newHtml;\n        }\n      }\n\n      return html;\n    };\n\n    _this.dispatchTransaction = function (transaction) {\n      var docChanged = transaction.docChanged;\n\n      if (_this.props.onChange && docChanged) {\n        _this.trOnChange = transaction;\n        var doc_1 = transaction.doc,\n            schema_1 = transaction.doc.type.schema;\n        var target_1 = _this;\n        var event_2 = {\n          target: target_1,\n          value: doc_1,\n\n          get html() {\n            target_1.htmlOnChange = EditorUtils.getHtml({\n              doc: doc_1,\n              schema: schema_1\n            });\n            return target_1.htmlOnChange;\n          },\n\n          transaction: transaction,\n          schema: schema_1\n        };\n\n        _this.props.onChange.call(undefined, event_2);\n      }\n\n      if (_this.view && (_this.props.value === undefined || !docChanged)) {\n        _this.view.updateState(_this.view.state.apply(transaction));\n      }\n    };\n\n    _this.onFocus = function (_view, nativeEvent) {\n      if (_this.props.onFocus) {\n        var event_3 = {\n          target: _this,\n          nativeEvent: nativeEvent\n        };\n\n        _this.props.onFocus.call(undefined, event_3);\n      }\n\n      return false;\n    };\n\n    _this.onBlur = function (_view, nativeEvent) {\n      if (_this.props.onBlur) {\n        var event_4 = {\n          target: _this,\n          nativeEvent: nativeEvent\n        };\n\n        _this.props.onBlur.call(undefined, event_4);\n      }\n\n      return false;\n    };\n\n    _this.onPaste = function (_view, nativeEvent) {\n      if (_this.props.onPasteHtml) {\n        _this.pasteEvent = nativeEvent;\n      }\n\n      return false;\n    };\n\n    if (typeof licensing !== 'undefined') {\n      licensing.validatePackage(packageMetadata);\n    } else {\n      var message = \"License activation failed for \" + packageMetadata.name + \"\\n\";\n      message += 'The @progress/kendo-licensing script is not loaded.\\n';\n      message += \"See \" + packageMetadata.licensingDocsUrl + \" for more information.\\n\";\n      console.warn(message);\n    }\n\n    return _this;\n  }\n\n  Object.defineProperty(Editor.prototype, \"value\", {\n    /**\n     * The value of the Editor.\n     */\n    get: function () {\n      if (this.trOnChange !== null) {\n        return this.trOnChange.doc;\n      } else if (this.props.value !== undefined) {\n        return this.props.value;\n      } else if (this.view) {\n        return this.view.state.doc;\n      }\n\n      return this.props.defaultContent || '';\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Editor.prototype, \"element\", {\n    /**\n     * Returns the DOM element of the Editor.\n     */\n    get: function () {\n      return this._element;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Editor.prototype, \"contentElement\", {\n    /**\n     * Returns the content-editable DOM element of the Editor.\n     */\n    get: function () {\n      return this._contentElement;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Editor.prototype, \"view\", {\n    /**\n     * Returns the `view` object of the Editor.\n     */\n    get: function () {\n      return this._view;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * @hidden\n   */\n\n  Editor.prototype.componentDidMount = function () {\n    if (!this.iframe || !firefox) {\n      this.initialize();\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Editor.prototype.componentDidUpdate = function (prevProps) {\n    var value = this.props.value;\n    var view = this.view;\n\n    if (value === undefined || !view) {\n      return;\n    }\n\n    updateEditorValue(view, value, prevProps.value, this.trOnChange, this.htmlOnChange);\n    this.trOnChange = null;\n    this.htmlOnChange = null;\n  };\n  /**\n   * @hidden\n   */\n\n\n  Editor.prototype.componentWillUnmount = function () {\n    if (this.view) {\n      this.view.destroy();\n    }\n\n    this._view = undefined;\n  };\n  /**\n   * @hidden\n   */\n\n\n  Editor.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.props,\n        _b = _a.tools,\n        tools = _b === void 0 ? [] : _b,\n        _c = _a.defaultEditMode,\n        defaultEditMode = _c === void 0 ? 'iframe' : _c,\n        _d = _a.preserveWhitespace,\n        preserveWhitespace = _d === void 0 ? 'full' : _d,\n        style = _a.style,\n        className = _a.className;\n\n    if (this.view) {\n      var editorProps = editorPropsKey.getState(this.view.state);\n      editorProps.preserveWhitespace = preserveWhitespace;\n    }\n\n    var contentStyle = this.props.contentStyle;\n\n    if (contentStyle === undefined && (style || {}).height === undefined) {\n      contentStyle = {\n        height: '300px'\n      };\n    }\n\n    var buttons = tools.map(function (item, index) {\n      return Array.isArray(item) ? React.createElement(ButtonGroup, {\n        key: index\n      }, item.map(_this.renderTool, index)) : _this.renderTool(item, index);\n    });\n    return React.createElement(\"div\", {\n      ref: function (e) {\n        return _this._element = e;\n      },\n      className: classNames('k-widget k-editor', className, {\n        'k-editor-resizable': this.props.resizable\n      }),\n      dir: this.props.dir,\n      style: style\n    }, buttons.length > 0 && React.createElement(Toolbar, {\n      keyboardNavigation: this.props.keyboardNavigation\n    }, buttons), defaultEditMode === 'iframe' ? React.createElement(\"div\", {\n      className: \"k-editor-content\"\n    }, React.createElement(\"iframe\", {\n      onLoad: firefox ? function () {\n        _this.initialize();\n      } : undefined,\n      ref: function (e) {\n        return _this.iframe = e;\n      },\n      frameBorder: \"0\",\n      style: contentStyle,\n      className: \"k-iframe\"\n    })) : React.createElement(\"div\", {\n      style: contentStyle,\n      className: \"k-editor-content\"\n    }, React.createElement(\"div\", {\n      ref: function (e) {\n        return _this._contentElement = e;\n      },\n      suppressContentEditableWarning: true\n    })), this.renderDialog(EditorDialogs.InsertLinkDialog, link, 'linkDialog'));\n  };\n\n  Editor.prototype.initialize = function () {\n    var _this = this;\n\n    var iframeWindow = this.iframe && this.iframe.contentWindow;\n\n    if (iframeWindow) {\n      var iframeDocument_1 = iframeWindow.document;\n      [defaultStyle, tablesStyles, this.props.dir === 'rtl' ? rtlStyles : undefined].forEach(function (styles) {\n        if (styles) {\n          var style = iframeDocument_1.createElement('style');\n          style.appendChild(iframeDocument_1.createTextNode(styles));\n          iframeDocument_1.head.appendChild(style);\n        }\n      });\n      var meta = iframeDocument_1.createElement('meta');\n      meta.setAttribute('charset', 'utf-8');\n      iframeDocument_1.head.appendChild(meta); // The content has to be wrapped because the `dropCursor` plugin raises a `body.offsetParent is null` error.\n\n      this._contentElement = iframeDocument_1.createElement('div');\n      iframeDocument_1.body.appendChild(this._contentElement);\n\n      this._contentElement.classList.add('k-content');\n    }\n\n    var dom = this._contentElement;\n\n    if (!dom) {\n      return;\n    }\n\n    var _a = this.props.preserveWhitespace,\n        preserveWhitespace = _a === void 0 ? 'full' : _a;\n    var target = this;\n    var plugins = [// https://prosemirror.net/docs/ref/#state.PluginSpec\n    new Plugin({\n      view: function () {\n        return {\n          update: _this.updateTools\n        };\n      },\n      key: new PluginKey('toolbar-tools-update-plugin')\n    }), new Plugin({\n      filterTransaction: this.filterTransaction,\n      key: new PluginKey('onExecute-event-plugin')\n    }), new Plugin({\n      key: editorPropsKey,\n      state: {\n        init: function () {\n          return {\n            preserveWhitespace: preserveWhitespace\n          };\n        },\n        apply: function (_, val) {\n          return val;\n        }\n      }\n    }), spacesFix(), history(), dropCursor(), gapCursor(), tableEditing()];\n\n    var shortcuts = __assign({}, EditorUtils.getShortcuts({\n      types: {\n        listItem: 'list_item',\n        hardBreak: 'hard_break'\n      },\n      toolsSettings: {\n        bold: bold,\n        italic: italic,\n        underline: underline\n      }\n    }), {\n      'Mod-k': function () {\n        var linkDialog = _this.state.linkDialog;\n        var editorView = _this.view;\n\n        if (editorView) {\n          var editorState = editorView.state;\n          var collapsed = editorState.selection.empty;\n          var linkMark = getMark(editorState, editorState.schema.marks[link.mark]);\n          var disabled = collapsed && !linkMark;\n\n          if (!linkDialog && !disabled) {\n            _this.setState({\n              linkDialog: true\n            });\n          }\n        }\n\n        return !linkDialog;\n      }\n    });\n\n    var _b = this.props,\n        _c = _b.defaultContent,\n        defaultContent = _c === void 0 ? '' : _c,\n        value = _b.value,\n        onMount = _b.onMount;\n    var doc = value && typeof value !== 'string' ? value : EditorUtils.createDocument(new Schema({\n      nodes: nodes,\n      marks: marks\n    }), value || defaultContent, {\n      preserveWhitespace: preserveWhitespace\n    });\n    var viewProps = {\n      state: EditorState.create({\n        plugins: plugins.concat([keymap(shortcuts), keymap(baseKeymap)]),\n        doc: doc\n      }),\n      transformPastedHTML: this.onPasteHtml,\n      dispatchTransaction: this.dispatchTransaction,\n      handleDOMEvents: {\n        focus: this.onFocus,\n        blur: this.onBlur,\n        paste: this.onPaste\n      }\n    };\n    var mountEvent = {\n      plugins: plugins,\n      shortcuts: shortcuts,\n      target: target,\n      viewProps: viewProps,\n      dom: dom\n    };\n    var view = this._view = onMount && onMount.call(undefined, mountEvent) || new EditorView({\n      mount: dom\n    }, viewProps);\n    this.setState({\n      view: view\n    });\n  };\n  /**\n   * @hidden\n   */\n\n\n  Editor.propTypes = {\n    defaultContent: PropTypes.string,\n    value: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n    defaultEditMode: PropTypes.oneOf(['iframe', 'div']),\n    contentStyle: PropTypes.object,\n    dir: PropTypes.string,\n    className: PropTypes.string,\n    style: PropTypes.object,\n    tools: PropTypes.arrayOf(PropTypes.any),\n    keyboardNavigation: PropTypes.bool,\n    resizable: PropTypes.bool,\n    preserveWhitespace: PropTypes.oneOf([true, false, 'full']),\n    onMount: PropTypes.func,\n    onFocus: PropTypes.func,\n    onBlur: PropTypes.func,\n    onChange: PropTypes.func,\n    onPasteHtml: PropTypes.func,\n    onExecute: PropTypes.func\n  };\n  return Editor;\n}(React.Component);\n\nexport default Editor;","map":{"version":3,"sources":["D:/Postgres_workingFolder/QuaLISWeb/node_modules/@progress/kendo-react-editor/dist/es/Editor.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","React","PropTypes","ButtonGroup","Toolbar","ToolbarSeparator","classNames","EditorState","Plugin","PluginKey","EditorView","Schema","baseKeymap","keymap","history","dropCursor","gapCursor","getMark","spacesFix","tableEditing","marks","nodes","defaultStyle","tablesStyles","rtlStyles","EditorToolsSettings","EditorDialogs","EditorUtils","editorPropsKey","updateEditorValue","link","bold","italic","underline","firefox","licensing","packageMetadata","Editor","_super","props","_this","state","view","undefined","linkDialog","trOnChange","htmlOnChange","focus","renderDialog","Component","settings","stateFlag","createElement","dir","onClose","_a","setState","renderTool","Tool","index","tool","key","type","updateTools","_prevViewState","filterTransaction","transaction","event","target","onExecute","onPasteHtml","html","pasteEvent","event_1","pastedHtml","nativeEvent","newHtml","dispatchTransaction","docChanged","onChange","doc_1","doc","schema_1","schema","target_1","event_2","value","getHtml","updateState","onFocus","_view","event_3","onBlur","event_4","onPaste","validatePackage","message","name","licensingDocsUrl","console","warn","defineProperty","get","defaultContent","enumerable","configurable","_element","_contentElement","componentDidMount","iframe","initialize","componentDidUpdate","prevProps","componentWillUnmount","destroy","render","_b","tools","_c","defaultEditMode","_d","preserveWhitespace","style","className","editorProps","getState","contentStyle","height","buttons","map","item","isArray","ref","e","resizable","keyboardNavigation","onLoad","frameBorder","suppressContentEditableWarning","InsertLinkDialog","iframeWindow","contentWindow","iframeDocument_1","document","forEach","styles","appendChild","createTextNode","head","meta","setAttribute","body","classList","add","dom","plugins","update","init","_","val","shortcuts","getShortcuts","types","listItem","hardBreak","toolsSettings","editorView","editorState","collapsed","selection","empty","linkMark","mark","disabled","onMount","createDocument","viewProps","concat","transformPastedHTML","handleDOMEvents","blur","paste","mountEvent","mount","propTypes","string","oneOfType","object","oneOf","arrayOf","any","bool","func"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport * as PropTypes from 'prop-types';\nimport { ButtonGroup, Toolbar, ToolbarSeparator } from '@progress/kendo-react-buttons';\nimport { classNames } from '@progress/kendo-react-common';\nimport { EditorState, Plugin, PluginKey, EditorView, Schema, baseKeymap, keymap, history, dropCursor, gapCursor, getMark, spacesFix, tableEditing } from '@progress/kendo-editor-common';\nimport { marks, nodes } from './config/schema';\nimport { defaultStyle, tablesStyles, rtlStyles } from './config/defaultStyles';\nimport { EditorToolsSettings } from './config/toolsSettings';\nimport { EditorDialogs } from './dialogs/main';\nimport { EditorUtils } from './utils';\nimport { editorPropsKey } from './utils/props-key';\nimport { updateEditorValue } from './utils/controlled-value';\nvar link = EditorToolsSettings.link, bold = EditorToolsSettings.bold, italic = EditorToolsSettings.italic, underline = EditorToolsSettings.underline;\nimport { firefox } from './utils/browser-detection';\nimport * as licensing from '@progress/kendo-licensing';\nimport { packageMetadata } from './package-metadata';\n/**\n * Represents the [KendoReact Editor component]({% slug overview_editor %}).\n *\n * @example\n * ```jsx\n * class App extends React.Component {\n *    render() {\n *       return (\n *           <Editor\n *               defaultContent=\"<p>Hello World</p>\"\n *               tools={[\n *                  [ EditorTools.Bold, EditorTools.Italic ]\n *               ]}\n *           />\n *       );\n *    }\n * }\n * ReactDOM.render(<App />, document.querySelector('my-app'));\n * ```\n */\nvar Editor = /** @class */ (function (_super) {\n    __extends(Editor, _super);\n    function Editor(props) {\n        var _this = _super.call(this, props) || this;\n        /**\n         * @hidden\n         */\n        _this.state = {\n            view: undefined,\n            linkDialog: false\n        };\n        _this.trOnChange = null;\n        _this.htmlOnChange = null;\n        /**\n         * @hidden\n         */\n        _this.focus = function () {\n            if (_this.view) {\n                _this.view.focus();\n            }\n        };\n        _this.renderDialog = function (Component, settings, stateFlag) {\n            return _this.state[stateFlag] && (React.createElement(Component, { view: _this.view, settings: settings, dir: _this.props.dir, onClose: function () {\n                    var _a;\n                    return _this.setState((_a = {}, _a[stateFlag] = false, _a));\n                } }));\n        };\n        _this.renderTool = function (Tool, index) {\n            var tool = (React.createElement(Tool, { view: _this.view, dir: _this.props.dir, key: index }));\n            return tool.type === ToolbarSeparator ? React.createElement(Tool, { key: index }) : tool;\n        };\n        _this.updateTools = function (view, _prevViewState) {\n            _this.setState({ view: view });\n        };\n        _this.filterTransaction = function (transaction, state) {\n            var event = { target: _this, transaction: transaction, state: state };\n            return (_this.props.onExecute &&\n                _this.props.onExecute.call(undefined, event)) !== false;\n        };\n        _this.onPasteHtml = function (html) {\n            if (_this.props.onPasteHtml && _this.pasteEvent) {\n                var event_1 = {\n                    target: _this,\n                    pastedHtml: html,\n                    nativeEvent: _this.pasteEvent\n                };\n                var newHtml = _this.props.onPasteHtml.call(undefined, event_1);\n                _this.pasteEvent = undefined;\n                if (typeof newHtml === 'string') {\n                    return newHtml;\n                }\n            }\n            return html;\n        };\n        _this.dispatchTransaction = function (transaction) {\n            var docChanged = transaction.docChanged;\n            if (_this.props.onChange && docChanged) {\n                _this.trOnChange = transaction;\n                var doc_1 = transaction.doc, schema_1 = transaction.doc.type.schema;\n                var target_1 = _this;\n                var event_2 = {\n                    target: target_1,\n                    value: doc_1,\n                    get html() {\n                        target_1.htmlOnChange = EditorUtils.getHtml({ doc: doc_1, schema: schema_1 });\n                        return target_1.htmlOnChange;\n                    },\n                    transaction: transaction,\n                    schema: schema_1\n                };\n                _this.props.onChange.call(undefined, event_2);\n            }\n            if (_this.view && (_this.props.value === undefined || !docChanged)) {\n                _this.view.updateState(_this.view.state.apply(transaction));\n            }\n        };\n        _this.onFocus = function (_view, nativeEvent) {\n            if (_this.props.onFocus) {\n                var event_3 = {\n                    target: _this,\n                    nativeEvent: nativeEvent\n                };\n                _this.props.onFocus.call(undefined, event_3);\n            }\n            return false;\n        };\n        _this.onBlur = function (_view, nativeEvent) {\n            if (_this.props.onBlur) {\n                var event_4 = {\n                    target: _this,\n                    nativeEvent: nativeEvent\n                };\n                _this.props.onBlur.call(undefined, event_4);\n            }\n            return false;\n        };\n        _this.onPaste = function (_view, nativeEvent) {\n            if (_this.props.onPasteHtml) {\n                _this.pasteEvent = nativeEvent;\n            }\n            return false;\n        };\n        if (typeof licensing !== 'undefined') {\n            licensing.validatePackage(packageMetadata);\n        }\n        else {\n            var message = \"License activation failed for \" + packageMetadata.name + \"\\n\";\n            message += 'The @progress/kendo-licensing script is not loaded.\\n';\n            message += \"See \" + packageMetadata.licensingDocsUrl + \" for more information.\\n\";\n            console.warn(message);\n        }\n        return _this;\n    }\n    Object.defineProperty(Editor.prototype, \"value\", {\n        /**\n         * The value of the Editor.\n         */\n        get: function () {\n            if (this.trOnChange !== null) {\n                return this.trOnChange.doc;\n            }\n            else if (this.props.value !== undefined) {\n                return this.props.value;\n            }\n            else if (this.view) {\n                return this.view.state.doc;\n            }\n            return this.props.defaultContent || '';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Editor.prototype, \"element\", {\n        /**\n         * Returns the DOM element of the Editor.\n         */\n        get: function () {\n            return this._element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Editor.prototype, \"contentElement\", {\n        /**\n         * Returns the content-editable DOM element of the Editor.\n         */\n        get: function () {\n            return this._contentElement;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Editor.prototype, \"view\", {\n        /**\n         * Returns the `view` object of the Editor.\n         */\n        get: function () {\n            return this._view;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * @hidden\n     */\n    Editor.prototype.componentDidMount = function () {\n        if (!this.iframe || !firefox) {\n            this.initialize();\n        }\n    };\n    /**\n     * @hidden\n     */\n    Editor.prototype.componentDidUpdate = function (prevProps) {\n        var value = this.props.value;\n        var view = this.view;\n        if (value === undefined || !view) {\n            return;\n        }\n        updateEditorValue(view, value, prevProps.value, this.trOnChange, this.htmlOnChange);\n        this.trOnChange = null;\n        this.htmlOnChange = null;\n    };\n    /**\n     * @hidden\n     */\n    Editor.prototype.componentWillUnmount = function () {\n        if (this.view) {\n            this.view.destroy();\n        }\n        this._view = undefined;\n    };\n    /**\n     * @hidden\n     */\n    Editor.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, _b = _a.tools, tools = _b === void 0 ? [] : _b, _c = _a.defaultEditMode, defaultEditMode = _c === void 0 ? 'iframe' : _c, _d = _a.preserveWhitespace, preserveWhitespace = _d === void 0 ? 'full' : _d, style = _a.style, className = _a.className;\n        if (this.view) {\n            var editorProps = editorPropsKey.getState(this.view.state);\n            editorProps.preserveWhitespace = preserveWhitespace;\n        }\n        var contentStyle = this.props.contentStyle;\n        if (contentStyle === undefined && (style || {}).height === undefined) {\n            contentStyle = { height: '300px' };\n        }\n        var buttons = tools.map(function (item, index) {\n            return Array.isArray(item) ?\n                React.createElement(ButtonGroup, { key: index }, item.map(_this.renderTool, index)) :\n                _this.renderTool(item, index);\n        });\n        return (React.createElement(\"div\", { ref: function (e) { return _this._element = e; }, className: classNames('k-widget k-editor', className, { 'k-editor-resizable': this.props.resizable }), dir: this.props.dir, style: style },\n            buttons.length > 0 && (React.createElement(Toolbar, { keyboardNavigation: this.props.keyboardNavigation }, buttons)),\n            defaultEditMode === 'iframe' ?\n                (React.createElement(\"div\", { className: \"k-editor-content\" },\n                    React.createElement(\"iframe\", { onLoad: firefox ? function () {\n                            _this.initialize();\n                        } : undefined, ref: function (e) { return _this.iframe = e; }, frameBorder: \"0\", style: contentStyle, className: \"k-iframe\" }))) :\n                (React.createElement(\"div\", { style: contentStyle, className: \"k-editor-content\" },\n                    React.createElement(\"div\", { ref: function (e) { return _this._contentElement = e; }, suppressContentEditableWarning: true }))),\n            this.renderDialog(EditorDialogs.InsertLinkDialog, link, 'linkDialog')));\n    };\n    Editor.prototype.initialize = function () {\n        var _this = this;\n        var iframeWindow = this.iframe && this.iframe.contentWindow;\n        if (iframeWindow) {\n            var iframeDocument_1 = iframeWindow.document;\n            [defaultStyle, tablesStyles, this.props.dir === 'rtl' ? rtlStyles : undefined].forEach(function (styles) {\n                if (styles) {\n                    var style = iframeDocument_1.createElement('style');\n                    style.appendChild(iframeDocument_1.createTextNode(styles));\n                    iframeDocument_1.head.appendChild(style);\n                }\n            });\n            var meta = iframeDocument_1.createElement('meta');\n            meta.setAttribute('charset', 'utf-8');\n            iframeDocument_1.head.appendChild(meta);\n            // The content has to be wrapped because the `dropCursor` plugin raises a `body.offsetParent is null` error.\n            this._contentElement = iframeDocument_1.createElement('div');\n            iframeDocument_1.body.appendChild(this._contentElement);\n            this._contentElement.classList.add('k-content');\n        }\n        var dom = this._contentElement;\n        if (!dom) {\n            return;\n        }\n        var _a = this.props.preserveWhitespace, preserveWhitespace = _a === void 0 ? 'full' : _a;\n        var target = this;\n        var plugins = [\n            // https://prosemirror.net/docs/ref/#state.PluginSpec\n            new Plugin({\n                view: function () { return ({ update: _this.updateTools }); },\n                key: new PluginKey('toolbar-tools-update-plugin')\n            }),\n            new Plugin({\n                filterTransaction: this.filterTransaction,\n                key: new PluginKey('onExecute-event-plugin')\n            }),\n            new Plugin({\n                key: editorPropsKey,\n                state: {\n                    init: function () { return ({ preserveWhitespace: preserveWhitespace }); },\n                    apply: function (_, val) { return val; }\n                }\n            }),\n            spacesFix(),\n            history(),\n            dropCursor(),\n            gapCursor(),\n            tableEditing()\n        ];\n        var shortcuts = __assign({}, EditorUtils.getShortcuts({\n            types: { listItem: 'list_item', hardBreak: 'hard_break' },\n            toolsSettings: { bold: bold, italic: italic, underline: underline }\n        }), { 'Mod-k': function () {\n                var linkDialog = _this.state.linkDialog;\n                var editorView = _this.view;\n                if (editorView) {\n                    var editorState = editorView.state;\n                    var collapsed = editorState.selection.empty;\n                    var linkMark = getMark(editorState, editorState.schema.marks[link.mark]);\n                    var disabled = collapsed && !linkMark;\n                    if (!linkDialog && !disabled) {\n                        _this.setState({ linkDialog: true });\n                    }\n                }\n                return !linkDialog;\n            } });\n        var _b = this.props, _c = _b.defaultContent, defaultContent = _c === void 0 ? '' : _c, value = _b.value, onMount = _b.onMount;\n        var doc = (value && typeof value !== 'string') ? value :\n            EditorUtils.createDocument(new Schema({ nodes: nodes, marks: marks }), value || defaultContent, { preserveWhitespace: preserveWhitespace });\n        var viewProps = {\n            state: EditorState.create({\n                plugins: plugins.concat([keymap(shortcuts), keymap(baseKeymap)]),\n                doc: doc\n            }),\n            transformPastedHTML: this.onPasteHtml,\n            dispatchTransaction: this.dispatchTransaction,\n            handleDOMEvents: {\n                focus: this.onFocus,\n                blur: this.onBlur,\n                paste: this.onPaste\n            }\n        };\n        var mountEvent = { plugins: plugins, shortcuts: shortcuts, target: target, viewProps: viewProps, dom: dom };\n        var view = this._view = (onMount && onMount.call(undefined, mountEvent)) || new EditorView({ mount: dom }, viewProps);\n        this.setState({\n            view: view\n        });\n    };\n    /**\n     * @hidden\n     */\n    Editor.propTypes = {\n        defaultContent: PropTypes.string,\n        value: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n        defaultEditMode: PropTypes.oneOf(['iframe', 'div']),\n        contentStyle: PropTypes.object,\n        dir: PropTypes.string,\n        className: PropTypes.string,\n        style: PropTypes.object,\n        tools: PropTypes.arrayOf(PropTypes.any),\n        keyboardNavigation: PropTypes.bool,\n        resizable: PropTypes.bool,\n        preserveWhitespace: PropTypes.oneOf([true, false, 'full']),\n        onMount: PropTypes.func,\n        onFocus: PropTypes.func,\n        onBlur: PropTypes.func,\n        onChange: PropTypes.func,\n        onPasteHtml: PropTypes.func,\n        onExecute: PropTypes.func\n    };\n    return Editor;\n}(React.Component));\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}