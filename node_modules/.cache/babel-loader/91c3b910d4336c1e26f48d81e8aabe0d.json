{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport React, { PureComponent } from \"react\";\nimport { Utils } from \"@react-awesome-query-builder/core\";\nimport PropTypes from \"prop-types\";\nimport range from \"lodash/range\";\nimport { defaultValue } from \"../../utils/stuff\";\nimport { useOnPropsChanged } from \"../../utils/reactUtils\";\nimport pick from \"lodash/pick\";\nimport WidgetFactory from \"./WidgetFactory\";\nimport { Col } from \"../utils\";\nvar _Utils$ConfigUtils = Utils.ConfigUtils,\n    getFieldConfig = _Utils$ConfigUtils.getFieldConfig,\n    getOperatorConfig = _Utils$ConfigUtils.getOperatorConfig,\n    getFieldWidgetConfig = _Utils$ConfigUtils.getFieldWidgetConfig;\nvar _Utils$RuleUtils = Utils.RuleUtils,\n    getValueSourcesForFieldOp = _Utils$RuleUtils.getValueSourcesForFieldOp,\n    getWidgetsForFieldOp = _Utils$RuleUtils.getWidgetsForFieldOp,\n    getWidgetForFieldOp = _Utils$RuleUtils.getWidgetForFieldOp,\n    getValueLabel = _Utils$RuleUtils.getValueLabel;\nvar createListFromArray = Utils.DefaultUtils.createListFromArray;\nvar funcArgDummyOpDef = {\n  cardinality: 1\n};\n\nvar Widget = /*#__PURE__*/function (_PureComponent) {\n  _inherits(Widget, _PureComponent);\n\n  var _super = _createSuper(Widget);\n\n  function Widget(_props) {\n    var _this;\n\n    _classCallCheck(this, Widget);\n\n    _this = _super.call(this, _props);\n\n    _this._setValue = function (isSpecialRange, delta, widgetType, value, asyncListValues, __isInternal) {\n      if (isSpecialRange && Array.isArray(value)) {\n        var oldRange = [_this.props.value.get(0), _this.props.value.get(1)];\n        if (oldRange[0] != value[0]) _this.props.setValue(0, value[0], widgetType, asyncListValues, __isInternal);\n        if (oldRange[1] != value[1]) _this.props.setValue(1, value[1], widgetType, asyncListValues, __isInternal);\n      } else {\n        _this.props.setValue(delta, value, widgetType, asyncListValues, __isInternal);\n      }\n    };\n\n    _this._onChangeValueSrc = function (delta, srcKey) {\n      _this.props.setValueSrc(delta, srcKey);\n    };\n\n    _this.renderWidget = function (delta, meta, props) {\n      var config = props.config,\n          isFuncArg = props.isFuncArg,\n          leftField = props.leftField,\n          operator = props.operator,\n          values = props.value,\n          valueError = props.valueError,\n          readonly = props.readonly,\n          parentField = props.parentField,\n          parentFuncs = props.parentFuncs,\n          id = props.id,\n          groupId = props.groupId;\n      var settings = config.settings;\n      var widgets = meta.widgets,\n          iValues = meta.iValues,\n          aField = meta.aField;\n      var value = isFuncArg ? iValues : values;\n      var field = isFuncArg ? leftField : aField;\n      var _widgets$delta = widgets[delta],\n          valueSrc = _widgets$delta.valueSrc,\n          valueLabel = _widgets$delta.valueLabel;\n      var widgetLabel = settings.showLabels ? /*#__PURE__*/React.createElement(\"label\", {\n        className: \"rule--label\"\n      }, valueLabel.label) : null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: \"widget-\" + field + \"-\" + delta,\n        className: \"widget--widget\"\n      }, valueSrc == \"func\" ? null : widgetLabel, /*#__PURE__*/React.createElement(WidgetFactory, _extends({\n        id: id,\n        groupId: groupId,\n        valueSrc: valueSrc,\n        delta: delta,\n        value: value,\n        valueError: valueError,\n        isFuncArg: isFuncArg\n      }, pick(meta, [\"isSpecialRange\", \"fieldDefinition\", \"asyncListValues\"]), pick(widgets[delta], [\"widget\", \"widgetDefinition\", \"widgetValueLabel\", \"valueLabels\", \"textSeparators\", \"setValueHandler\"]), {\n        config: config,\n        field: field,\n        parentField: parentField,\n        parentFuncs: parentFuncs,\n        operator: operator,\n        readonly: readonly\n      })));\n    };\n\n    _this.renderValueSources = function (delta, meta, props) {\n      var config = props.config,\n          isFuncArg = props.isFuncArg,\n          leftField = props.leftField,\n          operator = props.operator,\n          readonly = props.readonly;\n      var settings = config.settings;\n      var valueSources = meta.valueSources,\n          widgets = meta.widgets,\n          aField = meta.aField;\n      var field = isFuncArg ? leftField : aField;\n      var _widgets$delta2 = widgets[delta],\n          valueSrc = _widgets$delta2.valueSrc,\n          setValueSrcHandler = _widgets$delta2.setValueSrcHandler;\n      var valueSourcesInfo = settings.valueSourcesInfo,\n          ValueSources = settings.renderValueSources;\n      var valueSourcesOptions = valueSources.map(function (srcKey) {\n        return [srcKey, {\n          label: valueSourcesInfo[srcKey].label\n        }];\n      });\n      var sourceLabel = settings.showLabels ? /*#__PURE__*/React.createElement(\"label\", {\n        className: \"rule--label\"\n      }, \"\\xA0\") : null;\n      return valueSources.length > 1 && !readonly && /*#__PURE__*/React.createElement(\"div\", {\n        key: \"valuesrc-\" + field + \"-\" + delta,\n        className: \"widget--valuesrc\"\n      }, sourceLabel, /*#__PURE__*/React.createElement(ValueSources, {\n        key: \"valuesrc-\" + delta,\n        delta: delta,\n        valueSources: valueSourcesOptions,\n        valueSrc: valueSrc,\n        config: config,\n        field: field,\n        operator: operator,\n        setValueSrc: setValueSrcHandler,\n        readonly: readonly,\n        title: settings.valueSourcesPopupTitle\n      }));\n    };\n\n    _this.renderSep = function (delta, meta, props) {\n      var config = props.config;\n      var widgets = meta.widgets;\n      var settings = config.settings;\n      var sepText = widgets[delta].sepText;\n      var sepLabel = settings.showLabels ? /*#__PURE__*/React.createElement(\"label\", {\n        className: \"rule--label\"\n      }, \"\\xA0\") : null;\n      return sepText && /*#__PURE__*/React.createElement(\"div\", {\n        key: \"widget-separators-\" + delta,\n        className: \"widget--sep\"\n      }, sepLabel, /*#__PURE__*/React.createElement(\"span\", null, sepText));\n    };\n\n    _this.renderWidgetDelta = function (delta) {\n      var sep = _this.renderSep(delta, _this.meta, _this.props);\n\n      var sources = _this.renderValueSources(delta, _this.meta, _this.props);\n\n      var widgetCmp = _this.renderWidget(delta, _this.meta, _this.props);\n\n      return [sep, sources, widgetCmp];\n    };\n\n    useOnPropsChanged(_assertThisInitialized(_this));\n\n    _this.onPropsChanged(_props);\n\n    return _this;\n  }\n\n  _createClass(Widget, [{\n    key: \"onPropsChanged\",\n    value: function onPropsChanged(nextProps) {\n      var prevProps = this.props;\n      var keysForMeta = [\"config\", \"field\", \"fieldFunc\", \"fieldArg\", \"leftField\", \"operator\", \"valueSrc\", \"isFuncArg\", \"asyncListValues\"];\n      var needUpdateMeta = !this.meta || keysForMeta.map(function (k) {\n        return nextProps[k] !== prevProps[k] //tip: for isFuncArg we need to wrap value in Imm list\n        || k == \"isFuncArg\" && nextProps[\"isFuncArg\"] && nextProps[\"value\"] !== prevProps[\"value\"];\n      }).filter(function (ch) {\n        return ch;\n      }).length > 0;\n\n      if (needUpdateMeta) {\n        this.meta = this.getMeta(nextProps);\n      }\n    }\n  }, {\n    key: \"getMeta\",\n    value: function getMeta(_ref) {\n      var _this2 = this;\n\n      var config = _ref.config,\n          simpleField = _ref.field,\n          fieldFunc = _ref.fieldFunc,\n          fieldArg = _ref.fieldArg,\n          operator = _ref.operator,\n          valueSrcs = _ref.valueSrc,\n          values = _ref.value,\n          isForRuleGruop = _ref.isForRuleGruop,\n          isCaseValue = _ref.isCaseValue,\n          isFuncArg = _ref.isFuncArg,\n          leftField = _ref.leftField,\n          asyncListValues = _ref.asyncListValues;\n      var field = isFuncArg ? {\n        func: fieldFunc,\n        arg: fieldArg\n      } : simpleField;\n      var iValueSrcs = valueSrcs;\n      var iValues = values;\n\n      if (isFuncArg || isForRuleGruop || isCaseValue) {\n        iValueSrcs = createListFromArray([valueSrcs]);\n        iValues = createListFromArray([values]);\n      }\n\n      var fieldDefinition = getFieldConfig(config, field);\n      var defaultWidget = getWidgetForFieldOp(config, field, operator);\n\n      var _widgets = getWidgetsForFieldOp(config, field, operator);\n\n      var operatorDefinition = isFuncArg ? funcArgDummyOpDef : getOperatorConfig(config, operator, field);\n\n      if ((fieldDefinition == null || operatorDefinition == null) && !isCaseValue) {\n        return null;\n      }\n\n      var isSpecialRange = operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.isSpecialRange;\n      var isSpecialRangeForSrcField = isSpecialRange && (iValueSrcs.get(0) == \"field\" || iValueSrcs.get(1) == \"field\");\n      var isTrueSpecialRange = isSpecialRange && !isSpecialRangeForSrcField;\n      var cardinality = isTrueSpecialRange ? 1 : defaultValue(operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.cardinality, 1);\n\n      if (cardinality === 0) {\n        return null;\n      }\n\n      var valueSources = getValueSourcesForFieldOp(config, field, operator, fieldDefinition, isFuncArg ? leftField : null);\n      var widgets = range(0, cardinality).map(function (delta) {\n        var _widgetDefinition;\n\n        var valueSrc = iValueSrcs.get(delta) || null;\n        var widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n        var widgetDefinition = getFieldWidgetConfig(config, field, operator, widget, valueSrc);\n\n        if (isSpecialRangeForSrcField) {\n          widget = widgetDefinition.singleWidget;\n          widgetDefinition = getFieldWidgetConfig(config, field, operator, widget, valueSrc);\n        }\n\n        var widgetType = (_widgetDefinition = widgetDefinition) === null || _widgetDefinition === void 0 ? void 0 : _widgetDefinition.type;\n        var valueLabel = getValueLabel(config, field, operator, delta, valueSrc, isTrueSpecialRange);\n        var widgetValueLabel = getValueLabel(config, field, operator, delta, null, isTrueSpecialRange);\n        var sepText = operatorDefinition !== null && operatorDefinition !== void 0 && operatorDefinition.textSeparators ? operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.textSeparators[delta] : null;\n\n        var setValueSrcHandler = _this2._onChangeValueSrc.bind(_this2, delta);\n\n        var valueLabels = null;\n        var textSeparators = null;\n\n        if (isSpecialRange) {\n          valueLabels = [getValueLabel(config, field, operator, 0), getValueLabel(config, field, operator, 1)];\n          valueLabels = {\n            placeholder: [valueLabels[0].placeholder, valueLabels[1].placeholder],\n            label: [valueLabels[0].label, valueLabels[1].label]\n          };\n          textSeparators = operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.textSeparators;\n        }\n\n        var setValueHandler = _this2._setValue.bind(_this2, isSpecialRange, delta, widgetType);\n\n        return {\n          valueSrc: valueSrc,\n          valueLabel: valueLabel,\n          widget: widget,\n          sepText: sepText,\n          setValueSrcHandler: setValueSrcHandler,\n          widgetDefinition: widgetDefinition,\n          widgetValueLabel: widgetValueLabel,\n          valueLabels: valueLabels,\n          textSeparators: textSeparators,\n          setValueHandler: setValueHandler\n        };\n      });\n      return {\n        defaultWidget: defaultWidget,\n        fieldDefinition: fieldDefinition,\n        operatorDefinition: operatorDefinition,\n        isSpecialRange: isTrueSpecialRange,\n        cardinality: cardinality,\n        valueSources: valueSources,\n        widgets: widgets,\n        iValues: iValues,\n        //correct for isFuncArg\n        aField: field,\n        //correct for isFuncArg\n        asyncListValues: asyncListValues\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (!this.meta) return null;\n      var _this$meta = this.meta,\n          defaultWidget = _this$meta.defaultWidget,\n          cardinality = _this$meta.cardinality;\n      if (!defaultWidget) return null;\n      var name = defaultWidget;\n      return /*#__PURE__*/React.createElement(Col, {\n        className: \"rule--widget rule--widget--\".concat(name.toUpperCase()),\n        key: \"widget-col-\" + name\n      }, range(0, cardinality).map(this.renderWidgetDelta));\n    }\n  }]);\n\n  return Widget;\n}(PureComponent);\n\nWidget.propTypes = {\n  config: PropTypes.object.isRequired,\n  value: PropTypes.any,\n  //instanceOf(Immutable.List)\n  valueSrc: PropTypes.any,\n  //instanceOf(Immutable.List)\n  valueError: PropTypes.any,\n  field: PropTypes.string,\n  operator: PropTypes.string,\n  readonly: PropTypes.bool,\n  asyncListValues: PropTypes.array,\n  id: PropTypes.string,\n  groupId: PropTypes.string,\n  //actions\n  setValue: PropTypes.func,\n  setValueSrc: PropTypes.func,\n  // for isFuncArg\n  isFuncArg: PropTypes.bool,\n  fieldFunc: PropTypes.string,\n  fieldArg: PropTypes.string,\n  leftField: PropTypes.string,\n  // for RuleGroupExt\n  isForRuleGruop: PropTypes.bool,\n  parentField: PropTypes.string,\n  // for func in func\n  parentFuncs: PropTypes.array,\n  // for case_value\n  isCaseValue: PropTypes.bool\n};\nexport { Widget as default };","map":{"version":3,"sources":["E:/WorkingFolder/React_Postgres/ALPD/SOURCE-512/QuaLISWeb/node_modules/@react-awesome-query-builder/ui/esm/components/rule/Widget.js"],"names":["_extends","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","React","PureComponent","Utils","PropTypes","range","defaultValue","useOnPropsChanged","pick","WidgetFactory","Col","_Utils$ConfigUtils","ConfigUtils","getFieldConfig","getOperatorConfig","getFieldWidgetConfig","_Utils$RuleUtils","RuleUtils","getValueSourcesForFieldOp","getWidgetsForFieldOp","getWidgetForFieldOp","getValueLabel","createListFromArray","DefaultUtils","funcArgDummyOpDef","cardinality","Widget","_PureComponent","_super","_props","_this","_setValue","isSpecialRange","delta","widgetType","value","asyncListValues","__isInternal","Array","isArray","oldRange","props","get","setValue","_onChangeValueSrc","srcKey","setValueSrc","renderWidget","meta","config","isFuncArg","leftField","operator","values","valueError","readonly","parentField","parentFuncs","id","groupId","settings","widgets","iValues","aField","field","_widgets$delta","valueSrc","valueLabel","widgetLabel","showLabels","createElement","className","label","key","renderValueSources","valueSources","_widgets$delta2","setValueSrcHandler","valueSourcesInfo","ValueSources","valueSourcesOptions","map","sourceLabel","length","title","valueSourcesPopupTitle","renderSep","sepText","sepLabel","renderWidgetDelta","sep","sources","widgetCmp","onPropsChanged","nextProps","prevProps","keysForMeta","needUpdateMeta","k","filter","ch","getMeta","_ref","_this2","simpleField","fieldFunc","fieldArg","valueSrcs","isForRuleGruop","isCaseValue","func","arg","iValueSrcs","fieldDefinition","defaultWidget","_widgets","operatorDefinition","isSpecialRangeForSrcField","isTrueSpecialRange","_widgetDefinition","widget","widgetDefinition","singleWidget","type","widgetValueLabel","textSeparators","bind","valueLabels","placeholder","setValueHandler","render","_this$meta","name","concat","toUpperCase","propTypes","object","isRequired","any","string","bool","array","default"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport React, { PureComponent } from \"react\";\nimport { Utils } from \"@react-awesome-query-builder/core\";\nimport PropTypes from \"prop-types\";\nimport range from \"lodash/range\";\nimport { defaultValue } from \"../../utils/stuff\";\nimport { useOnPropsChanged } from \"../../utils/reactUtils\";\nimport pick from \"lodash/pick\";\nimport WidgetFactory from \"./WidgetFactory\";\nimport { Col } from \"../utils\";\nvar _Utils$ConfigUtils = Utils.ConfigUtils,\n  getFieldConfig = _Utils$ConfigUtils.getFieldConfig,\n  getOperatorConfig = _Utils$ConfigUtils.getOperatorConfig,\n  getFieldWidgetConfig = _Utils$ConfigUtils.getFieldWidgetConfig;\nvar _Utils$RuleUtils = Utils.RuleUtils,\n  getValueSourcesForFieldOp = _Utils$RuleUtils.getValueSourcesForFieldOp,\n  getWidgetsForFieldOp = _Utils$RuleUtils.getWidgetsForFieldOp,\n  getWidgetForFieldOp = _Utils$RuleUtils.getWidgetForFieldOp,\n  getValueLabel = _Utils$RuleUtils.getValueLabel;\nvar createListFromArray = Utils.DefaultUtils.createListFromArray;\nvar funcArgDummyOpDef = {\n  cardinality: 1\n};\nvar Widget = /*#__PURE__*/function (_PureComponent) {\n  _inherits(Widget, _PureComponent);\n  var _super = _createSuper(Widget);\n  function Widget(_props) {\n    var _this;\n    _classCallCheck(this, Widget);\n    _this = _super.call(this, _props);\n    _this._setValue = function (isSpecialRange, delta, widgetType, value, asyncListValues, __isInternal) {\n      if (isSpecialRange && Array.isArray(value)) {\n        var oldRange = [_this.props.value.get(0), _this.props.value.get(1)];\n        if (oldRange[0] != value[0]) _this.props.setValue(0, value[0], widgetType, asyncListValues, __isInternal);\n        if (oldRange[1] != value[1]) _this.props.setValue(1, value[1], widgetType, asyncListValues, __isInternal);\n      } else {\n        _this.props.setValue(delta, value, widgetType, asyncListValues, __isInternal);\n      }\n    };\n    _this._onChangeValueSrc = function (delta, srcKey) {\n      _this.props.setValueSrc(delta, srcKey);\n    };\n    _this.renderWidget = function (delta, meta, props) {\n      var config = props.config,\n        isFuncArg = props.isFuncArg,\n        leftField = props.leftField,\n        operator = props.operator,\n        values = props.value,\n        valueError = props.valueError,\n        readonly = props.readonly,\n        parentField = props.parentField,\n        parentFuncs = props.parentFuncs,\n        id = props.id,\n        groupId = props.groupId;\n      var settings = config.settings;\n      var widgets = meta.widgets,\n        iValues = meta.iValues,\n        aField = meta.aField;\n      var value = isFuncArg ? iValues : values;\n      var field = isFuncArg ? leftField : aField;\n      var _widgets$delta = widgets[delta],\n        valueSrc = _widgets$delta.valueSrc,\n        valueLabel = _widgets$delta.valueLabel;\n      var widgetLabel = settings.showLabels ? /*#__PURE__*/React.createElement(\"label\", {\n        className: \"rule--label\"\n      }, valueLabel.label) : null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: \"widget-\" + field + \"-\" + delta,\n        className: \"widget--widget\"\n      }, valueSrc == \"func\" ? null : widgetLabel, /*#__PURE__*/React.createElement(WidgetFactory, _extends({\n        id: id,\n        groupId: groupId,\n        valueSrc: valueSrc,\n        delta: delta,\n        value: value,\n        valueError: valueError,\n        isFuncArg: isFuncArg\n      }, pick(meta, [\"isSpecialRange\", \"fieldDefinition\", \"asyncListValues\"]), pick(widgets[delta], [\"widget\", \"widgetDefinition\", \"widgetValueLabel\", \"valueLabels\", \"textSeparators\", \"setValueHandler\"]), {\n        config: config,\n        field: field,\n        parentField: parentField,\n        parentFuncs: parentFuncs,\n        operator: operator,\n        readonly: readonly\n      })));\n    };\n    _this.renderValueSources = function (delta, meta, props) {\n      var config = props.config,\n        isFuncArg = props.isFuncArg,\n        leftField = props.leftField,\n        operator = props.operator,\n        readonly = props.readonly;\n      var settings = config.settings;\n      var valueSources = meta.valueSources,\n        widgets = meta.widgets,\n        aField = meta.aField;\n      var field = isFuncArg ? leftField : aField;\n      var _widgets$delta2 = widgets[delta],\n        valueSrc = _widgets$delta2.valueSrc,\n        setValueSrcHandler = _widgets$delta2.setValueSrcHandler;\n      var valueSourcesInfo = settings.valueSourcesInfo,\n        ValueSources = settings.renderValueSources;\n      var valueSourcesOptions = valueSources.map(function (srcKey) {\n        return [srcKey, {\n          label: valueSourcesInfo[srcKey].label\n        }];\n      });\n      var sourceLabel = settings.showLabels ? /*#__PURE__*/React.createElement(\"label\", {\n        className: \"rule--label\"\n      }, \"\\xA0\") : null;\n      return valueSources.length > 1 && !readonly && /*#__PURE__*/React.createElement(\"div\", {\n        key: \"valuesrc-\" + field + \"-\" + delta,\n        className: \"widget--valuesrc\"\n      }, sourceLabel, /*#__PURE__*/React.createElement(ValueSources, {\n        key: \"valuesrc-\" + delta,\n        delta: delta,\n        valueSources: valueSourcesOptions,\n        valueSrc: valueSrc,\n        config: config,\n        field: field,\n        operator: operator,\n        setValueSrc: setValueSrcHandler,\n        readonly: readonly,\n        title: settings.valueSourcesPopupTitle\n      }));\n    };\n    _this.renderSep = function (delta, meta, props) {\n      var config = props.config;\n      var widgets = meta.widgets;\n      var settings = config.settings;\n      var sepText = widgets[delta].sepText;\n      var sepLabel = settings.showLabels ? /*#__PURE__*/React.createElement(\"label\", {\n        className: \"rule--label\"\n      }, \"\\xA0\") : null;\n      return sepText && /*#__PURE__*/React.createElement(\"div\", {\n        key: \"widget-separators-\" + delta,\n        className: \"widget--sep\"\n      }, sepLabel, /*#__PURE__*/React.createElement(\"span\", null, sepText));\n    };\n    _this.renderWidgetDelta = function (delta) {\n      var sep = _this.renderSep(delta, _this.meta, _this.props);\n      var sources = _this.renderValueSources(delta, _this.meta, _this.props);\n      var widgetCmp = _this.renderWidget(delta, _this.meta, _this.props);\n      return [sep, sources, widgetCmp];\n    };\n    useOnPropsChanged(_assertThisInitialized(_this));\n    _this.onPropsChanged(_props);\n    return _this;\n  }\n  _createClass(Widget, [{\n    key: \"onPropsChanged\",\n    value: function onPropsChanged(nextProps) {\n      var prevProps = this.props;\n      var keysForMeta = [\"config\", \"field\", \"fieldFunc\", \"fieldArg\", \"leftField\", \"operator\", \"valueSrc\", \"isFuncArg\", \"asyncListValues\"];\n      var needUpdateMeta = !this.meta || keysForMeta.map(function (k) {\n        return nextProps[k] !== prevProps[k]\n        //tip: for isFuncArg we need to wrap value in Imm list\n        || k == \"isFuncArg\" && nextProps[\"isFuncArg\"] && nextProps[\"value\"] !== prevProps[\"value\"];\n      }).filter(function (ch) {\n        return ch;\n      }).length > 0;\n      if (needUpdateMeta) {\n        this.meta = this.getMeta(nextProps);\n      }\n    }\n  }, {\n    key: \"getMeta\",\n    value: function getMeta(_ref) {\n      var _this2 = this;\n      var config = _ref.config,\n        simpleField = _ref.field,\n        fieldFunc = _ref.fieldFunc,\n        fieldArg = _ref.fieldArg,\n        operator = _ref.operator,\n        valueSrcs = _ref.valueSrc,\n        values = _ref.value,\n        isForRuleGruop = _ref.isForRuleGruop,\n        isCaseValue = _ref.isCaseValue,\n        isFuncArg = _ref.isFuncArg,\n        leftField = _ref.leftField,\n        asyncListValues = _ref.asyncListValues;\n      var field = isFuncArg ? {\n        func: fieldFunc,\n        arg: fieldArg\n      } : simpleField;\n      var iValueSrcs = valueSrcs;\n      var iValues = values;\n      if (isFuncArg || isForRuleGruop || isCaseValue) {\n        iValueSrcs = createListFromArray([valueSrcs]);\n        iValues = createListFromArray([values]);\n      }\n      var fieldDefinition = getFieldConfig(config, field);\n      var defaultWidget = getWidgetForFieldOp(config, field, operator);\n      var _widgets = getWidgetsForFieldOp(config, field, operator);\n      var operatorDefinition = isFuncArg ? funcArgDummyOpDef : getOperatorConfig(config, operator, field);\n      if ((fieldDefinition == null || operatorDefinition == null) && !isCaseValue) {\n        return null;\n      }\n      var isSpecialRange = operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.isSpecialRange;\n      var isSpecialRangeForSrcField = isSpecialRange && (iValueSrcs.get(0) == \"field\" || iValueSrcs.get(1) == \"field\");\n      var isTrueSpecialRange = isSpecialRange && !isSpecialRangeForSrcField;\n      var cardinality = isTrueSpecialRange ? 1 : defaultValue(operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.cardinality, 1);\n      if (cardinality === 0) {\n        return null;\n      }\n      var valueSources = getValueSourcesForFieldOp(config, field, operator, fieldDefinition, isFuncArg ? leftField : null);\n      var widgets = range(0, cardinality).map(function (delta) {\n        var _widgetDefinition;\n        var valueSrc = iValueSrcs.get(delta) || null;\n        var widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n        var widgetDefinition = getFieldWidgetConfig(config, field, operator, widget, valueSrc);\n        if (isSpecialRangeForSrcField) {\n          widget = widgetDefinition.singleWidget;\n          widgetDefinition = getFieldWidgetConfig(config, field, operator, widget, valueSrc);\n        }\n        var widgetType = (_widgetDefinition = widgetDefinition) === null || _widgetDefinition === void 0 ? void 0 : _widgetDefinition.type;\n        var valueLabel = getValueLabel(config, field, operator, delta, valueSrc, isTrueSpecialRange);\n        var widgetValueLabel = getValueLabel(config, field, operator, delta, null, isTrueSpecialRange);\n        var sepText = operatorDefinition !== null && operatorDefinition !== void 0 && operatorDefinition.textSeparators ? operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.textSeparators[delta] : null;\n        var setValueSrcHandler = _this2._onChangeValueSrc.bind(_this2, delta);\n        var valueLabels = null;\n        var textSeparators = null;\n        if (isSpecialRange) {\n          valueLabels = [getValueLabel(config, field, operator, 0), getValueLabel(config, field, operator, 1)];\n          valueLabels = {\n            placeholder: [valueLabels[0].placeholder, valueLabels[1].placeholder],\n            label: [valueLabels[0].label, valueLabels[1].label]\n          };\n          textSeparators = operatorDefinition === null || operatorDefinition === void 0 ? void 0 : operatorDefinition.textSeparators;\n        }\n        var setValueHandler = _this2._setValue.bind(_this2, isSpecialRange, delta, widgetType);\n        return {\n          valueSrc: valueSrc,\n          valueLabel: valueLabel,\n          widget: widget,\n          sepText: sepText,\n          setValueSrcHandler: setValueSrcHandler,\n          widgetDefinition: widgetDefinition,\n          widgetValueLabel: widgetValueLabel,\n          valueLabels: valueLabels,\n          textSeparators: textSeparators,\n          setValueHandler: setValueHandler\n        };\n      });\n      return {\n        defaultWidget: defaultWidget,\n        fieldDefinition: fieldDefinition,\n        operatorDefinition: operatorDefinition,\n        isSpecialRange: isTrueSpecialRange,\n        cardinality: cardinality,\n        valueSources: valueSources,\n        widgets: widgets,\n        iValues: iValues,\n        //correct for isFuncArg\n        aField: field,\n        //correct for isFuncArg\n        asyncListValues: asyncListValues\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (!this.meta) return null;\n      var _this$meta = this.meta,\n        defaultWidget = _this$meta.defaultWidget,\n        cardinality = _this$meta.cardinality;\n      if (!defaultWidget) return null;\n      var name = defaultWidget;\n      return /*#__PURE__*/React.createElement(Col, {\n        className: \"rule--widget rule--widget--\".concat(name.toUpperCase()),\n        key: \"widget-col-\" + name\n      }, range(0, cardinality).map(this.renderWidgetDelta));\n    }\n  }]);\n  return Widget;\n}(PureComponent);\nWidget.propTypes = {\n  config: PropTypes.object.isRequired,\n  value: PropTypes.any,\n  //instanceOf(Immutable.List)\n  valueSrc: PropTypes.any,\n  //instanceOf(Immutable.List)\n  valueError: PropTypes.any,\n  field: PropTypes.string,\n  operator: PropTypes.string,\n  readonly: PropTypes.bool,\n  asyncListValues: PropTypes.array,\n  id: PropTypes.string,\n  groupId: PropTypes.string,\n  //actions\n  setValue: PropTypes.func,\n  setValueSrc: PropTypes.func,\n  // for isFuncArg\n  isFuncArg: PropTypes.bool,\n  fieldFunc: PropTypes.string,\n  fieldArg: PropTypes.string,\n  leftField: PropTypes.string,\n  // for RuleGroupExt\n  isForRuleGruop: PropTypes.bool,\n  parentField: PropTypes.string,\n  // for func in func\n  parentFuncs: PropTypes.array,\n  // for case_value\n  isCaseValue: PropTypes.bool\n};\nexport { Widget as default };"]},"metadata":{},"sourceType":"module"}