{"ast":null,"code":"import rsapi from \"../rsapi\";\nimport { toast } from \"react-toastify\";\nimport { DEFAULT_RETURN } from \"./LoginTypes\";\nimport Axios from \"axios\";\nimport { initRequest, updateStore } from \"./LoginAction\";\nimport { transactionStatus, attachmentType } from \"../components/Enumeration\";\nimport { constructOptionList, showEsign } from \"../components/CommonScript\";\nimport { crudMaster } from './ServiceAction';\nimport { intl } from \"../components/App\";\nexport function getAttachmentCombo(inputParam) {\n  return dispatch => {\n    let valid = false;\n\n    if (inputParam.masterList) {\n      if (Array.isArray(inputParam.masterList)) {\n        if (inputParam.masterList.length > 0) {\n          valid = true;\n        }\n      } else {\n        valid = true;\n      }\n    } //if (inputParam.masterList && inputParam.masterList.length > 0) {\n\n\n    if (valid) {\n      dispatch(initRequest(true));\n      let urlArray = [rsapi.post(\"/linkmaster/getLinkMaster\", {\n        userinfo: inputParam.userInfo\n      })];\n\n      if (inputParam.operation === \"update\") {\n        urlArray.push(rsapi.post(\"/attachment/getEdit\".concat(inputParam.methodUrl), {\n          userinfo: inputParam.userInfo,\n          selectedrecord: inputParam.selectedRecord\n        }));\n      }\n\n      Axios.all(urlArray).then(response => {\n        let linkmaster = response[0].data.LinkMaster;\n        let selectedRecord = {};\n        const defaultLink = linkmaster.filter(item => item.ndefaultlink === transactionStatus.YES);\n        const linkmasterMap = constructOptionList(linkmaster || [], \"nattachmenttypecode\", \"slinkname\", undefined, undefined, true);\n        linkmaster = linkmasterMap.get(\"OptionList\");\n        let disabled = false;\n        let editObject = {};\n\n        if (inputParam.operation === \"update\") {\n          editObject = response[1].data;\n          let nlinkcode = {};\n          let link = {};\n\n          if (editObject.nattachmenttypecode === attachmentType.LINK) {\n            nlinkcode = {\n              \"label\": editObject.jsondata.slinkname,\n              \"value\": editObject.nlinkcode\n            };\n            link = {\n              slinkfilename: editObject.jsondata.sfilename,\n              slinkdescription: editObject.jsondata.sdescription,\n              sfilesize: '',\n              nfilesize: 0,\n              sfilename: '',\n              sdescription: ''\n            };\n          } else {\n            nlinkcode = defaultLink.length > 0 ? {\n              \"label\": defaultLink[0].slinkname,\n              \"value\": defaultLink[0].nlinkcode\n            } : \"\";\n            link = {\n              slinkfilename: '',\n              slinkdescription: '',\n              sfilesize: editObject.jsondata.sfilesize,\n              nfilesize: editObject.jsondata.nfilesize,\n              sfilename: editObject.jsondata.sfilename,\n              sdescription: editObject.jsondata.sdescription\n            };\n          }\n\n          selectedRecord = { // ...editObject,\n            ...link,\n            dcreateddate: editObject.dcreateddate,\n            groupingField: editObject.groupingField,\n            nattachmenttypecode: editObject.nattachmenttypecode,\n            nformcode: editObject.nformcode,\n            npreregno: editObject.npreregno,\n            nregattachmentcode: editObject.nregattachmentcode,\n            nsampleattachmentcode: editObject.nsampleattachmentcode,\n            nuserrolecode: editObject.nuserrolecode,\n            sarno: editObject.sarno,\n            screateddate: editObject.screateddate,\n            sdisplayname: editObject.sdisplayname,\n            ssystemfilename: editObject.ssystemfilename,\n            stypename: editObject.stypename,\n            susername: editObject.susername,\n            suserrolename: editObject.suserrolename,\n            nusercode: editObject.nusercode,\n            ntestattachmentcode: editObject.ntestattachmentcode,\n            ntransactionsamplecode: editObject.ntransactionsamplecode,\n            ntransactiontestcode: editObject.ntransactiontestcode,\n            nbatchfilecode: editObject.nbatchfilecode,\n            nreleasebatchcode: editObject.nreleasebatchcode,\n            nlinkcode,\n            stestsynonym: editObject.jsondata.stestsynonym // disabled: true\n\n          };\n        } else {\n          selectedRecord = {\n            nattachmenttypecode: response[0].data.AttachmentType.length > 0 ? response[0].data.AttachmentType[0].nattachmenttypecode : attachmentType.FTP,\n            nlinkcode: defaultLink.length > 0 ? {\n              \"label\": defaultLink[0].slinkname,\n              \"value\": defaultLink[0].nlinkcode\n            } : \"\",\n            disabled\n          };\n        }\n\n        dispatch({\n          type: DEFAULT_RETURN,\n          payload: {\n            [inputParam.modalName]: true,\n            operation: inputParam.operation,\n            screenName: inputParam.screenName,\n            ncontrolCode: inputParam.ncontrolCode,\n            selectedRecord,\n            loading: false,\n            linkMaster: linkmaster,\n            modalType: 'attachment',\n            modalName: [inputParam.modalName],\n            editFiles: editObject.nattachmenttypecode === attachmentType.FTP ? editObject : {}\n          }\n        });\n      }).catch(error => {\n        dispatch({\n          type: DEFAULT_RETURN,\n          payload: {\n            loading: false\n          }\n        });\n\n        if (error.response.status === 500) {\n          toast.error(error.message);\n        } else {\n          toast.warn(error.response.data);\n        }\n      });\n    } else {\n      toast.warn(intl.formatMessage({\n        id: inputParam.masterAlertStatus\n      }));\n    }\n  };\n}\nexport function deleteAttachment(deleteParam) {\n  return dispatch => {\n    const methodUrl = deleteParam.methodUrl;\n    const selected = deleteParam.selectedRecord;\n    const data = deleteParam.data;\n    let attachmentskip = deleteParam.skip;\n    let attachmenttake = deleteParam.take;\n\n    if (data.length === 1) {\n      if (attachmentskip > attachmenttake) {\n        attachmentskip = attachmentskip - attachmenttake;\n      } else if (attachmentskip >= attachmenttake) {\n        attachmentskip = 0;\n      }\n    }\n\n    const inputParam = {\n      inputData: {\n        [methodUrl.toLowerCase()]: selected,\n        nreleasebatchcode: deleteParam.nreleasebatchcode,\n        npreregno: deleteParam.npreregno,\n        ntransactiontestcode: deleteParam.ntransactiontestcode,\n        ntransactionsamplecode: deleteParam.ntransactionsamplecode,\n        userinfo: deleteParam.userInfo,\n        attachmentskip,\n        attachmenttake\n      },\n      classUrl: \"attachment\",\n      operation: 'delete',\n      methodUrl: methodUrl,\n      screenName: deleteParam.screenName,\n      attachmentskip,\n      attachmenttake\n    };\n    const masterData = deleteParam.masterData;\n\n    if (showEsign(deleteParam.esignRights, deleteParam.userInfo.nformcode, deleteParam.ncontrolCode)) {\n      // dispatch({\n      //     type: DEFAULT_RETURN,\n      //     payload: {\n      //         loadEsign: true,\n      //         screenData: { inputParam, masterData },\n      //         openAttachmentModal: true,\n      //         screenName: deleteParam.screenName,\n      //         operation: 'delete',\n      //         selectedRecord: {}\n      //     }\n      // });\n      const updateInfo = {\n        typeName: DEFAULT_RETURN,\n        data: {\n          loadEsign: true,\n          screenData: {\n            inputParam,\n            masterData\n          },\n          openAttachmentModal: true,\n          screenName: deleteParam.screenName,\n          operation: 'delete',\n          selectedRecord: {}\n        }\n      };\n      dispatch(updateStore(updateInfo));\n    } else {\n      dispatch(crudMaster(inputParam, masterData, \"openAttachmentModal\", {}));\n    }\n  };\n}","map":{"version":3,"sources":["D:/LIMSWFH/LIMSPOSTGRESQL/QuaLISWeb/src/actions/AttachmentsAction.js"],"names":["rsapi","toast","DEFAULT_RETURN","Axios","initRequest","updateStore","transactionStatus","attachmentType","constructOptionList","showEsign","crudMaster","intl","getAttachmentCombo","inputParam","dispatch","valid","masterList","Array","isArray","length","urlArray","post","userinfo","userInfo","operation","push","concat","methodUrl","selectedrecord","selectedRecord","all","then","response","linkmaster","data","LinkMaster","defaultLink","filter","item","ndefaultlink","YES","linkmasterMap","undefined","get","disabled","editObject","nlinkcode","link","nattachmenttypecode","LINK","jsondata","slinkname","slinkfilename","sfilename","slinkdescription","sdescription","sfilesize","nfilesize","dcreateddate","groupingField","nformcode","npreregno","nregattachmentcode","nsampleattachmentcode","nuserrolecode","sarno","screateddate","sdisplayname","ssystemfilename","stypename","susername","suserrolename","nusercode","ntestattachmentcode","ntransactionsamplecode","ntransactiontestcode","nbatchfilecode","nreleasebatchcode","stestsynonym","AttachmentType","FTP","type","payload","modalName","screenName","ncontrolCode","loading","linkMaster","modalType","editFiles","catch","error","status","message","warn","formatMessage","id","masterAlertStatus","deleteAttachment","deleteParam","selected","attachmentskip","skip","attachmenttake","take","inputData","toLowerCase","classUrl","masterData","esignRights","updateInfo","typeName","loadEsign","screenData","openAttachmentModal"],"mappings":"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","sourcesContent":["import rsapi from \"../rsapi\";\r\nimport { toast } from \"react-toastify\";\r\nimport { DEFAULT_RETURN } from \"./LoginTypes\";\r\nimport Axios from \"axios\";\r\nimport { initRequest, updateStore } from \"./LoginAction\";\r\nimport { transactionStatus, attachmentType } from \"../components/Enumeration\";\r\nimport { constructOptionList, showEsign } from \"../components/CommonScript\";\r\nimport { crudMaster } from './ServiceAction'\r\nimport { intl } from \"../components/App\";\r\n\r\nexport function getAttachmentCombo(inputParam) {\r\n    return (dispatch) => {\r\n        let valid = false;\r\n        if (inputParam.masterList){\r\n            if (Array.isArray(inputParam.masterList)){\r\n                if (inputParam.masterList.length > 0){\r\n                    valid = true;\r\n                }\r\n            }\r\n            else{\r\n                valid = true;\r\n            }\r\n        }\r\n        \r\n        //if (inputParam.masterList && inputParam.masterList.length > 0) {\r\n        if (valid){\r\n            dispatch(initRequest(true));\r\n            let urlArray = [rsapi.post(\"/linkmaster/getLinkMaster\", { userinfo: inputParam.userInfo })];\r\n            if (inputParam.operation === \"update\") {\r\n                urlArray.push(rsapi.post(\"/attachment/getEdit\".concat(inputParam.methodUrl), { userinfo: inputParam.userInfo, selectedrecord: inputParam.selectedRecord }))\r\n            }\r\n            Axios.all(urlArray)\r\n                .then(response => {\r\n                    let linkmaster = response[0].data.LinkMaster;\r\n                    let selectedRecord = {};\r\n                    const defaultLink = linkmaster.filter(item => item.ndefaultlink === transactionStatus.YES);\r\n                    const linkmasterMap  = constructOptionList(linkmaster || [], \"nattachmenttypecode\",\"slinkname\" , undefined, undefined, true);\r\n                    linkmaster = linkmasterMap.get(\"OptionList\");\r\n                    let disabled = false;\r\n                    let editObject = {};\r\n                    if (inputParam.operation === \"update\") {\r\n                        editObject = response[1].data;\r\n                        let nlinkcode = {};\r\n                        let link = {};\r\n                        if (editObject.nattachmenttypecode === attachmentType.LINK) {\r\n                            nlinkcode = { \"label\": editObject.jsondata.slinkname,\r\n                             \"value\": editObject.nlinkcode }\r\n                             link = {\r\n                                slinkfilename:editObject.jsondata.sfilename,\r\n                                slinkdescription:editObject.jsondata.sdescription,\r\n                                sfilesize:'',\r\n                                nfilesize:0,\r\n                                sfilename:'',\r\n                                sdescription:'',\r\n                            }\r\n                        } else {\r\n                            nlinkcode = defaultLink.length > 0 ?\r\n                             { \"label\": defaultLink[0].slinkname, \r\n                             \"value\": defaultLink[0].nlinkcode } : \"\"\r\n\r\n                             link = {\r\n                                slinkfilename:'',\r\n                                slinkdescription:'',\r\n                                sfilesize:editObject.jsondata.sfilesize,\r\n                                nfilesize:editObject.jsondata.nfilesize,\r\n                                sfilename:editObject.jsondata.sfilename,\r\n                                sdescription:editObject.jsondata.sdescription,\r\n                            }\r\n                        }\r\n                        selectedRecord = {\r\n                        // ...editObject,\r\n                        ...link,\r\n                           dcreateddate:editObject.dcreateddate,\r\n                           groupingField:editObject.groupingField,\r\n                           nattachmenttypecode:editObject.nattachmenttypecode,\r\n                           nformcode:editObject.nformcode,\r\n                           npreregno:editObject.npreregno,\r\n                           nregattachmentcode:editObject.nregattachmentcode,\r\n                           nsampleattachmentcode: editObject.nsampleattachmentcode,\r\n                           nuserrolecode:editObject.nuserrolecode,\r\n                           sarno:editObject.sarno,\r\n                           screateddate:editObject.screateddate,\r\n                           sdisplayname:editObject.sdisplayname,\r\n                           ssystemfilename:editObject.ssystemfilename,\r\n                           stypename:editObject.stypename,\r\n                           susername:editObject.susername,\r\n                           suserrolename:editObject.suserrolename,\r\n                           nusercode:editObject.nusercode,\r\n                           ntestattachmentcode:editObject.ntestattachmentcode,\r\n                           ntransactionsamplecode:editObject.ntransactionsamplecode,\r\n                           ntransactiontestcode:editObject.ntransactiontestcode,\r\n                           nbatchfilecode:editObject.nbatchfilecode,\r\n                           nreleasebatchcode:editObject.nreleasebatchcode,\r\n                           nlinkcode,\r\n                           stestsynonym:editObject.jsondata.stestsynonym\r\n                             // disabled: true\r\n                        };\r\n                    } else {\r\n                        selectedRecord = {\r\n                            nattachmenttypecode:response[0].data.AttachmentType.length>0?\r\n                            response[0].data.AttachmentType[0].nattachmenttypecode:attachmentType.FTP,\r\n                            nlinkcode: defaultLink.length > 0 ? { \"label\": defaultLink[0].slinkname, \"value\": defaultLink[0].nlinkcode } : \"\",\r\n                            disabled\r\n                        };\r\n                    }\r\n                    dispatch({\r\n                        type: DEFAULT_RETURN,\r\n                        payload: {\r\n                            [inputParam.modalName]: true,\r\n                            operation: inputParam.operation,\r\n                            screenName: inputParam.screenName,\r\n                            ncontrolCode: inputParam.ncontrolCode,\r\n                            selectedRecord, loading: false,\r\n                            linkMaster: linkmaster,\r\n                            modalType: 'attachment',\r\n                            modalName: [inputParam.modalName],\r\n                            editFiles: editObject.nattachmenttypecode === attachmentType.FTP ? editObject : {}\r\n                        }\r\n                    });\r\n                })\r\n                .catch(error => {\r\n                    dispatch({ type: DEFAULT_RETURN, payload: { loading: false } });\r\n                    if (error.response.status === 500) {\r\n                        toast.error(error.message);\r\n                    } else {\r\n                        toast.warn(error.response.data);\r\n                    }\r\n                });\r\n        } else {\r\n            toast.warn(intl.formatMessage({ id: inputParam.masterAlertStatus }))\r\n        }\r\n    }\r\n}\r\n\r\nexport function deleteAttachment(deleteParam) {\r\n    return (dispatch) => {\r\n        const methodUrl = deleteParam.methodUrl;\r\n        const selected = deleteParam.selectedRecord;\r\n\r\n         const data=deleteParam.data;\r\n         let attachmentskip=deleteParam.skip;\r\n         let attachmenttake=deleteParam.take;\r\n         if(data.length===1){\r\n              if(attachmentskip>attachmenttake){\r\n                attachmentskip=attachmentskip-attachmenttake;\r\n              }\r\n             else if(attachmentskip>=attachmenttake){\r\n                attachmentskip=0;\r\n              }\r\n         }\r\n\r\n        const inputParam = {\r\n            inputData: {\r\n                [methodUrl.toLowerCase()]: selected,\r\n                nreleasebatchcode:deleteParam.nreleasebatchcode,\r\n                npreregno: deleteParam.npreregno,\r\n                ntransactiontestcode: deleteParam.ntransactiontestcode,\r\n                ntransactionsamplecode: deleteParam.ntransactionsamplecode,\r\n                userinfo: deleteParam.userInfo,\r\n                attachmentskip,\r\n                attachmenttake,\r\n    \r\n            },\r\n            classUrl: \"attachment\",\r\n            operation: 'delete',\r\n            methodUrl: methodUrl,\r\n            screenName: deleteParam.screenName,\r\n            attachmentskip,\r\n            attachmenttake,\r\n\r\n        }\r\n        const masterData = deleteParam.masterData;\r\n        if (showEsign(deleteParam.esignRights, deleteParam.userInfo.nformcode, deleteParam.ncontrolCode)) {\r\n           \r\n            // dispatch({\r\n            //     type: DEFAULT_RETURN,\r\n            //     payload: {\r\n            //         loadEsign: true,\r\n            //         screenData: { inputParam, masterData },\r\n            //         openAttachmentModal: true,\r\n            //         screenName: deleteParam.screenName,\r\n            //         operation: 'delete',\r\n            //         selectedRecord: {}\r\n            //     }\r\n            // });\r\n            const updateInfo = {\r\n                typeName: DEFAULT_RETURN,\r\n                data: {   loadEsign: true,\r\n                            screenData: { inputParam, masterData },\r\n                            openAttachmentModal: true,\r\n                            screenName: deleteParam.screenName,\r\n                            operation: 'delete',\r\n                            selectedRecord: {} }\r\n            }\r\n            dispatch(updateStore(updateInfo));\r\n        } else {\r\n            dispatch(crudMaster(inputParam, masterData, \"openAttachmentModal\", {}));\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}