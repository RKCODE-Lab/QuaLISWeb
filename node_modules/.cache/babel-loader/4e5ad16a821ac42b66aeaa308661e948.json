{"ast":null,"code":"import TemplateService from './services/template-service';\nimport getter from './utils/getter';\nimport map from './utils/map';\n\nfunction defaultGroupHeaderTemplate(data) {\n  return data.title + \": \" + data.value;\n}\n\nfunction createArray(length, callback) {\n  var result = [];\n\n  for (var idx = 0; idx < length; idx++) {\n    result.push(callback(idx));\n  }\n\n  return result;\n}\n\nfunction defaultItemId(item) {\n  return item.id;\n}\n\nvar ExcelExporter = function ExcelExporter(options) {\n  options.columns = this._trimColumns(options.columns || []);\n  this.allColumns = map(this._leafColumns(options.columns || []), this._prepareColumn);\n  this.columns = this.allColumns.filter(function (column) {\n    return !column.hidden;\n  });\n  this.options = options;\n  this.data = options.data || [];\n  this.aggregates = options.aggregates || {};\n  this.groups = [].concat(options.groups || []);\n  this.hasGroups = this.groups.length > 0;\n  this.hierarchy = options.hierarchy;\n  this.hasGroupHeaderColumn = this.columns.some(function (column) {\n    return column.groupHeaderColumnTemplate;\n  });\n  this.collapsible = this.options.collapsible;\n};\n\nExcelExporter.prototype.workbook = function workbook() {\n  var workbook = {\n    sheets: [{\n      columns: this._columns(),\n      rows: this.hierarchy ? this._hierarchyRows() : this._rows(),\n      freezePane: this._freezePane(),\n      filter: this._filter()\n    }]\n  };\n  return workbook;\n};\n\nExcelExporter.prototype._trimColumns = function _trimColumns(columns) {\n  var this$1 = this;\n  return columns.filter(function (column) {\n    var result = Boolean(column.field);\n\n    if (!result && column.columns) {\n      result = this$1._trimColumns(column.columns).length > 0;\n    }\n\n    return result;\n  });\n};\n\nExcelExporter.prototype._leafColumns = function _leafColumns(columns) {\n  var this$1 = this;\n  var result = [];\n\n  for (var idx = 0; idx < columns.length; idx++) {\n    if (!columns[idx].columns) {\n      result.push(columns[idx]);\n    } else {\n      result = result.concat(this$1._leafColumns(columns[idx].columns));\n    }\n  }\n\n  return result;\n};\n\nExcelExporter.prototype._prepareColumn = function _prepareColumn(column) {\n  if (!column.field) {\n    return null;\n  }\n\n  var value = function value(dataItem) {\n    return getter(column.field, true)(dataItem);\n  };\n\n  var values = null;\n\n  if (column.values) {\n    values = {};\n    column.values.forEach(function (item) {\n      values[item.value] = item.text;\n    });\n\n    value = function value(dataItem) {\n      return values[getter(column.field, true)(dataItem)];\n    };\n  }\n\n  return Object.assign({}, column, {\n    value: value,\n    values: values,\n    groupHeaderTemplate: column.groupHeaderTemplate ? TemplateService.compile(column.groupHeaderTemplate) : defaultGroupHeaderTemplate,\n    groupHeaderColumnTemplate: column.groupHeaderColumnTemplate ? TemplateService.compile(column.groupHeaderColumnTemplate) : null,\n    groupFooterTemplate: column.groupFooterTemplate ? TemplateService.compile(column.groupFooterTemplate) : null,\n    footerTemplate: column.footerTemplate ? TemplateService.compile(column.footerTemplate) : null\n  });\n};\n\nExcelExporter.prototype._filter = function _filter() {\n  if (!this.options.filterable) {\n    return null;\n  }\n\n  var depth = this._depth();\n\n  return {\n    from: depth,\n    to: depth + this.columns.length - 1\n  };\n};\n\nExcelExporter.prototype._createPaddingCells = function _createPaddingCells(length) {\n  var this$1 = this;\n  return createArray(length, function () {\n    return Object.assign({\n      background: \"#dfdfdf\",\n      color: \"#333\"\n    }, this$1.options.paddingCellOptions);\n  });\n};\n\nExcelExporter.prototype._dataRow = function _dataRow(dataItem, level, depth) {\n  var this$1 = this;\n\n  var cells = this._createPaddingCells(level); // grouped\n\n\n  if (this.hasGroups && depth && dataItem.items) {\n    cells = cells.concat(this._groupHeaderCells(dataItem, level, depth));\n\n    var rows = this._dataRows(dataItem.items, level + 1);\n\n    rows.unshift({\n      type: \"group-header\",\n      cells: cells,\n      level: this.collapsible ? level : null\n    });\n    return rows.concat(this._footer(dataItem, level));\n  }\n\n  var dataCells = [];\n\n  for (var cellIdx = 0; cellIdx < this.columns.length; cellIdx++) {\n    dataCells[cellIdx] = this$1._cell(dataItem, this$1.columns[cellIdx]);\n  }\n\n  if (this.hierarchy) {\n    dataCells[0].colSpan = depth - level + 1;\n  }\n\n  return [{\n    type: \"data\",\n    cells: cells.concat(dataCells),\n    level: this.collapsible ? level : null\n  }];\n};\n\nExcelExporter.prototype._groupHeaderCells = function _groupHeaderCells(dataItem, level, depth) {\n  var cells = [];\n  var column = this.allColumns.filter(function (column) {\n    return column.field === dataItem.field;\n  })[0] || {};\n  var title = column && column.title ? column.title : dataItem.field;\n  var template = column ? column.groupHeaderTemplate || column.groupHeaderColumnTemplate : null;\n  var group = Object.assign({\n    title: title,\n    field: dataItem.field,\n    value: column && column.values ? column.values[dataItem.value] : dataItem.value,\n    aggregates: dataItem.aggregates,\n    items: dataItem.items\n  }, dataItem.aggregates[dataItem.field]);\n  var value = template ? template(group) : title + \": \" + dataItem.value;\n  cells.push(Object.assign({\n    value: value,\n    background: \"#dfdfdf\",\n    color: \"#333\",\n    colSpan: (this.hasGroupHeaderColumn ? 1 : this.columns.length) + depth - level\n  }, column.groupHeaderCellOptions));\n\n  if (this.hasGroupHeaderColumn) {\n    this.columns.forEach(function (column, index) {\n      if (index > 0) {\n        cells.push(Object.assign({\n          background: \"#dfdfdf\",\n          color: \"#333\",\n          value: column.groupHeaderColumnTemplate ? column.groupHeaderColumnTemplate(Object.assign({\n            group: group\n          }, group, dataItem.aggregates[column.field])) : undefined\n        }, column.groupHeaderCellOptions));\n      }\n    });\n  }\n\n  return cells;\n};\n\nExcelExporter.prototype._dataRows = function _dataRows(dataItems, level) {\n  var this$1 = this;\n\n  var depth = this._depth();\n\n  var rows = [];\n\n  for (var idx = 0; idx < dataItems.length; idx++) {\n    rows.push.apply(rows, this$1._dataRow(dataItems[idx], level, depth));\n  }\n\n  return rows;\n};\n\nExcelExporter.prototype._hierarchyRows = function _hierarchyRows() {\n  var this$1 = this;\n\n  var depth = this._depth();\n\n  var data = this.data;\n  var itemLevel = this.hierarchy.itemLevel;\n  var itemId = this.hierarchy.itemId || defaultItemId;\n\n  var hasFooter = this._hasFooterTemplate();\n\n  var rows = [];\n  var parents = [];\n  var previousLevel = 0;\n  var previousItemId;\n\n  if (!hasFooter) {\n    this.collapsible = false;\n  }\n\n  for (var idx = 0; idx < data.length; idx++) {\n    var item = data[idx];\n    var level = itemLevel(item, idx);\n\n    if (hasFooter) {\n      if (level > previousLevel) {\n        parents.push({\n          id: previousItemId,\n          level: previousLevel\n        });\n      } else if (level < previousLevel) {\n        rows.push.apply(rows, this$1._hierarchyFooterRows(parents, level, depth));\n      }\n\n      previousLevel = level;\n      previousItemId = itemId(item, idx);\n    }\n\n    rows.push.apply(rows, this$1._dataRow(item, level + 1, depth));\n  }\n\n  if (hasFooter) {\n    rows.push.apply(rows, this._hierarchyFooterRows(parents, 0, depth));\n    var rootAggregate = data.length ? this.aggregates[data[0].parentId] : {};\n    rows.push(this._hierarchyFooter(rootAggregate, 0, depth));\n  }\n\n  this._prependHeaderRows(rows);\n\n  return rows;\n};\n\nExcelExporter.prototype._hierarchyFooterRows = function _hierarchyFooterRows(parents, currentLevel, depth) {\n  var this$1 = this;\n  var rows = [];\n\n  while (parents.length && parents[parents.length - 1].level >= currentLevel) {\n    var parent = parents.pop();\n    rows.push(this$1._hierarchyFooter(this$1.aggregates[parent.id], parent.level + 1, depth));\n  }\n\n  return rows;\n};\n\nExcelExporter.prototype._hasFooterTemplate = function _hasFooterTemplate() {\n  var columns = this.columns;\n\n  for (var idx = 0; idx < columns.length; idx++) {\n    if (columns[idx].footerTemplate) {\n      return true;\n    }\n  }\n};\n\nExcelExporter.prototype._hierarchyFooter = function _hierarchyFooter(aggregates, level, depth) {\n  var cells = this.columns.map(function (column, index) {\n    var colSpan = index ? 1 : depth - level + 1;\n\n    if (column.footerTemplate) {\n      var fieldAggregates = (aggregates || {})[column.field];\n      return Object.assign({\n        background: \"#dfdfdf\",\n        color: \"#333\",\n        colSpan: colSpan,\n        value: column.footerTemplate(Object.assign({\n          aggregates: aggregates\n        }, fieldAggregates))\n      }, column.footerCellOptions);\n    }\n\n    return Object.assign({\n      background: \"#dfdfdf\",\n      color: \"#333\",\n      colSpan: colSpan\n    }, column.footerCellOptions);\n  });\n  return {\n    type: \"footer\",\n    cells: this._createPaddingCells(level).concat(cells),\n    level: this.collapsible ? level : null\n  };\n};\n\nExcelExporter.prototype._footer = function _footer(dataItem, level) {\n  var rows = [];\n  var footer = this.columns.some(function (column) {\n    return column.groupFooterTemplate;\n  });\n  var templateData, group;\n\n  if (footer) {\n    group = {\n      group: {\n        items: dataItem.items,\n        field: dataItem.field,\n        value: dataItem.value\n      }\n    };\n    templateData = {};\n    Object.keys(dataItem.aggregates).forEach(function (key) {\n      templateData[key] = Object.assign({}, dataItem.aggregates[key], group);\n    });\n  }\n\n  var cells = this.columns.map(function (column) {\n    if (column.groupFooterTemplate) {\n      var data = Object.assign({}, templateData, dataItem.aggregates[column.field], group);\n      return Object.assign({\n        background: \"#dfdfdf\",\n        color: \"#333\",\n        value: column.groupFooterTemplate(data)\n      }, column.groupFooterCellOptions);\n    }\n\n    return Object.assign({\n      background: \"#dfdfdf\",\n      color: \"#333\"\n    }, column.groupFooterCellOptions);\n  });\n\n  if (footer) {\n    rows.push({\n      type: \"group-footer\",\n      cells: this._createPaddingCells(this.groups.length).concat(cells),\n      level: this.collapsible ? level : null\n    });\n  }\n\n  return rows;\n};\n\nExcelExporter.prototype._isColumnVisible = function _isColumnVisible(column) {\n  return this._visibleColumns([column]).length > 0 && (column.field || column.columns);\n};\n\nExcelExporter.prototype._visibleColumns = function _visibleColumns(columns) {\n  var this$1 = this;\n  return columns.filter(function (column) {\n    var result = !column.hidden;\n\n    if (result && column.columns) {\n      result = this$1._visibleColumns(column.columns).length > 0;\n    }\n\n    return result;\n  });\n};\n\nExcelExporter.prototype._headerRow = function _headerRow(row, groups) {\n  var this$1 = this;\n  var headers = row.cells.map(function (cell) {\n    return Object.assign(cell, {\n      colSpan: cell.colSpan > 1 ? cell.colSpan : 1,\n      rowSpan: row.rowSpan > 1 && !cell.colSpan ? row.rowSpan : 1\n    });\n  });\n\n  if (this.hierarchy && headers[0].firstCell) {\n    headers[0].colSpan += this._depth();\n  }\n\n  return {\n    type: \"header\",\n    cells: createArray(groups.length, function () {\n      return Object.assign({\n        background: \"#7a7a7a\",\n        color: \"#fff\"\n      }, this$1.options.headerPaddingCellOptions);\n    }).concat(headers)\n  };\n};\n\nExcelExporter.prototype._prependHeaderRows = function _prependHeaderRows(rows) {\n  var this$1 = this;\n  var groups = this.groups;\n  var headerRows = [{\n    rowSpan: 1,\n    cells: [],\n    index: 0\n  }];\n\n  this._prepareHeaderRows(headerRows, this.options.columns);\n\n  for (var idx = headerRows.length - 1; idx >= 0; idx--) {\n    rows.unshift(this$1._headerRow(headerRows[idx], groups));\n  }\n};\n\nExcelExporter.prototype._prepareHeaderRows = function _prepareHeaderRows(rows, columns, parentCell, parentRow) {\n  var this$1 = this;\n  var row = parentRow || rows[rows.length - 1];\n  var childRow = rows[row.index + 1];\n  var totalColSpan = 0;\n\n  for (var idx = 0; idx < columns.length; idx++) {\n    var column = columns[idx];\n\n    if (this$1._isColumnVisible(column)) {\n      var cell = Object.assign({\n        background: \"#7a7a7a\",\n        color: \"#fff\",\n        value: column.title || column.field,\n        colSpan: 0,\n        firstCell: idx === 0 && (!parentCell || parentCell.firstCell)\n      }, column.headerCellOptions);\n      row.cells.push(cell);\n\n      if (column.columns && column.columns.length) {\n        if (!childRow) {\n          childRow = {\n            rowSpan: 0,\n            cells: [],\n            index: rows.length\n          };\n          rows.push(childRow);\n        }\n\n        cell.colSpan = this$1._trimColumns(this$1._visibleColumns(column.columns)).length;\n\n        this$1._prepareHeaderRows(rows, column.columns, cell, childRow);\n\n        totalColSpan += cell.colSpan - 1;\n        row.rowSpan = rows.length - row.index;\n      }\n    }\n  }\n\n  if (parentCell) {\n    parentCell.colSpan += totalColSpan;\n  }\n};\n\nExcelExporter.prototype._rows = function _rows() {\n  var this$1 = this;\n\n  var rows = this._dataRows(this.data, 0);\n\n  if (this.columns.length) {\n    this._prependHeaderRows(rows);\n\n    var footer = false;\n    var cells = this.columns.map(function (column) {\n      if (column.footerTemplate) {\n        footer = true;\n        return Object.assign({\n          background: \"#dfdfdf\",\n          color: \"#333\",\n          value: column.footerTemplate(Object.assign({}, this$1.aggregates, this$1.aggregates[column.field]))\n        }, column.footerCellOptions);\n      }\n\n      return Object.assign({\n        background: \"#dfdfdf\",\n        color: \"#333\"\n      }, column.footerCellOptions);\n    });\n\n    if (footer) {\n      rows.push({\n        type: \"footer\",\n        cells: this._createPaddingCells(this.groups.length).concat(cells)\n      });\n    }\n  }\n\n  return rows;\n};\n\nExcelExporter.prototype._headerDepth = function _headerDepth(columns) {\n  var this$1 = this;\n  var result = 1;\n  var max = 0;\n\n  for (var idx = 0; idx < columns.length; idx++) {\n    if (columns[idx].columns) {\n      var temp = this$1._headerDepth(columns[idx].columns);\n\n      if (temp > max) {\n        max = temp;\n      }\n    }\n  }\n\n  return result + max;\n};\n\nExcelExporter.prototype._freezePane = function _freezePane() {\n  var columns = this._visibleColumns(this.options.columns || []);\n\n  var colSplit = this._visibleColumns(this._trimColumns(this._leafColumns(columns.filter(function (column) {\n    return column.locked;\n  })))).length;\n\n  return {\n    rowSplit: this._headerDepth(columns),\n    colSplit: colSplit ? colSplit + this.groups.length : 0\n  };\n};\n\nExcelExporter.prototype._cell = function _cell(dataItem, column) {\n  return Object.assign({\n    value: column.value(dataItem)\n  }, column.cellOptions);\n};\n\nExcelExporter.prototype._depth = function _depth() {\n  var depth = 0;\n\n  if (this.hierarchy) {\n    depth = this.hierarchy.depth;\n  } else {\n    depth = this.groups.length;\n  }\n\n  return depth;\n};\n\nExcelExporter.prototype._columns = function _columns() {\n  var depth = this._depth();\n\n  var columns = createArray(depth, function () {\n    return {\n      width: 20\n    };\n  });\n  return columns.concat(this.columns.map(function (column) {\n    return {\n      width: parseInt(column.width, 10),\n      autoWidth: column.width ? false : true\n    };\n  }));\n};\n\nexport default ExcelExporter;","map":{"version":3,"sources":["D:/LIMSWFH/LIMSPOSTGRESQL/QuaLISWeb/node_modules/@progress/kendo-ooxml/dist/es/excel-exporter.js"],"names":["TemplateService","getter","map","defaultGroupHeaderTemplate","data","title","value","createArray","length","callback","result","idx","push","defaultItemId","item","id","ExcelExporter","options","columns","_trimColumns","allColumns","_leafColumns","_prepareColumn","filter","column","hidden","aggregates","groups","concat","hasGroups","hierarchy","hasGroupHeaderColumn","some","groupHeaderColumnTemplate","collapsible","prototype","workbook","sheets","_columns","rows","_hierarchyRows","_rows","freezePane","_freezePane","_filter","this$1","Boolean","field","dataItem","values","forEach","text","Object","assign","groupHeaderTemplate","compile","groupFooterTemplate","footerTemplate","filterable","depth","_depth","from","to","_createPaddingCells","background","color","paddingCellOptions","_dataRow","level","cells","items","_groupHeaderCells","_dataRows","unshift","type","_footer","dataCells","cellIdx","_cell","colSpan","template","group","groupHeaderCellOptions","index","undefined","dataItems","apply","itemLevel","itemId","hasFooter","_hasFooterTemplate","parents","previousLevel","previousItemId","_hierarchyFooterRows","rootAggregate","parentId","_hierarchyFooter","_prependHeaderRows","currentLevel","parent","pop","fieldAggregates","footerCellOptions","footer","templateData","keys","key","groupFooterCellOptions","_isColumnVisible","_visibleColumns","_headerRow","row","headers","cell","rowSpan","firstCell","headerPaddingCellOptions","headerRows","_prepareHeaderRows","parentCell","parentRow","childRow","totalColSpan","headerCellOptions","_headerDepth","max","temp","colSplit","locked","rowSplit","cellOptions","width","parseInt","autoWidth"],"mappings":"AAAA,OAAOA,eAAP,MAA4B,6BAA5B;AACA,OAAOC,MAAP,MAAmB,gBAAnB;AACA,OAAOC,GAAP,MAAgB,aAAhB;;AAEA,SAASC,0BAAT,CAAoCC,IAApC,EAA0C;AACtC,SAASA,IAAI,CAACC,KAAN,GAAe,IAAf,GAAuBD,IAAI,CAACE,KAApC;AACH;;AAED,SAASC,WAAT,CAAqBC,MAArB,EAA6BC,QAA7B,EAAuC;AACnC,MAAIC,MAAM,GAAG,EAAb;;AAEA,OAAK,IAAIC,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGH,MAAxB,EAAgCG,GAAG,EAAnC,EAAuC;AACnCD,IAAAA,MAAM,CAACE,IAAP,CAAYH,QAAQ,CAACE,GAAD,CAApB;AACH;;AAED,SAAOD,MAAP;AACH;;AAED,SAASG,aAAT,CAAuBC,IAAvB,EAA6B;AACzB,SAAOA,IAAI,CAACC,EAAZ;AACH;;AAED,IAAIC,aAAa,GAAG,SAASA,aAAT,CAAuBC,OAAvB,EAAgC;AAChDA,EAAAA,OAAO,CAACC,OAAR,GAAkB,KAAKC,YAAL,CAAkBF,OAAO,CAACC,OAAR,IAAmB,EAArC,CAAlB;AAEA,OAAKE,UAAL,GAAkBlB,GAAG,CAAC,KAAKmB,YAAL,CAAkBJ,OAAO,CAACC,OAAR,IAAmB,EAArC,CAAD,EAA2C,KAAKI,cAAhD,CAArB;AAEA,OAAKJ,OAAL,GAAe,KAAKE,UAAL,CAAgBG,MAAhB,CAAuB,UAASC,MAAT,EAAiB;AAAE,WAAO,CAACA,MAAM,CAACC,MAAf;AAAwB,GAAlE,CAAf;AAEA,OAAKR,OAAL,GAAeA,OAAf;AACA,OAAKb,IAAL,GAAYa,OAAO,CAACb,IAAR,IAAgB,EAA5B;AACA,OAAKsB,UAAL,GAAkBT,OAAO,CAACS,UAAR,IAAsB,EAAxC;AACA,OAAKC,MAAL,GAAc,GAAGC,MAAH,CAAUX,OAAO,CAACU,MAAR,IAAkB,EAA5B,CAAd;AACA,OAAKE,SAAL,GAAiB,KAAKF,MAAL,CAAYnB,MAAZ,GAAqB,CAAtC;AACA,OAAKsB,SAAL,GAAiBb,OAAO,CAACa,SAAzB;AACA,OAAKC,oBAAL,GAA4B,KAAKb,OAAL,CAAac,IAAb,CAAkB,UAAUR,MAAV,EAAkB;AAAE,WAAOA,MAAM,CAACS,yBAAd;AAA0C,GAAhF,CAA5B;AACA,OAAKC,WAAL,GAAmB,KAAKjB,OAAL,CAAaiB,WAAhC;AACH,CAfD;;AAiBAlB,aAAa,CAACmB,SAAd,CAAwBC,QAAxB,GAAmC,SAASA,QAAT,GAAqB;AACpD,MAAIA,QAAQ,GAAG;AACXC,IAAAA,MAAM,EAAE,CAAE;AACNnB,MAAAA,OAAO,EAAE,KAAKoB,QAAL,EADH;AAENC,MAAAA,IAAI,EAAE,KAAKT,SAAL,GAAiB,KAAKU,cAAL,EAAjB,GAAyC,KAAKC,KAAL,EAFzC;AAGNC,MAAAA,UAAU,EAAE,KAAKC,WAAL,EAHN;AAINpB,MAAAA,MAAM,EAAE,KAAKqB,OAAL;AAJF,KAAF;AADG,GAAf;AASA,SAAOR,QAAP;AACH,CAXD;;AAaApB,aAAa,CAACmB,SAAd,CAAwBhB,YAAxB,GAAuC,SAASA,YAAT,CAAuBD,OAAvB,EAAgC;AAC/D,MAAI2B,MAAM,GAAG,IAAb;AAEJ,SAAO3B,OAAO,CAACK,MAAR,CAAe,UAAUC,MAAV,EAAkB;AACpC,QAAId,MAAM,GAAGoC,OAAO,CAACtB,MAAM,CAACuB,KAAR,CAApB;;AAEA,QAAI,CAACrC,MAAD,IAAWc,MAAM,CAACN,OAAtB,EAA+B;AAC3BR,MAAAA,MAAM,GAAGmC,MAAM,CAAC1B,YAAP,CAAoBK,MAAM,CAACN,OAA3B,EAAoCV,MAApC,GAA6C,CAAtD;AACH;;AAED,WAAOE,MAAP;AACH,GARM,CAAP;AASH,CAZD;;AAcAM,aAAa,CAACmB,SAAd,CAAwBd,YAAxB,GAAuC,SAASA,YAAT,CAAuBH,OAAvB,EAAgC;AAC/D,MAAI2B,MAAM,GAAG,IAAb;AAEJ,MAAInC,MAAM,GAAG,EAAb;;AAEA,OAAK,IAAIC,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGO,OAAO,CAACV,MAAhC,EAAwCG,GAAG,EAA3C,EAA+C;AAC3C,QAAI,CAACO,OAAO,CAACP,GAAD,CAAP,CAAaO,OAAlB,EAA2B;AACvBR,MAAAA,MAAM,CAACE,IAAP,CAAYM,OAAO,CAACP,GAAD,CAAnB;AACH,KAFD,MAEO;AACHD,MAAAA,MAAM,GAAGA,MAAM,CAACkB,MAAP,CAAciB,MAAM,CAACxB,YAAP,CAAoBH,OAAO,CAACP,GAAD,CAAP,CAAaO,OAAjC,CAAd,CAAT;AACH;AACJ;;AAED,SAAOR,MAAP;AACH,CAdD;;AAgBAM,aAAa,CAACmB,SAAd,CAAwBb,cAAxB,GAAyC,SAASA,cAAT,CAAyBE,MAAzB,EAAiC;AACtE,MAAI,CAACA,MAAM,CAACuB,KAAZ,EAAmB;AACf,WAAO,IAAP;AACH;;AAED,MAAIzC,KAAK,GAAG,eAAS0C,QAAT,EAAmB;AAC3B,WAAO/C,MAAM,CAACuB,MAAM,CAACuB,KAAR,EAAe,IAAf,CAAN,CAA2BC,QAA3B,CAAP;AACH,GAFD;;AAIA,MAAIC,MAAM,GAAG,IAAb;;AAEA,MAAIzB,MAAM,CAACyB,MAAX,EAAmB;AACfA,IAAAA,MAAM,GAAG,EAAT;AAEAzB,IAAAA,MAAM,CAACyB,MAAP,CAAcC,OAAd,CAAsB,UAASpC,IAAT,EAAe;AACjCmC,MAAAA,MAAM,CAACnC,IAAI,CAACR,KAAN,CAAN,GAAqBQ,IAAI,CAACqC,IAA1B;AACH,KAFD;;AAIA7C,IAAAA,KAAK,GAAG,eAAS0C,QAAT,EAAmB;AACvB,aAAOC,MAAM,CAAChD,MAAM,CAACuB,MAAM,CAACuB,KAAR,EAAe,IAAf,CAAN,CAA2BC,QAA3B,CAAD,CAAb;AACH,KAFD;AAGH;;AAED,SAAOI,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB7B,MAAlB,EAA0B;AAC7BlB,IAAAA,KAAK,EAAEA,KADsB;AAE7B2C,IAAAA,MAAM,EAAEA,MAFqB;AAG7BK,IAAAA,mBAAmB,EAAE9B,MAAM,CAAC8B,mBAAP,GAA6BtD,eAAe,CAACuD,OAAhB,CAAwB/B,MAAM,CAAC8B,mBAA/B,CAA7B,GAAmFnD,0BAH3E;AAI7B8B,IAAAA,yBAAyB,EAAET,MAAM,CAACS,yBAAP,GAAmCjC,eAAe,CAACuD,OAAhB,CAAwB/B,MAAM,CAACS,yBAA/B,CAAnC,GAA+F,IAJ7F;AAK7BuB,IAAAA,mBAAmB,EAAEhC,MAAM,CAACgC,mBAAP,GAA6BxD,eAAe,CAACuD,OAAhB,CAAwB/B,MAAM,CAACgC,mBAA/B,CAA7B,GAAmF,IAL3E;AAM7BC,IAAAA,cAAc,EAAEjC,MAAM,CAACiC,cAAP,GAAwBzD,eAAe,CAACuD,OAAhB,CAAwB/B,MAAM,CAACiC,cAA/B,CAAxB,GAAyE;AAN5D,GAA1B,CAAP;AAQH,CA/BD;;AAiCAzC,aAAa,CAACmB,SAAd,CAAwBS,OAAxB,GAAkC,SAASA,OAAT,GAAoB;AAClD,MAAI,CAAC,KAAK3B,OAAL,CAAayC,UAAlB,EAA8B;AAC1B,WAAO,IAAP;AACH;;AAED,MAAIC,KAAK,GAAG,KAAKC,MAAL,EAAZ;;AAEA,SAAO;AACHC,IAAAA,IAAI,EAAEF,KADH;AAEHG,IAAAA,EAAE,EAAEH,KAAK,GAAG,KAAKzC,OAAL,CAAaV,MAArB,GAA8B;AAF/B,GAAP;AAIH,CAXD;;AAaAQ,aAAa,CAACmB,SAAd,CAAwB4B,mBAAxB,GAA8C,SAASA,mBAAT,CAA8BvD,MAA9B,EAAsC;AAC5E,MAAIqC,MAAM,GAAG,IAAb;AAEJ,SAAOtC,WAAW,CAACC,MAAD,EAAS,YAAY;AAAE,WAAO4C,MAAM,CAACC,MAAP,CAAc;AAC1DW,MAAAA,UAAU,EAAE,SAD8C;AAE1DC,MAAAA,KAAK,EAAE;AAFmD,KAAd,EAG7CpB,MAAM,CAAC5B,OAAP,CAAeiD,kBAH8B,CAAP;AAGD,GAHtB,CAAlB;AAIH,CAPD;;AASAlD,aAAa,CAACmB,SAAd,CAAwBgC,QAAxB,GAAmC,SAASA,QAAT,CAAmBnB,QAAnB,EAA6BoB,KAA7B,EAAoCT,KAApC,EAA2C;AACtE,MAAId,MAAM,GAAG,IAAb;;AAEJ,MAAIwB,KAAK,GAAG,KAAKN,mBAAL,CAAyBK,KAAzB,CAAZ,CAH0E,CAK1E;;;AACA,MAAI,KAAKvC,SAAL,IAAkB8B,KAAlB,IAA2BX,QAAQ,CAACsB,KAAxC,EAA+C;AAC3CD,IAAAA,KAAK,GAAGA,KAAK,CAACzC,MAAN,CAAa,KAAK2C,iBAAL,CAAuBvB,QAAvB,EAAiCoB,KAAjC,EAAwCT,KAAxC,CAAb,CAAR;;AACA,QAAIpB,IAAI,GAAG,KAAKiC,SAAL,CAAexB,QAAQ,CAACsB,KAAxB,EAA+BF,KAAK,GAAG,CAAvC,CAAX;;AAEA7B,IAAAA,IAAI,CAACkC,OAAL,CAAa;AACTC,MAAAA,IAAI,EAAE,cADG;AAETL,MAAAA,KAAK,EAAEA,KAFE;AAGTD,MAAAA,KAAK,EAAE,KAAKlC,WAAL,GAAmBkC,KAAnB,GAA2B;AAHzB,KAAb;AAMA,WAAO7B,IAAI,CAACX,MAAL,CAAY,KAAK+C,OAAL,CAAa3B,QAAb,EAAuBoB,KAAvB,CAAZ,CAAP;AACH;;AAED,MAAIQ,SAAS,GAAG,EAAhB;;AAEA,OAAK,IAAIC,OAAO,GAAG,CAAnB,EAAsBA,OAAO,GAAG,KAAK3D,OAAL,CAAaV,MAA7C,EAAqDqE,OAAO,EAA5D,EAAgE;AAC5DD,IAAAA,SAAS,CAACC,OAAD,CAAT,GAAqBhC,MAAM,CAACiC,KAAP,CAAa9B,QAAb,EAAuBH,MAAM,CAAC3B,OAAP,CAAe2D,OAAf,CAAvB,CAArB;AACH;;AAED,MAAI,KAAK/C,SAAT,EAAoB;AAChB8C,IAAAA,SAAS,CAAC,CAAD,CAAT,CAAaG,OAAb,GAAuBpB,KAAK,GAAGS,KAAR,GAAgB,CAAvC;AACH;;AAED,SAAO,CAAE;AACLM,IAAAA,IAAI,EAAE,MADD;AAELL,IAAAA,KAAK,EAAEA,KAAK,CAACzC,MAAN,CAAagD,SAAb,CAFF;AAGLR,IAAAA,KAAK,EAAE,KAAKlC,WAAL,GAAmBkC,KAAnB,GAA2B;AAH7B,GAAF,CAAP;AAKH,CAlCD;;AAoCApD,aAAa,CAACmB,SAAd,CAAwBoC,iBAAxB,GAA4C,SAASA,iBAAT,CAA4BvB,QAA5B,EAAsCoB,KAAtC,EAA6CT,KAA7C,EAAoD;AAC5F,MAAIU,KAAK,GAAG,EAAZ;AAEA,MAAI7C,MAAM,GAAG,KAAKJ,UAAL,CAAgBG,MAAhB,CAAuB,UAASC,MAAT,EAAiB;AACjD,WAAOA,MAAM,CAACuB,KAAP,KAAiBC,QAAQ,CAACD,KAAjC;AACH,GAFY,EAEV,CAFU,KAEJ,EAFT;AAIA,MAAI1C,KAAK,GAAGmB,MAAM,IAAIA,MAAM,CAACnB,KAAjB,GAAyBmB,MAAM,CAACnB,KAAhC,GAAwC2C,QAAQ,CAACD,KAA7D;AACA,MAAIiC,QAAQ,GAAGxD,MAAM,GAAGA,MAAM,CAAC8B,mBAAP,IAA8B9B,MAAM,CAACS,yBAAxC,GAAoE,IAAzF;AACA,MAAIgD,KAAK,GAAG7B,MAAM,CAACC,MAAP,CAAc;AACtBhD,IAAAA,KAAK,EAAEA,KADe;AAEtB0C,IAAAA,KAAK,EAAEC,QAAQ,CAACD,KAFM;AAGtBzC,IAAAA,KAAK,EAAEkB,MAAM,IAAIA,MAAM,CAACyB,MAAjB,GAA0BzB,MAAM,CAACyB,MAAP,CAAcD,QAAQ,CAAC1C,KAAvB,CAA1B,GAA0D0C,QAAQ,CAAC1C,KAHpD;AAItBoB,IAAAA,UAAU,EAAEsB,QAAQ,CAACtB,UAJC;AAKtB4C,IAAAA,KAAK,EAAEtB,QAAQ,CAACsB;AALM,GAAd,EAMTtB,QAAQ,CAACtB,UAAT,CAAoBsB,QAAQ,CAACD,KAA7B,CANS,CAAZ;AAQA,MAAIzC,KAAK,GAAG0E,QAAQ,GAAGA,QAAQ,CAACC,KAAD,CAAX,GAAsB5E,KAAK,GAAG,IAAR,GAAgB2C,QAAQ,CAAC1C,KAAnE;AAEA+D,EAAAA,KAAK,CAACzD,IAAN,CAAWwC,MAAM,CAACC,MAAP,CAAc;AACrB/C,IAAAA,KAAK,EAAEA,KADc;AAErB0D,IAAAA,UAAU,EAAE,SAFS;AAGrBC,IAAAA,KAAK,EAAE,MAHc;AAIrBc,IAAAA,OAAO,EAAE,CAAC,KAAKhD,oBAAL,GAA4B,CAA5B,GAAgC,KAAKb,OAAL,CAAaV,MAA9C,IAAwDmD,KAAxD,GAAgES;AAJpD,GAAd,EAKR5C,MAAM,CAAC0D,sBALC,CAAX;;AAOA,MAAI,KAAKnD,oBAAT,EAA+B;AAC3B,SAAKb,OAAL,CAAagC,OAAb,CAAqB,UAAS1B,MAAT,EAAiB2D,KAAjB,EAAwB;AACzC,UAAIA,KAAK,GAAG,CAAZ,EAAe;AACXd,QAAAA,KAAK,CAACzD,IAAN,CAAWwC,MAAM,CAACC,MAAP,CAAc;AACrBW,UAAAA,UAAU,EAAE,SADS;AAErBC,UAAAA,KAAK,EAAE,MAFc;AAGrB3D,UAAAA,KAAK,EAAEkB,MAAM,CAACS,yBAAP,GACHT,MAAM,CAACS,yBAAP,CAAiCmB,MAAM,CAACC,MAAP,CAAc;AAAE4B,YAAAA,KAAK,EAAEA;AAAT,WAAd,EAAgCA,KAAhC,EAAuCjC,QAAQ,CAACtB,UAAT,CAAoBF,MAAM,CAACuB,KAA3B,CAAvC,CAAjC,CADG,GAEHqC;AALiB,SAAd,EAMR5D,MAAM,CAAC0D,sBANC,CAAX;AAOH;AACJ,KAVD;AAWH;;AAED,SAAOb,KAAP;AACH,CAzCD;;AA2CArD,aAAa,CAACmB,SAAd,CAAwBqC,SAAxB,GAAoC,SAASA,SAAT,CAAoBa,SAApB,EAA+BjB,KAA/B,EAAsC;AAClE,MAAIvB,MAAM,GAAG,IAAb;;AAEJ,MAAIc,KAAK,GAAG,KAAKC,MAAL,EAAZ;;AACA,MAAIrB,IAAI,GAAG,EAAX;;AAEA,OAAK,IAAI5B,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAG0E,SAAS,CAAC7E,MAAlC,EAA0CG,GAAG,EAA7C,EAAiD;AAC7C4B,IAAAA,IAAI,CAAC3B,IAAL,CAAU0E,KAAV,CAAgB/C,IAAhB,EAAsBM,MAAM,CAACsB,QAAP,CAAgBkB,SAAS,CAAC1E,GAAD,CAAzB,EAAgCyD,KAAhC,EAAuCT,KAAvC,CAAtB;AACH;;AAED,SAAOpB,IAAP;AACH,CAXD;;AAaAvB,aAAa,CAACmB,SAAd,CAAwBK,cAAxB,GAAyC,SAASA,cAAT,GAA2B;AAC5D,MAAIK,MAAM,GAAG,IAAb;;AAEJ,MAAIc,KAAK,GAAG,KAAKC,MAAL,EAAZ;;AACA,MAAIxD,IAAI,GAAG,KAAKA,IAAhB;AACA,MAAImF,SAAS,GAAG,KAAKzD,SAAL,CAAeyD,SAA/B;AACA,MAAIC,MAAM,GAAG,KAAK1D,SAAL,CAAe0D,MAAf,IAAyB3E,aAAtC;;AACA,MAAI4E,SAAS,GAAG,KAAKC,kBAAL,EAAhB;;AACA,MAAInD,IAAI,GAAG,EAAX;AACA,MAAIoD,OAAO,GAAG,EAAd;AACA,MAAIC,aAAa,GAAG,CAApB;AACA,MAAIC,cAAJ;;AAEA,MAAI,CAACJ,SAAL,EAAgB;AACZ,SAAKvD,WAAL,GAAmB,KAAnB;AACH;;AAED,OAAK,IAAIvB,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGP,IAAI,CAACI,MAA7B,EAAqCG,GAAG,EAAxC,EAA4C;AACxC,QAAIG,IAAI,GAAGV,IAAI,CAACO,GAAD,CAAf;AACA,QAAIyD,KAAK,GAAGmB,SAAS,CAACzE,IAAD,EAAOH,GAAP,CAArB;;AAEA,QAAI8E,SAAJ,EAAe;AACX,UAAIrB,KAAK,GAAGwB,aAAZ,EAA2B;AACvBD,QAAAA,OAAO,CAAC/E,IAAR,CAAa;AAAEG,UAAAA,EAAE,EAAE8E,cAAN;AAAsBzB,UAAAA,KAAK,EAAEwB;AAA7B,SAAb;AACH,OAFD,MAEO,IAAIxB,KAAK,GAAGwB,aAAZ,EAA2B;AAC9BrD,QAAAA,IAAI,CAAC3B,IAAL,CAAU0E,KAAV,CAAgB/C,IAAhB,EAAsBM,MAAM,CAACiD,oBAAP,CAA4BH,OAA5B,EAAqCvB,KAArC,EAA4CT,KAA5C,CAAtB;AACH;;AAEDiC,MAAAA,aAAa,GAAGxB,KAAhB;AACAyB,MAAAA,cAAc,GAAGL,MAAM,CAAC1E,IAAD,EAAOH,GAAP,CAAvB;AACH;;AAED4B,IAAAA,IAAI,CAAC3B,IAAL,CAAU0E,KAAV,CAAgB/C,IAAhB,EAAsBM,MAAM,CAACsB,QAAP,CAAgBrD,IAAhB,EAAsBsD,KAAK,GAAG,CAA9B,EAAiCT,KAAjC,CAAtB;AACH;;AAED,MAAI8B,SAAJ,EAAe;AACXlD,IAAAA,IAAI,CAAC3B,IAAL,CAAU0E,KAAV,CAAgB/C,IAAhB,EAAsB,KAAKuD,oBAAL,CAA0BH,OAA1B,EAAmC,CAAnC,EAAsChC,KAAtC,CAAtB;AAEA,QAAIoC,aAAa,GAAG3F,IAAI,CAACI,MAAL,GAAc,KAAKkB,UAAL,CAAgBtB,IAAI,CAAC,CAAD,CAAJ,CAAQ4F,QAAxB,CAAd,GAAkD,EAAtE;AACAzD,IAAAA,IAAI,CAAC3B,IAAL,CAAU,KAAKqF,gBAAL,CAAsBF,aAAtB,EAAqC,CAArC,EAAwCpC,KAAxC,CAAV;AACH;;AAED,OAAKuC,kBAAL,CAAwB3D,IAAxB;;AAEA,SAAOA,IAAP;AACH,CA7CD;;AA+CAvB,aAAa,CAACmB,SAAd,CAAwB2D,oBAAxB,GAA+C,SAASA,oBAAT,CAA+BH,OAA/B,EAAwCQ,YAAxC,EAAsDxC,KAAtD,EAA6D;AACpG,MAAId,MAAM,GAAG,IAAb;AAEJ,MAAIN,IAAI,GAAG,EAAX;;AACA,SAAOoD,OAAO,CAACnF,MAAR,IAAkBmF,OAAO,CAACA,OAAO,CAACnF,MAAR,GAAiB,CAAlB,CAAP,CAA4B4D,KAA5B,IAAqC+B,YAA9D,EAA4E;AACxE,QAAIC,MAAM,GAAGT,OAAO,CAACU,GAAR,EAAb;AACA9D,IAAAA,IAAI,CAAC3B,IAAL,CAAUiC,MAAM,CAACoD,gBAAP,CAAwBpD,MAAM,CAACnB,UAAP,CAAkB0E,MAAM,CAACrF,EAAzB,CAAxB,EAAsDqF,MAAM,CAAChC,KAAP,GAAe,CAArE,EAAwET,KAAxE,CAAV;AACH;;AAED,SAAOpB,IAAP;AACH,CAVD;;AAYAvB,aAAa,CAACmB,SAAd,CAAwBuD,kBAAxB,GAA6C,SAASA,kBAAT,GAA+B;AACxE,MAAIxE,OAAO,GAAG,KAAKA,OAAnB;;AACA,OAAK,IAAIP,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGO,OAAO,CAACV,MAAhC,EAAwCG,GAAG,EAA3C,EAA+C;AAC3C,QAAIO,OAAO,CAACP,GAAD,CAAP,CAAa8C,cAAjB,EAAiC;AAC7B,aAAO,IAAP;AACH;AACJ;AACJ,CAPD;;AASAzC,aAAa,CAACmB,SAAd,CAAwB8D,gBAAxB,GAA2C,SAASA,gBAAT,CAA2BvE,UAA3B,EAAuC0C,KAAvC,EAA8CT,KAA9C,EAAqD;AAC5F,MAAIU,KAAK,GAAG,KAAKnD,OAAL,CAAahB,GAAb,CAAiB,UAASsB,MAAT,EAAiB2D,KAAjB,EAAwB;AACjD,QAAIJ,OAAO,GAAGI,KAAK,GAAG,CAAH,GAAOxB,KAAK,GAAGS,KAAR,GAAgB,CAA1C;;AACA,QAAI5C,MAAM,CAACiC,cAAX,EAA2B;AACvB,UAAI6C,eAAe,GAAG,CAAC5E,UAAU,IAAI,EAAf,EAAmBF,MAAM,CAACuB,KAA1B,CAAtB;AACA,aAAOK,MAAM,CAACC,MAAP,CAAc;AACjBW,QAAAA,UAAU,EAAE,SADK;AAEjBC,QAAAA,KAAK,EAAE,MAFU;AAGjBc,QAAAA,OAAO,EAAEA,OAHQ;AAIjBzE,QAAAA,KAAK,EAAEkB,MAAM,CAACiC,cAAP,CAAsBL,MAAM,CAACC,MAAP,CAAc;AAAE3B,UAAAA,UAAU,EAAEA;AAAd,SAAd,EAA0C4E,eAA1C,CAAtB;AAJU,OAAd,EAKJ9E,MAAM,CAAC+E,iBALH,CAAP;AAMH;;AAED,WAAOnD,MAAM,CAACC,MAAP,CAAc;AACjBW,MAAAA,UAAU,EAAE,SADK;AAEjBC,MAAAA,KAAK,EAAE,MAFU;AAGjBc,MAAAA,OAAO,EAAEA;AAHQ,KAAd,EAIJvD,MAAM,CAAC+E,iBAJH,CAAP;AAKH,GAjBW,CAAZ;AAmBA,SAAO;AACH7B,IAAAA,IAAI,EAAE,QADH;AAEHL,IAAAA,KAAK,EAAE,KAAKN,mBAAL,CAAyBK,KAAzB,EAAgCxC,MAAhC,CAAuCyC,KAAvC,CAFJ;AAGHD,IAAAA,KAAK,EAAE,KAAKlC,WAAL,GAAmBkC,KAAnB,GAA2B;AAH/B,GAAP;AAKH,CAzBD;;AA2BApD,aAAa,CAACmB,SAAd,CAAwBwC,OAAxB,GAAkC,SAASA,OAAT,CAAkB3B,QAAlB,EAA4BoB,KAA5B,EAAmC;AACjE,MAAI7B,IAAI,GAAG,EAAX;AACA,MAAIiE,MAAM,GAAG,KAAKtF,OAAL,CAAac,IAAb,CAAkB,UAAUR,MAAV,EAAkB;AAAE,WAAOA,MAAM,CAACgC,mBAAd;AAAoC,GAA1E,CAAb;AAEA,MAAIiD,YAAJ,EAAkBxB,KAAlB;;AACA,MAAIuB,MAAJ,EAAY;AACRvB,IAAAA,KAAK,GAAG;AACJA,MAAAA,KAAK,EAAE;AAAEX,QAAAA,KAAK,EAAEtB,QAAQ,CAACsB,KAAlB;AACEvB,QAAAA,KAAK,EAAEC,QAAQ,CAACD,KADlB;AAEEzC,QAAAA,KAAK,EAAE0C,QAAQ,CAAC1C;AAFlB;AADH,KAAR;AAKAmG,IAAAA,YAAY,GAAG,EAAf;AACArD,IAAAA,MAAM,CAACsD,IAAP,CAAY1D,QAAQ,CAACtB,UAArB,EAAiCwB,OAAjC,CAAyC,UAAUyD,GAAV,EAAe;AACpDF,MAAAA,YAAY,CAACE,GAAD,CAAZ,GAAoBvD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBL,QAAQ,CAACtB,UAAT,CAAoBiF,GAApB,CAAlB,EAA4C1B,KAA5C,CAApB;AACH,KAFD;AAGH;;AAED,MAAIZ,KAAK,GAAG,KAAKnD,OAAL,CAAahB,GAAb,CAAiB,UAAUsB,MAAV,EAAkB;AAC3C,QAAIA,MAAM,CAACgC,mBAAX,EAAgC;AAC5B,UAAIpD,IAAI,GAAGgD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBoD,YAAlB,EAAgCzD,QAAQ,CAACtB,UAAT,CAAoBF,MAAM,CAACuB,KAA3B,CAAhC,EAAmEkC,KAAnE,CAAX;AACA,aAAO7B,MAAM,CAACC,MAAP,CAAc;AACjBW,QAAAA,UAAU,EAAE,SADK;AAEjBC,QAAAA,KAAK,EAAE,MAFU;AAGjB3D,QAAAA,KAAK,EAAEkB,MAAM,CAACgC,mBAAP,CAA2BpD,IAA3B;AAHU,OAAd,EAIJoB,MAAM,CAACoF,sBAJH,CAAP;AAKH;;AAED,WAAOxD,MAAM,CAACC,MAAP,CAAc;AACjBW,MAAAA,UAAU,EAAE,SADK;AAEjBC,MAAAA,KAAK,EAAE;AAFU,KAAd,EAGJzC,MAAM,CAACoF,sBAHH,CAAP;AAIH,GAdW,CAAZ;;AAgBA,MAAIJ,MAAJ,EAAY;AACRjE,IAAAA,IAAI,CAAC3B,IAAL,CAAU;AACN8D,MAAAA,IAAI,EAAE,cADA;AAENL,MAAAA,KAAK,EAAE,KAAKN,mBAAL,CAAyB,KAAKpC,MAAL,CAAYnB,MAArC,EAA6CoB,MAA7C,CAAoDyC,KAApD,CAFD;AAGND,MAAAA,KAAK,EAAE,KAAKlC,WAAL,GAAmBkC,KAAnB,GAA2B;AAH5B,KAAV;AAKH;;AAED,SAAO7B,IAAP;AACH,CA1CD;;AA4CAvB,aAAa,CAACmB,SAAd,CAAwB0E,gBAAxB,GAA2C,SAASA,gBAAT,CAA2BrF,MAA3B,EAAmC;AAC1E,SAAO,KAAKsF,eAAL,CAAqB,CAAEtF,MAAF,CAArB,EAAiChB,MAAjC,GAA0C,CAA1C,KAAgDgB,MAAM,CAACuB,KAAP,IAAgBvB,MAAM,CAACN,OAAvE,CAAP;AACH,CAFD;;AAIAF,aAAa,CAACmB,SAAd,CAAwB2E,eAAxB,GAA0C,SAASA,eAAT,CAA0B5F,OAA1B,EAAmC;AACrE,MAAI2B,MAAM,GAAG,IAAb;AAEJ,SAAO3B,OAAO,CAACK,MAAR,CAAe,UAAUC,MAAV,EAAkB;AACpC,QAAId,MAAM,GAAG,CAACc,MAAM,CAACC,MAArB;;AACA,QAAIf,MAAM,IAAIc,MAAM,CAACN,OAArB,EAA8B;AAC1BR,MAAAA,MAAM,GAAGmC,MAAM,CAACiE,eAAP,CAAuBtF,MAAM,CAACN,OAA9B,EAAuCV,MAAvC,GAAgD,CAAzD;AACH;;AACD,WAAOE,MAAP;AACH,GANM,CAAP;AAOH,CAVD;;AAYAM,aAAa,CAACmB,SAAd,CAAwB4E,UAAxB,GAAqC,SAASA,UAAT,CAAqBC,GAArB,EAA0BrF,MAA1B,EAAkC;AAC/D,MAAIkB,MAAM,GAAG,IAAb;AAEJ,MAAIoE,OAAO,GAAGD,GAAG,CAAC3C,KAAJ,CAAUnE,GAAV,CAAc,UAASgH,IAAT,EAAe;AACvC,WAAO9D,MAAM,CAACC,MAAP,CAAc6D,IAAd,EAAoB;AACvBnC,MAAAA,OAAO,EAAEmC,IAAI,CAACnC,OAAL,GAAe,CAAf,GAAmBmC,IAAI,CAACnC,OAAxB,GAAkC,CADpB;AAEvBoC,MAAAA,OAAO,EAAEH,GAAG,CAACG,OAAJ,GAAc,CAAd,IAAmB,CAACD,IAAI,CAACnC,OAAzB,GAAmCiC,GAAG,CAACG,OAAvC,GAAiD;AAFnC,KAApB,CAAP;AAIH,GALa,CAAd;;AAOA,MAAI,KAAKrF,SAAL,IAAkBmF,OAAO,CAAC,CAAD,CAAP,CAAWG,SAAjC,EAA4C;AACxCH,IAAAA,OAAO,CAAC,CAAD,CAAP,CAAWlC,OAAX,IAAsB,KAAKnB,MAAL,EAAtB;AACH;;AAED,SAAO;AACHc,IAAAA,IAAI,EAAE,QADH;AAEHL,IAAAA,KAAK,EAAE9D,WAAW,CAACoB,MAAM,CAACnB,MAAR,EAAgB,YAAY;AAAE,aAAO4C,MAAM,CAACC,MAAP,CAAc;AACjEW,QAAAA,UAAU,EAAE,SADqD;AAEjEC,QAAAA,KAAK,EAAE;AAF0D,OAAd,EAGpDpB,MAAM,CAAC5B,OAAP,CAAeoG,wBAHqC,CAAP;AAGF,KAH5B,CAAX,CAGyCzF,MAHzC,CAGgDqF,OAHhD;AAFJ,GAAP;AAOH,CArBD;;AAuBAjG,aAAa,CAACmB,SAAd,CAAwB+D,kBAAxB,GAA6C,SAASA,kBAAT,CAA6B3D,IAA7B,EAAmC;AACxE,MAAIM,MAAM,GAAG,IAAb;AAEJ,MAAIlB,MAAM,GAAG,KAAKA,MAAlB;AAEA,MAAI2F,UAAU,GAAG,CAAE;AAAEH,IAAAA,OAAO,EAAE,CAAX;AAAc9C,IAAAA,KAAK,EAAE,EAArB;AAAyBc,IAAAA,KAAK,EAAE;AAAhC,GAAF,CAAjB;;AAEA,OAAKoC,kBAAL,CAAwBD,UAAxB,EAAoC,KAAKrG,OAAL,CAAaC,OAAjD;;AAEA,OAAK,IAAIP,GAAG,GAAG2G,UAAU,CAAC9G,MAAX,GAAoB,CAAnC,EAAsCG,GAAG,IAAI,CAA7C,EAAgDA,GAAG,EAAnD,EAAuD;AACnD4B,IAAAA,IAAI,CAACkC,OAAL,CAAa5B,MAAM,CAACkE,UAAP,CAAkBO,UAAU,CAAC3G,GAAD,CAA5B,EAAmCgB,MAAnC,CAAb;AACH;AACJ,CAZD;;AAcAX,aAAa,CAACmB,SAAd,CAAwBoF,kBAAxB,GAA6C,SAASA,kBAAT,CAA6BhF,IAA7B,EAAmCrB,OAAnC,EAA4CsG,UAA5C,EAAwDC,SAAxD,EAAmE;AACxG,MAAI5E,MAAM,GAAG,IAAb;AAEJ,MAAImE,GAAG,GAAGS,SAAS,IAAIlF,IAAI,CAACA,IAAI,CAAC/B,MAAL,GAAc,CAAf,CAA3B;AACA,MAAIkH,QAAQ,GAAGnF,IAAI,CAACyE,GAAG,CAAC7B,KAAJ,GAAY,CAAb,CAAnB;AACA,MAAIwC,YAAY,GAAG,CAAnB;;AAEA,OAAK,IAAIhH,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGO,OAAO,CAACV,MAAhC,EAAwCG,GAAG,EAA3C,EAA+C;AAC3C,QAAIa,MAAM,GAAGN,OAAO,CAACP,GAAD,CAApB;;AACA,QAAIkC,MAAM,CAACgE,gBAAP,CAAwBrF,MAAxB,CAAJ,EAAqC;AAEjC,UAAI0F,IAAI,GAAG9D,MAAM,CAACC,MAAP,CAAc;AACrBW,QAAAA,UAAU,EAAE,SADS;AAErBC,QAAAA,KAAK,EAAE,MAFc;AAGrB3D,QAAAA,KAAK,EAAEkB,MAAM,CAACnB,KAAP,IAAgBmB,MAAM,CAACuB,KAHT;AAIrBgC,QAAAA,OAAO,EAAE,CAJY;AAKrBqC,QAAAA,SAAS,EAAEzG,GAAG,KAAK,CAAR,KAAc,CAAC6G,UAAD,IAAeA,UAAU,CAACJ,SAAxC;AALU,OAAd,EAMR5F,MAAM,CAACoG,iBANC,CAAX;AAOAZ,MAAAA,GAAG,CAAC3C,KAAJ,CAAUzD,IAAV,CAAesG,IAAf;;AAEA,UAAI1F,MAAM,CAACN,OAAP,IAAkBM,MAAM,CAACN,OAAP,CAAeV,MAArC,EAA6C;AACzC,YAAI,CAACkH,QAAL,EAAe;AACXA,UAAAA,QAAQ,GAAG;AAAEP,YAAAA,OAAO,EAAE,CAAX;AAAc9C,YAAAA,KAAK,EAAE,EAArB;AAAyBc,YAAAA,KAAK,EAAE5C,IAAI,CAAC/B;AAArC,WAAX;AACA+B,UAAAA,IAAI,CAAC3B,IAAL,CAAU8G,QAAV;AACH;;AACDR,QAAAA,IAAI,CAACnC,OAAL,GAAelC,MAAM,CAAC1B,YAAP,CAAoB0B,MAAM,CAACiE,eAAP,CAAuBtF,MAAM,CAACN,OAA9B,CAApB,EAA4DV,MAA3E;;AACAqC,QAAAA,MAAM,CAAC0E,kBAAP,CAA0BhF,IAA1B,EAAgCf,MAAM,CAACN,OAAvC,EAAgDgG,IAAhD,EAAsDQ,QAAtD;;AACAC,QAAAA,YAAY,IAAIT,IAAI,CAACnC,OAAL,GAAe,CAA/B;AACAiC,QAAAA,GAAG,CAACG,OAAJ,GAAc5E,IAAI,CAAC/B,MAAL,GAAcwG,GAAG,CAAC7B,KAAhC;AACH;AACJ;AACJ;;AAED,MAAIqC,UAAJ,EAAgB;AACZA,IAAAA,UAAU,CAACzC,OAAX,IAAsB4C,YAAtB;AACH;AACJ,CApCD;;AAsCA3G,aAAa,CAACmB,SAAd,CAAwBM,KAAxB,GAAgC,SAASA,KAAT,GAAkB;AAC1C,MAAII,MAAM,GAAG,IAAb;;AAEJ,MAAIN,IAAI,GAAG,KAAKiC,SAAL,CAAe,KAAKpE,IAApB,EAA0B,CAA1B,CAAX;;AAEA,MAAI,KAAKc,OAAL,CAAaV,MAAjB,EAAyB;AACrB,SAAK0F,kBAAL,CAAwB3D,IAAxB;;AACA,QAAIiE,MAAM,GAAG,KAAb;AAEA,QAAInC,KAAK,GAAG,KAAKnD,OAAL,CAAahB,GAAb,CAAiB,UAAUsB,MAAV,EAAkB;AAC3C,UAAIA,MAAM,CAACiC,cAAX,EAA2B;AACvB+C,QAAAA,MAAM,GAAG,IAAT;AAEA,eAAOpD,MAAM,CAACC,MAAP,CAAc;AACjBW,UAAAA,UAAU,EAAE,SADK;AAEjBC,UAAAA,KAAK,EAAE,MAFU;AAGjB3D,UAAAA,KAAK,EAAEkB,MAAM,CAACiC,cAAP,CAAsBL,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBR,MAAM,CAACnB,UAAzB,EAAqCmB,MAAM,CAACnB,UAAP,CAAkBF,MAAM,CAACuB,KAAzB,CAArC,CAAtB;AAHU,SAAd,EAIJvB,MAAM,CAAC+E,iBAJH,CAAP;AAKH;;AAED,aAAOnD,MAAM,CAACC,MAAP,CAAc;AACjBW,QAAAA,UAAU,EAAE,SADK;AAEjBC,QAAAA,KAAK,EAAE;AAFU,OAAd,EAGJzC,MAAM,CAAC+E,iBAHH,CAAP;AAIH,KAfW,CAAZ;;AAiBA,QAAIC,MAAJ,EAAY;AACRjE,MAAAA,IAAI,CAAC3B,IAAL,CAAU;AACN8D,QAAAA,IAAI,EAAE,QADA;AAENL,QAAAA,KAAK,EAAE,KAAKN,mBAAL,CAAyB,KAAKpC,MAAL,CAAYnB,MAArC,EAA6CoB,MAA7C,CAAoDyC,KAApD;AAFD,OAAV;AAIH;AACJ;;AAED,SAAO9B,IAAP;AACH,CAnCD;;AAqCAvB,aAAa,CAACmB,SAAd,CAAwB0F,YAAxB,GAAuC,SAASA,YAAT,CAAuB3G,OAAvB,EAAgC;AAC/D,MAAI2B,MAAM,GAAG,IAAb;AAEJ,MAAInC,MAAM,GAAG,CAAb;AACA,MAAIoH,GAAG,GAAG,CAAV;;AAEA,OAAK,IAAInH,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGO,OAAO,CAACV,MAAhC,EAAwCG,GAAG,EAA3C,EAA+C;AAC3C,QAAIO,OAAO,CAACP,GAAD,CAAP,CAAaO,OAAjB,EAA0B;AACtB,UAAI6G,IAAI,GAAGlF,MAAM,CAACgF,YAAP,CAAoB3G,OAAO,CAACP,GAAD,CAAP,CAAaO,OAAjC,CAAX;;AACA,UAAI6G,IAAI,GAAGD,GAAX,EAAgB;AACZA,QAAAA,GAAG,GAAGC,IAAN;AACH;AACJ;AACJ;;AACD,SAAOrH,MAAM,GAAGoH,GAAhB;AACH,CAfD;;AAiBA9G,aAAa,CAACmB,SAAd,CAAwBQ,WAAxB,GAAsC,SAASA,WAAT,GAAwB;AAC1D,MAAIzB,OAAO,GAAG,KAAK4F,eAAL,CAAqB,KAAK7F,OAAL,CAAaC,OAAb,IAAwB,EAA7C,CAAd;;AAEA,MAAI8G,QAAQ,GAAG,KAAKlB,eAAL,CAAqB,KAAK3F,YAAL,CAAkB,KAAKE,YAAL,CAAkBH,OAAO,CAACK,MAAR,CAAe,UAASC,MAAT,EAAiB;AACpG,WAAOA,MAAM,CAACyG,MAAd;AACH,GAFuE,CAAlB,CAAlB,CAArB,EAETzH,MAFN;;AAIA,SAAO;AACH0H,IAAAA,QAAQ,EAAE,KAAKL,YAAL,CAAkB3G,OAAlB,CADP;AAEH8G,IAAAA,QAAQ,EAAEA,QAAQ,GAAGA,QAAQ,GAAG,KAAKrG,MAAL,CAAYnB,MAA1B,GAAmC;AAFlD,GAAP;AAIH,CAXD;;AAaAQ,aAAa,CAACmB,SAAd,CAAwB2C,KAAxB,GAAgC,SAASA,KAAT,CAAgB9B,QAAhB,EAA0BxB,MAA1B,EAAkC;AAC9D,SAAO4B,MAAM,CAACC,MAAP,CAAc;AACjB/C,IAAAA,KAAK,EAAEkB,MAAM,CAAClB,KAAP,CAAa0C,QAAb;AADU,GAAd,EAEJxB,MAAM,CAAC2G,WAFH,CAAP;AAGH,CAJD;;AAMAnH,aAAa,CAACmB,SAAd,CAAwByB,MAAxB,GAAiC,SAASA,MAAT,GAAmB;AAChD,MAAID,KAAK,GAAG,CAAZ;;AAEA,MAAI,KAAK7B,SAAT,EAAoB;AAChB6B,IAAAA,KAAK,GAAG,KAAK7B,SAAL,CAAe6B,KAAvB;AACH,GAFD,MAEO;AACHA,IAAAA,KAAK,GAAG,KAAKhC,MAAL,CAAYnB,MAApB;AACH;;AAED,SAAOmD,KAAP;AACH,CAVD;;AAYA3C,aAAa,CAACmB,SAAd,CAAwBG,QAAxB,GAAmC,SAASA,QAAT,GAAqB;AACpD,MAAIqB,KAAK,GAAG,KAAKC,MAAL,EAAZ;;AACA,MAAI1C,OAAO,GAAGX,WAAW,CAACoD,KAAD,EAAQ,YAAY;AAAE,WAAQ;AAAEyE,MAAAA,KAAK,EAAE;AAAT,KAAR;AAAyB,GAA/C,CAAzB;AAEA,SAAOlH,OAAO,CAACU,MAAR,CAAe,KAAKV,OAAL,CAAahB,GAAb,CAAiB,UAASsB,MAAT,EAAiB;AACpD,WAAO;AACH4G,MAAAA,KAAK,EAAEC,QAAQ,CAAC7G,MAAM,CAAC4G,KAAR,EAAe,EAAf,CADZ;AAEHE,MAAAA,SAAS,EAAE9G,MAAM,CAAC4G,KAAP,GAAe,KAAf,GAAuB;AAF/B,KAAP;AAIH,GALqB,CAAf,CAAP;AAMH,CAVD;;AAYA,eAAepH,aAAf","sourcesContent":["import TemplateService from './services/template-service';\nimport getter from './utils/getter';\nimport map from './utils/map';\n\nfunction defaultGroupHeaderTemplate(data) {\n    return ((data.title) + \": \" + (data.value));\n}\n\nfunction createArray(length, callback) {\n    var result = [];\n\n    for (var idx = 0; idx < length; idx++) {\n        result.push(callback(idx));\n    }\n\n    return result;\n}\n\nfunction defaultItemId(item) {\n    return item.id;\n}\n\nvar ExcelExporter = function ExcelExporter(options) {\n    options.columns = this._trimColumns(options.columns || []);\n\n    this.allColumns = map(this._leafColumns(options.columns || []), this._prepareColumn);\n\n    this.columns = this.allColumns.filter(function(column) { return !column.hidden; });\n\n    this.options = options;\n    this.data = options.data || [];\n    this.aggregates = options.aggregates || {};\n    this.groups = [].concat(options.groups || []);\n    this.hasGroups = this.groups.length > 0;\n    this.hierarchy = options.hierarchy;\n    this.hasGroupHeaderColumn = this.columns.some(function (column) { return column.groupHeaderColumnTemplate; });\n    this.collapsible = this.options.collapsible;\n};\n\nExcelExporter.prototype.workbook = function workbook () {\n    var workbook = {\n        sheets: [ {\n            columns: this._columns(),\n            rows: this.hierarchy ? this._hierarchyRows() : this._rows(),\n            freezePane: this._freezePane(),\n            filter: this._filter()\n        } ]\n    };\n\n    return workbook;\n};\n\nExcelExporter.prototype._trimColumns = function _trimColumns (columns) {\n        var this$1 = this;\n\n    return columns.filter(function (column) {\n        var result = Boolean(column.field);\n\n        if (!result && column.columns) {\n            result = this$1._trimColumns(column.columns).length > 0;\n        }\n\n        return result;\n    });\n};\n\nExcelExporter.prototype._leafColumns = function _leafColumns (columns) {\n        var this$1 = this;\n\n    var result = [];\n\n    for (var idx = 0; idx < columns.length; idx++) {\n        if (!columns[idx].columns) {\n            result.push(columns[idx]);\n        } else {\n            result = result.concat(this$1._leafColumns(columns[idx].columns));\n        }\n    }\n\n    return result;\n};\n\nExcelExporter.prototype._prepareColumn = function _prepareColumn (column) {\n    if (!column.field) {\n        return null;\n    }\n\n    var value = function(dataItem) {\n        return getter(column.field, true)(dataItem);\n    };\n\n    var values = null;\n\n    if (column.values) {\n        values = {};\n\n        column.values.forEach(function(item) {\n            values[item.value] = item.text;\n        });\n\n        value = function(dataItem) {\n            return values[getter(column.field, true)(dataItem)];\n        };\n    }\n\n    return Object.assign({}, column, {\n        value: value,\n        values: values,\n        groupHeaderTemplate: column.groupHeaderTemplate ? TemplateService.compile(column.groupHeaderTemplate) : defaultGroupHeaderTemplate,\n        groupHeaderColumnTemplate: column.groupHeaderColumnTemplate ? TemplateService.compile(column.groupHeaderColumnTemplate) : null,\n        groupFooterTemplate: column.groupFooterTemplate ? TemplateService.compile(column.groupFooterTemplate) : null,\n        footerTemplate: column.footerTemplate ? TemplateService.compile(column.footerTemplate) : null\n    });\n};\n\nExcelExporter.prototype._filter = function _filter () {\n    if (!this.options.filterable) {\n        return null;\n    }\n\n    var depth = this._depth();\n\n    return {\n        from: depth,\n        to: depth + this.columns.length - 1\n    };\n};\n\nExcelExporter.prototype._createPaddingCells = function _createPaddingCells (length) {\n        var this$1 = this;\n\n    return createArray(length, function () { return Object.assign({\n        background: \"#dfdfdf\",\n        color: \"#333\"\n    }, this$1.options.paddingCellOptions); });\n};\n\nExcelExporter.prototype._dataRow = function _dataRow (dataItem, level, depth) {\n        var this$1 = this;\n\n    var cells = this._createPaddingCells(level);\n\n    // grouped\n    if (this.hasGroups && depth && dataItem.items) {\n        cells = cells.concat(this._groupHeaderCells(dataItem, level, depth));\n        var rows = this._dataRows(dataItem.items, level + 1);\n\n        rows.unshift({\n            type: \"group-header\",\n            cells: cells,\n            level: this.collapsible ? level : null\n        });\n\n        return rows.concat(this._footer(dataItem, level));\n    }\n\n    var dataCells = [];\n\n    for (var cellIdx = 0; cellIdx < this.columns.length; cellIdx++) {\n        dataCells[cellIdx] = this$1._cell(dataItem, this$1.columns[cellIdx]);\n    }\n\n    if (this.hierarchy) {\n        dataCells[0].colSpan = depth - level + 1;\n    }\n\n    return [ {\n        type: \"data\",\n        cells: cells.concat(dataCells),\n        level: this.collapsible ? level : null\n    } ];\n};\n\nExcelExporter.prototype._groupHeaderCells = function _groupHeaderCells (dataItem, level, depth) {\n    var cells = [];\n\n    var column = this.allColumns.filter(function(column) {\n        return column.field === dataItem.field;\n    })[0] || {};\n\n    var title = column && column.title ? column.title : dataItem.field;\n    var template = column ? column.groupHeaderTemplate || column.groupHeaderColumnTemplate : null;\n    var group = Object.assign({\n        title: title,\n        field: dataItem.field,\n        value: column && column.values ? column.values[dataItem.value] : dataItem.value,\n        aggregates: dataItem.aggregates,\n        items: dataItem.items\n    }, dataItem.aggregates[dataItem.field]);\n\n    var value = template ? template(group) : (title + \": \" + (dataItem.value));\n\n    cells.push(Object.assign({\n        value: value,\n        background: \"#dfdfdf\",\n        color: \"#333\",\n        colSpan: (this.hasGroupHeaderColumn ? 1 : this.columns.length) + depth - level\n    }, column.groupHeaderCellOptions));\n\n    if (this.hasGroupHeaderColumn) {\n        this.columns.forEach(function(column, index) {\n            if (index > 0) {\n                cells.push(Object.assign({\n                    background: \"#dfdfdf\",\n                    color: \"#333\",\n                    value: column.groupHeaderColumnTemplate ?\n                        column.groupHeaderColumnTemplate(Object.assign({ group: group }, group, dataItem.aggregates[column.field])) :\n                        undefined\n                }, column.groupHeaderCellOptions));\n            }\n        });\n    }\n\n    return cells;\n};\n\nExcelExporter.prototype._dataRows = function _dataRows (dataItems, level) {\n        var this$1 = this;\n\n    var depth = this._depth();\n    var rows = [];\n\n    for (var idx = 0; idx < dataItems.length; idx++) {\n        rows.push.apply(rows, this$1._dataRow(dataItems[idx], level, depth));\n    }\n\n    return rows;\n};\n\nExcelExporter.prototype._hierarchyRows = function _hierarchyRows () {\n        var this$1 = this;\n\n    var depth = this._depth();\n    var data = this.data;\n    var itemLevel = this.hierarchy.itemLevel;\n    var itemId = this.hierarchy.itemId || defaultItemId;\n    var hasFooter = this._hasFooterTemplate();\n    var rows = [];\n    var parents = [];\n    var previousLevel = 0;\n    var previousItemId;\n\n    if (!hasFooter) {\n        this.collapsible = false;\n    }\n\n    for (var idx = 0; idx < data.length; idx++) {\n        var item = data[idx];\n        var level = itemLevel(item, idx);\n\n        if (hasFooter) {\n            if (level > previousLevel) {\n                parents.push({ id: previousItemId, level: previousLevel });\n            } else if (level < previousLevel) {\n                rows.push.apply(rows, this$1._hierarchyFooterRows(parents, level, depth));\n            }\n\n            previousLevel = level;\n            previousItemId = itemId(item, idx);\n        }\n\n        rows.push.apply(rows, this$1._dataRow(item, level + 1, depth));\n    }\n\n    if (hasFooter) {\n        rows.push.apply(rows, this._hierarchyFooterRows(parents, 0, depth));\n\n        var rootAggregate = data.length ? this.aggregates[data[0].parentId] : {};\n        rows.push(this._hierarchyFooter(rootAggregate, 0, depth));\n    }\n\n    this._prependHeaderRows(rows);\n\n    return rows;\n};\n\nExcelExporter.prototype._hierarchyFooterRows = function _hierarchyFooterRows (parents, currentLevel, depth) {\n        var this$1 = this;\n\n    var rows = [];\n    while (parents.length && parents[parents.length - 1].level >= currentLevel) {\n        var parent = parents.pop();\n        rows.push(this$1._hierarchyFooter(this$1.aggregates[parent.id], parent.level + 1, depth));\n    }\n\n    return rows;\n};\n\nExcelExporter.prototype._hasFooterTemplate = function _hasFooterTemplate () {\n    var columns = this.columns;\n    for (var idx = 0; idx < columns.length; idx++) {\n        if (columns[idx].footerTemplate) {\n            return true;\n        }\n    }\n};\n\nExcelExporter.prototype._hierarchyFooter = function _hierarchyFooter (aggregates, level, depth) {\n    var cells = this.columns.map(function(column, index) {\n        var colSpan = index ? 1 : depth - level + 1;\n        if (column.footerTemplate) {\n            var fieldAggregates = (aggregates || {})[column.field];\n            return Object.assign({\n                background: \"#dfdfdf\",\n                color: \"#333\",\n                colSpan: colSpan,\n                value: column.footerTemplate(Object.assign({ aggregates: aggregates }, fieldAggregates))\n            }, column.footerCellOptions);\n        }\n\n        return Object.assign({\n            background: \"#dfdfdf\",\n            color: \"#333\",\n            colSpan: colSpan\n        }, column.footerCellOptions);\n    });\n\n    return {\n        type: \"footer\",\n        cells: this._createPaddingCells(level).concat(cells),\n        level: this.collapsible ? level : null\n    };\n};\n\nExcelExporter.prototype._footer = function _footer (dataItem, level) {\n    var rows = [];\n    var footer = this.columns.some(function (column) { return column.groupFooterTemplate; });\n\n    var templateData, group;\n    if (footer) {\n        group = {\n            group: { items: dataItem.items,\n                     field: dataItem.field,\n                     value: dataItem.value }\n        };\n        templateData = {};\n        Object.keys(dataItem.aggregates).forEach(function (key) {\n            templateData[key] = Object.assign({}, dataItem.aggregates[key], group);\n        });\n    }\n\n    var cells = this.columns.map(function (column) {\n        if (column.groupFooterTemplate) {\n            var data = Object.assign({}, templateData, dataItem.aggregates[column.field], group);\n            return Object.assign({\n                background: \"#dfdfdf\",\n                color: \"#333\",\n                value: column.groupFooterTemplate(data)\n            }, column.groupFooterCellOptions);\n        }\n\n        return Object.assign({\n            background: \"#dfdfdf\",\n            color: \"#333\"\n        }, column.groupFooterCellOptions);\n    });\n\n    if (footer) {\n        rows.push({\n            type: \"group-footer\",\n            cells: this._createPaddingCells(this.groups.length).concat(cells),\n            level: this.collapsible ? level : null\n        });\n    }\n\n    return rows;\n};\n\nExcelExporter.prototype._isColumnVisible = function _isColumnVisible (column) {\n    return this._visibleColumns([ column ]).length > 0 && (column.field || column.columns);\n};\n\nExcelExporter.prototype._visibleColumns = function _visibleColumns (columns) {\n        var this$1 = this;\n\n    return columns.filter(function (column) {\n        var result = !column.hidden;\n        if (result && column.columns) {\n            result = this$1._visibleColumns(column.columns).length > 0;\n        }\n        return result;\n    });\n};\n\nExcelExporter.prototype._headerRow = function _headerRow (row, groups) {\n        var this$1 = this;\n\n    var headers = row.cells.map(function(cell) {\n        return Object.assign(cell, {\n            colSpan: cell.colSpan > 1 ? cell.colSpan : 1,\n            rowSpan: row.rowSpan > 1 && !cell.colSpan ? row.rowSpan : 1\n        });\n    });\n\n    if (this.hierarchy && headers[0].firstCell) {\n        headers[0].colSpan += this._depth();\n    }\n\n    return {\n        type: \"header\",\n        cells: createArray(groups.length, function () { return Object.assign({\n            background: \"#7a7a7a\",\n            color: \"#fff\"\n        }, this$1.options.headerPaddingCellOptions); }).concat(headers)\n    };\n};\n\nExcelExporter.prototype._prependHeaderRows = function _prependHeaderRows (rows) {\n        var this$1 = this;\n\n    var groups = this.groups;\n\n    var headerRows = [ { rowSpan: 1, cells: [], index: 0 } ];\n\n    this._prepareHeaderRows(headerRows, this.options.columns);\n\n    for (var idx = headerRows.length - 1; idx >= 0; idx--) {\n        rows.unshift(this$1._headerRow(headerRows[idx], groups));\n    }\n};\n\nExcelExporter.prototype._prepareHeaderRows = function _prepareHeaderRows (rows, columns, parentCell, parentRow) {\n        var this$1 = this;\n\n    var row = parentRow || rows[rows.length - 1];\n    var childRow = rows[row.index + 1];\n    var totalColSpan = 0;\n\n    for (var idx = 0; idx < columns.length; idx++) {\n        var column = columns[idx];\n        if (this$1._isColumnVisible(column)) {\n\n            var cell = Object.assign({\n                background: \"#7a7a7a\",\n                color: \"#fff\",\n                value: column.title || column.field,\n                colSpan: 0,\n                firstCell: idx === 0 && (!parentCell || parentCell.firstCell)\n            }, column.headerCellOptions);\n            row.cells.push(cell);\n\n            if (column.columns && column.columns.length) {\n                if (!childRow) {\n                    childRow = { rowSpan: 0, cells: [], index: rows.length };\n                    rows.push(childRow);\n                }\n                cell.colSpan = this$1._trimColumns(this$1._visibleColumns(column.columns)).length;\n                this$1._prepareHeaderRows(rows, column.columns, cell, childRow);\n                totalColSpan += cell.colSpan - 1;\n                row.rowSpan = rows.length - row.index;\n            }\n        }\n    }\n\n    if (parentCell) {\n        parentCell.colSpan += totalColSpan;\n    }\n};\n\nExcelExporter.prototype._rows = function _rows () {\n        var this$1 = this;\n\n    var rows = this._dataRows(this.data, 0);\n\n    if (this.columns.length) {\n        this._prependHeaderRows(rows);\n        var footer = false;\n\n        var cells = this.columns.map(function (column) {\n            if (column.footerTemplate) {\n                footer = true;\n\n                return Object.assign({\n                    background: \"#dfdfdf\",\n                    color: \"#333\",\n                    value: column.footerTemplate(Object.assign({}, this$1.aggregates, this$1.aggregates[column.field]))\n                }, column.footerCellOptions);\n            }\n\n            return Object.assign({\n                background: \"#dfdfdf\",\n                color: \"#333\"\n            }, column.footerCellOptions);\n        });\n\n        if (footer) {\n            rows.push({\n                type: \"footer\",\n                cells: this._createPaddingCells(this.groups.length).concat(cells)\n            });\n        }\n    }\n\n    return rows;\n};\n\nExcelExporter.prototype._headerDepth = function _headerDepth (columns) {\n        var this$1 = this;\n\n    var result = 1;\n    var max = 0;\n\n    for (var idx = 0; idx < columns.length; idx++) {\n        if (columns[idx].columns) {\n            var temp = this$1._headerDepth(columns[idx].columns);\n            if (temp > max) {\n                max = temp;\n            }\n        }\n    }\n    return result + max;\n};\n\nExcelExporter.prototype._freezePane = function _freezePane () {\n    var columns = this._visibleColumns(this.options.columns || []);\n\n    var colSplit = this._visibleColumns(this._trimColumns(this._leafColumns(columns.filter(function(column) {\n        return column.locked;\n    })))).length;\n\n    return {\n        rowSplit: this._headerDepth(columns),\n        colSplit: colSplit ? colSplit + this.groups.length : 0\n    };\n};\n\nExcelExporter.prototype._cell = function _cell (dataItem, column) {\n    return Object.assign({\n        value: column.value(dataItem)\n    }, column.cellOptions);\n};\n\nExcelExporter.prototype._depth = function _depth () {\n    var depth = 0;\n\n    if (this.hierarchy) {\n        depth = this.hierarchy.depth;\n    } else {\n        depth = this.groups.length;\n    }\n\n    return depth;\n};\n\nExcelExporter.prototype._columns = function _columns () {\n    var depth = this._depth();\n    var columns = createArray(depth, function () { return ({ width: 20 }); });\n\n    return columns.concat(this.columns.map(function(column) {\n        return {\n            width: parseInt(column.width, 10),\n            autoWidth: column.width ? false : true\n        };\n    }));\n};\n\nexport default ExcelExporter;\n"]},"metadata":{},"sourceType":"module"}