{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nimport React from \"react\";\nimport { Utils } from \"@react-awesome-query-builder/core\";\nimport debounce from \"lodash/debounce\";\nvar _Utils$Autocomplete = Utils.Autocomplete,\n    mergeListValues = _Utils$Autocomplete.mergeListValues,\n    listValueToOption = _Utils$Autocomplete.listValueToOption,\n    getListValue = _Utils$Autocomplete.getListValue;\nvar _Utils$ListUtils = Utils.ListUtils,\n    mapListValues = _Utils$ListUtils.mapListValues,\n    listValuesToArray = _Utils$ListUtils.listValuesToArray;\n\nvar useListValuesAutocomplete = function useListValuesAutocomplete(_ref, _ref2) {\n  var asyncFetch = _ref.asyncFetch,\n      useLoadMore = _ref.useLoadMore,\n      useAsyncSearch = _ref.useAsyncSearch,\n      forceAsyncSearch = _ref.forceAsyncSearch,\n      selectedAsyncListValues = _ref.asyncListValues,\n      staticListValues = _ref.listValues,\n      allowCustomValues = _ref.allowCustomValues,\n      selectedValue = _ref.value,\n      setValue = _ref.setValue,\n      placeholder = _ref.placeholder;\n  var debounceTimeout = _ref2.debounceTimeout,\n      multiple = _ref2.multiple;\n  var knownSpecialValues = [\"LOAD_MORE\", \"LOADING_MORE\"];\n  var loadMoreTitle = \"Load more...\";\n  var loadingMoreTitle = \"Loading more...\";\n  var aPlaceholder = forceAsyncSearch ? \"Type to search\" : placeholder; // state\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      open = _React$useState2[0],\n      setOpen = _React$useState2[1];\n\n  var _React$useState3 = React.useState(undefined),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      asyncFetchMeta = _React$useState4[0],\n      setAsyncFetchMeta = _React$useState4[1];\n\n  var _React$useState5 = React.useState(0),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      loadingCnt = _React$useState6[0],\n      setLoadingCnt = _React$useState6[1];\n\n  var _React$useState7 = React.useState(false),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      isLoadingMore = _React$useState8[0],\n      setIsLoadingMore = _React$useState8[1];\n\n  var _React$useState9 = React.useState(\"\"),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      inputValue = _React$useState10[0],\n      setInputValue = _React$useState10[1];\n\n  var _React$useState11 = React.useState(undefined),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      asyncListValues = _React$useState12[0],\n      setAsyncListValues = _React$useState12[1]; // ref\n\n\n  var asyncFectchCnt = React.useRef(0);\n  var componentIsMounted = React.useRef(true);\n  var isSelectedLoadMore = React.useRef(false); // compute\n\n  var nSelectedAsyncListValues = listValuesToArray(selectedAsyncListValues);\n  var listValues = asyncFetch ? !allowCustomValues ? mergeListValues(asyncListValues, nSelectedAsyncListValues, true) : asyncListValues : staticListValues; //const isDirtyInitialListValues = asyncListValues == undefined && selectedAsyncListValues && selectedAsyncListValues.length && typeof selectedAsyncListValues[0] != \"object\";\n\n  var isLoading = loadingCnt > 0;\n  var canInitialLoad = open && asyncFetch && asyncListValues === undefined && (forceAsyncSearch ? inputValue : true);\n  var isInitialLoading = canInitialLoad && isLoading;\n  var canLoadMore = !isInitialLoading && listValues && listValues.length > 0 && asyncFetchMeta && asyncFetchMeta.hasMore && (asyncFetchMeta.filter || \"\") === inputValue;\n  var canShowLoadMore = !isLoading && canLoadMore;\n  var options = mapListValues(listValues, listValueToOption);\n  var hasValue = selectedValue != null; // const selectedListValue = hasValue ? getListValue(selectedValue, listValues) : null;\n  // const selectedOption = listValueToOption(selectedListValue);\n  // fetch\n\n  var fetchListValues = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var filter,\n          isLoadMore,\n          offset,\n          meta,\n          newAsyncFetchCnt,\n          res,\n          isFetchCancelled,\n          _ref4,\n          values,\n          hasMore,\n          newMeta,\n          nValues,\n          assumeHasMore,\n          newValues,\n          realNewMeta,\n          _args = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            filter = _args.length > 0 && _args[0] !== undefined ? _args[0] : null;\n            isLoadMore = _args.length > 1 && _args[1] !== undefined ? _args[1] : false; // clear obsolete meta\n\n            if (!isLoadMore && asyncFetchMeta) {\n              setAsyncFetchMeta(undefined);\n            }\n\n            offset = isLoadMore && asyncListValues ? asyncListValues.length : 0;\n            meta = isLoadMore && asyncFetchMeta || !useLoadMore && {\n              pageSize: 0\n            };\n            newAsyncFetchCnt = ++asyncFectchCnt.current;\n            _context.next = 8;\n            return asyncFetch(filter, offset, meta);\n\n          case 8:\n            res = _context.sent;\n            isFetchCancelled = asyncFectchCnt.current != newAsyncFetchCnt;\n\n            if (!(isFetchCancelled || !componentIsMounted.current)) {\n              _context.next = 12;\n              break;\n            }\n\n            return _context.abrupt(\"return\", null);\n\n          case 12:\n            _ref4 = res && res.values ? res : {\n              values: res\n            }, values = _ref4.values, hasMore = _ref4.hasMore, newMeta = _ref4.meta;\n            nValues = listValuesToArray(values);\n\n            if (isLoadMore) {\n              newValues = mergeListValues(asyncListValues, nValues, false);\n              assumeHasMore = newValues.length > asyncListValues.length;\n            } else {\n              newValues = nValues;\n\n              if (useLoadMore) {\n                assumeHasMore = newValues.length > 0;\n              }\n            } // save new meta\n\n\n            realNewMeta = hasMore != null || newMeta != null || assumeHasMore != null ? _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, assumeHasMore != null ? {\n              hasMore: assumeHasMore\n            } : {}), hasMore != null ? {\n              hasMore: hasMore\n            } : {}), newMeta != null ? newMeta : {}), {}, {\n              filter: filter\n            }) : undefined;\n\n            if (realNewMeta) {\n              setAsyncFetchMeta(realNewMeta);\n            }\n\n            return _context.abrupt(\"return\", newValues);\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n\n    return function fetchListValues() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var loadListValues = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var filter,\n          isLoadMore,\n          list,\n          _args2 = arguments;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            filter = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : null;\n            isLoadMore = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : false;\n            setLoadingCnt(function (x) {\n              return x + 1;\n            });\n            setIsLoadingMore(isLoadMore);\n            _context2.next = 6;\n            return fetchListValues(filter, isLoadMore);\n\n          case 6:\n            list = _context2.sent;\n\n            if (componentIsMounted.current) {\n              _context2.next = 9;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 9:\n            if (list != null) {\n              // tip: null can be used for reject (eg, if user don't want to filter by input)\n              setAsyncListValues(list);\n            }\n\n            setLoadingCnt(function (x) {\n              return x - 1;\n            });\n            setIsLoadingMore(false);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n\n    return function loadListValues() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var loadListValuesDebounced = React.useCallback(debounce(loadListValues, debounceTimeout), []); // Unmount\n\n  React.useEffect(function () {\n    return function () {\n      componentIsMounted.current = false;\n    };\n  }, []); // Initial loading\n\n  React.useEffect(function () {\n    if (canInitialLoad && loadingCnt == 0 && asyncFectchCnt.current == 0) {\n      _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return loadListValues();\n\n            case 2:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }))();\n    }\n  }, [canInitialLoad]); // Event handlers\n\n  var onOpen = function onOpen() {\n    setOpen(true);\n  };\n\n  var onClose = function onClose(_e) {\n    if (isSelectedLoadMore.current) {\n      isSelectedLoadMore.current = false;\n\n      if (multiple) {\n        setOpen(false);\n      }\n    } else {\n      setOpen(false);\n    }\n  };\n\n  var onDropdownVisibleChange = function onDropdownVisibleChange(open) {\n    if (open) {\n      onOpen();\n    } else {\n      onClose();\n    }\n  };\n\n  var isSpecialValue = function isSpecialValue(option) {\n    var specialValue = (option === null || option === void 0 ? void 0 : option.specialValue) || (option === null || option === void 0 ? void 0 : option.value);\n    return knownSpecialValues.includes(specialValue);\n  };\n\n  var onChange = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_e, option) {\n      var specialValue, _options, newSelectedListValues, newSelectedValues, v;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) switch (_context4.prev = _context4.next) {\n          case 0:\n            specialValue = (option === null || option === void 0 ? void 0 : option.specialValue) || (option === null || option === void 0 ? void 0 : option.value) || multiple && option.map(function (opt) {\n              return (opt === null || opt === void 0 ? void 0 : opt.specialValue) || (opt === null || opt === void 0 ? void 0 : opt.value);\n            }).find(function (v) {\n              return !!v;\n            });\n\n            if (!(specialValue == \"LOAD_MORE\")) {\n              _context4.next = 7;\n              break;\n            }\n\n            isSelectedLoadMore.current = true;\n            _context4.next = 5;\n            return loadListValues(inputValue, true);\n\n          case 5:\n            _context4.next = 8;\n            break;\n\n          case 7:\n            if (specialValue == \"LOADING_MORE\") {\n              isSelectedLoadMore.current = true;\n            } else {\n              if (multiple) {\n                _options = option;\n                newSelectedListValues = _options.map(function (o, i) {\n                  var item = o.value != null ? o : getListValue(o, listValues); // AntDesign puts array of labels in `_e` (`option` is array of objects, but custom option is always `{}`)\n                  // MUI puts array of labels in `option`\n\n                  var customItem = allowCustomValues && !item ? Array.isArray(_e) ? _e[i] : o : null;\n                  return item || customItem;\n                });\n                newSelectedValues = newSelectedListValues.filter(function (o) {\n                  return o !== undefined;\n                }).map(function (o) {\n                  return o.value !== undefined ? o.value : o;\n                });\n                if (!newSelectedValues.length) newSelectedValues = undefined; //not allow []\n\n                setValue(newSelectedValues, newSelectedListValues);\n              } else {\n                v = option == null ? undefined : option.value;\n                setValue(v, [option]);\n              }\n            }\n\n          case 8:\n          case \"end\":\n            return _context4.stop();\n        }\n      }, _callee4);\n    }));\n\n    return function onChange(_x, _x2) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  var onInputChange = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_e, newInputValue) {\n      var val, canSearchAsync;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) switch (_context5.prev = _context5.next) {\n          case 0:\n            val = newInputValue; //const isTypeToSearch = e.type == 'change';\n\n            if (!(val === loadMoreTitle || val === loadingMoreTitle)) {\n              _context5.next = 3;\n              break;\n            }\n\n            return _context5.abrupt(\"return\");\n\n          case 3:\n            setInputValue(val);\n\n            if (allowCustomValues) {\n              if (multiple) {//todo\n              } else {\n                setValue(val, [val]);\n              }\n            }\n\n            canSearchAsync = useAsyncSearch && (forceAsyncSearch ? !!val : true);\n\n            if (!canSearchAsync) {\n              _context5.next = 11;\n              break;\n            }\n\n            _context5.next = 9;\n            return loadListValuesDebounced(val);\n\n          case 9:\n            _context5.next = 12;\n            break;\n\n          case 11:\n            if (useAsyncSearch && forceAsyncSearch) {\n              setAsyncListValues([]);\n            }\n\n          case 12:\n          case \"end\":\n            return _context5.stop();\n        }\n      }, _callee5);\n    }));\n\n    return function onInputChange(_x3, _x4) {\n      return _ref8.apply(this, arguments);\n    };\n  }(); // to keep compatibility with antD\n\n\n  var onSearch = /*#__PURE__*/function () {\n    var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(newInputValue) {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) switch (_context6.prev = _context6.next) {\n          case 0:\n            if (!(newInputValue === \"\" && !open)) {\n              _context6.next = 2;\n              break;\n            }\n\n            return _context6.abrupt(\"return\");\n\n          case 2:\n            _context6.next = 4;\n            return onInputChange(null, newInputValue);\n\n          case 4:\n          case \"end\":\n            return _context6.stop();\n        }\n      }, _callee6);\n    }));\n\n    return function onSearch(_x5) {\n      return _ref9.apply(this, arguments);\n    };\n  }(); // Options\n\n\n  var extendOptions = function extendOptions(options) {\n    var filtered = _toConsumableArray(options);\n\n    if (useLoadMore) {\n      if (canShowLoadMore) {\n        filtered.push({\n          specialValue: \"LOAD_MORE\",\n          title: loadMoreTitle\n        });\n      } else if (isLoadingMore) {\n        filtered.push({\n          specialValue: \"LOADING_MORE\",\n          title: loadingMoreTitle,\n          disabled: true\n        });\n      }\n    }\n\n    return filtered;\n  };\n\n  var getOptionSelected = function getOptionSelected(option, valueOrOption) {\n    if (valueOrOption == null) return null;\n    var selectedValue = valueOrOption.value != undefined ? valueOrOption.value : valueOrOption;\n    return option.value === selectedValue;\n  };\n\n  var getOptionDisabled = function getOptionDisabled(valueOrOption) {\n    return valueOrOption && valueOrOption.disabled;\n  };\n\n  var getOptionLabel = function getOptionLabel(valueOrOption) {\n    if (valueOrOption == null) return null;\n    var option = valueOrOption.value != undefined ? valueOrOption : listValueToOption(getListValue(valueOrOption, listValues));\n\n    if (!option && valueOrOption.specialValue) {\n      // special last 'Load more...' item\n      return valueOrOption.title;\n    }\n\n    if (!option && allowCustomValues) {\n      // there is just string value, it's not item from list\n      return valueOrOption;\n    }\n\n    if (!option) {\n      // weird\n      return valueOrOption;\n    }\n\n    return option.title;\n  };\n\n  return {\n    options: options,\n    listValues: listValues,\n    hasValue: hasValue,\n    open: open,\n    onOpen: onOpen,\n    onClose: onClose,\n    onDropdownVisibleChange: onDropdownVisibleChange,\n    onChange: onChange,\n    inputValue: inputValue,\n    onInputChange: onInputChange,\n    onSearch: onSearch,\n    canShowLoadMore: canShowLoadMore,\n    isInitialLoading: isInitialLoading,\n    isLoading: isLoading,\n    isLoadingMore: isLoadingMore,\n    isSpecialValue: isSpecialValue,\n    extendOptions: extendOptions,\n    getOptionSelected: getOptionSelected,\n    getOptionDisabled: getOptionDisabled,\n    getOptionLabel: getOptionLabel,\n    // unused\n    //selectedListValue,\n    //selectedOption,\n    aPlaceholder: aPlaceholder\n  };\n};\n\nexport default useListValuesAutocomplete;","map":{"version":3,"sources":["D:/LIMSWFH/LIMSPOSTGRESQL/QuaLISWeb/node_modules/@react-awesome-query-builder/ui/esm/hooks/useListValuesAutocomplete.js"],"names":["_toConsumableArray","_defineProperty","_asyncToGenerator","_slicedToArray","_regeneratorRuntime","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","React","Utils","debounce","_Utils$Autocomplete","Autocomplete","mergeListValues","listValueToOption","getListValue","_Utils$ListUtils","ListUtils","mapListValues","listValuesToArray","useListValuesAutocomplete","_ref","_ref2","asyncFetch","useLoadMore","useAsyncSearch","forceAsyncSearch","selectedAsyncListValues","asyncListValues","staticListValues","listValues","allowCustomValues","selectedValue","value","setValue","placeholder","debounceTimeout","multiple","knownSpecialValues","loadMoreTitle","loadingMoreTitle","aPlaceholder","_React$useState","useState","_React$useState2","open","setOpen","_React$useState3","undefined","_React$useState4","asyncFetchMeta","setAsyncFetchMeta","_React$useState5","_React$useState6","loadingCnt","setLoadingCnt","_React$useState7","_React$useState8","isLoadingMore","setIsLoadingMore","_React$useState9","_React$useState10","inputValue","setInputValue","_React$useState11","_React$useState12","setAsyncListValues","asyncFectchCnt","useRef","componentIsMounted","isSelectedLoadMore","nSelectedAsyncListValues","isLoading","canInitialLoad","isInitialLoading","canLoadMore","hasMore","canShowLoadMore","options","hasValue","fetchListValues","_ref3","mark","_callee","isLoadMore","offset","meta","newAsyncFetchCnt","res","isFetchCancelled","_ref4","values","newMeta","nValues","assumeHasMore","newValues","realNewMeta","_args","wrap","_callee$","_context","prev","next","pageSize","current","sent","abrupt","stop","loadListValues","_ref5","_callee2","list","_args2","_callee2$","_context2","x","loadListValuesDebounced","useCallback","useEffect","_callee3","_callee3$","_context3","onOpen","onClose","_e","onDropdownVisibleChange","isSpecialValue","option","specialValue","includes","onChange","_ref7","_callee4","_options","newSelectedListValues","newSelectedValues","v","_callee4$","_context4","map","opt","find","o","item","customItem","Array","isArray","_x","_x2","onInputChange","_ref8","_callee5","newInputValue","val","canSearchAsync","_callee5$","_context5","_x3","_x4","onSearch","_ref9","_callee6","_callee6$","_context6","_x5","extendOptions","filtered","title","disabled","getOptionSelected","valueOrOption","getOptionDisabled","getOptionLabel"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport React from \"react\";\nimport { Utils } from \"@react-awesome-query-builder/core\";\nimport debounce from \"lodash/debounce\";\nvar _Utils$Autocomplete = Utils.Autocomplete,\n  mergeListValues = _Utils$Autocomplete.mergeListValues,\n  listValueToOption = _Utils$Autocomplete.listValueToOption,\n  getListValue = _Utils$Autocomplete.getListValue;\nvar _Utils$ListUtils = Utils.ListUtils,\n  mapListValues = _Utils$ListUtils.mapListValues,\n  listValuesToArray = _Utils$ListUtils.listValuesToArray;\nvar useListValuesAutocomplete = function useListValuesAutocomplete(_ref, _ref2) {\n  var asyncFetch = _ref.asyncFetch,\n    useLoadMore = _ref.useLoadMore,\n    useAsyncSearch = _ref.useAsyncSearch,\n    forceAsyncSearch = _ref.forceAsyncSearch,\n    selectedAsyncListValues = _ref.asyncListValues,\n    staticListValues = _ref.listValues,\n    allowCustomValues = _ref.allowCustomValues,\n    selectedValue = _ref.value,\n    setValue = _ref.setValue,\n    placeholder = _ref.placeholder;\n  var debounceTimeout = _ref2.debounceTimeout,\n    multiple = _ref2.multiple;\n  var knownSpecialValues = [\"LOAD_MORE\", \"LOADING_MORE\"];\n  var loadMoreTitle = \"Load more...\";\n  var loadingMoreTitle = \"Loading more...\";\n  var aPlaceholder = forceAsyncSearch ? \"Type to search\" : placeholder;\n\n  // state\n  var _React$useState = React.useState(false),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    open = _React$useState2[0],\n    setOpen = _React$useState2[1];\n  var _React$useState3 = React.useState(undefined),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    asyncFetchMeta = _React$useState4[0],\n    setAsyncFetchMeta = _React$useState4[1];\n  var _React$useState5 = React.useState(0),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    loadingCnt = _React$useState6[0],\n    setLoadingCnt = _React$useState6[1];\n  var _React$useState7 = React.useState(false),\n    _React$useState8 = _slicedToArray(_React$useState7, 2),\n    isLoadingMore = _React$useState8[0],\n    setIsLoadingMore = _React$useState8[1];\n  var _React$useState9 = React.useState(\"\"),\n    _React$useState10 = _slicedToArray(_React$useState9, 2),\n    inputValue = _React$useState10[0],\n    setInputValue = _React$useState10[1];\n  var _React$useState11 = React.useState(undefined),\n    _React$useState12 = _slicedToArray(_React$useState11, 2),\n    asyncListValues = _React$useState12[0],\n    setAsyncListValues = _React$useState12[1];\n\n  // ref\n  var asyncFectchCnt = React.useRef(0);\n  var componentIsMounted = React.useRef(true);\n  var isSelectedLoadMore = React.useRef(false);\n\n  // compute\n  var nSelectedAsyncListValues = listValuesToArray(selectedAsyncListValues);\n  var listValues = asyncFetch ? !allowCustomValues ? mergeListValues(asyncListValues, nSelectedAsyncListValues, true) : asyncListValues : staticListValues;\n  //const isDirtyInitialListValues = asyncListValues == undefined && selectedAsyncListValues && selectedAsyncListValues.length && typeof selectedAsyncListValues[0] != \"object\";\n  var isLoading = loadingCnt > 0;\n  var canInitialLoad = open && asyncFetch && asyncListValues === undefined && (forceAsyncSearch ? inputValue : true);\n  var isInitialLoading = canInitialLoad && isLoading;\n  var canLoadMore = !isInitialLoading && listValues && listValues.length > 0 && asyncFetchMeta && asyncFetchMeta.hasMore && (asyncFetchMeta.filter || \"\") === inputValue;\n  var canShowLoadMore = !isLoading && canLoadMore;\n  var options = mapListValues(listValues, listValueToOption);\n  var hasValue = selectedValue != null;\n  // const selectedListValue = hasValue ? getListValue(selectedValue, listValues) : null;\n  // const selectedOption = listValueToOption(selectedListValue);\n\n  // fetch\n  var fetchListValues = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var filter,\n        isLoadMore,\n        offset,\n        meta,\n        newAsyncFetchCnt,\n        res,\n        isFetchCancelled,\n        _ref4,\n        values,\n        hasMore,\n        newMeta,\n        nValues,\n        assumeHasMore,\n        newValues,\n        realNewMeta,\n        _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            filter = _args.length > 0 && _args[0] !== undefined ? _args[0] : null;\n            isLoadMore = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n            // clear obsolete meta\n            if (!isLoadMore && asyncFetchMeta) {\n              setAsyncFetchMeta(undefined);\n            }\n            offset = isLoadMore && asyncListValues ? asyncListValues.length : 0;\n            meta = isLoadMore && asyncFetchMeta || !useLoadMore && {\n              pageSize: 0\n            };\n            newAsyncFetchCnt = ++asyncFectchCnt.current;\n            _context.next = 8;\n            return asyncFetch(filter, offset, meta);\n          case 8:\n            res = _context.sent;\n            isFetchCancelled = asyncFectchCnt.current != newAsyncFetchCnt;\n            if (!(isFetchCancelled || !componentIsMounted.current)) {\n              _context.next = 12;\n              break;\n            }\n            return _context.abrupt(\"return\", null);\n          case 12:\n            _ref4 = res && res.values ? res : {\n              values: res\n            }, values = _ref4.values, hasMore = _ref4.hasMore, newMeta = _ref4.meta;\n            nValues = listValuesToArray(values);\n            if (isLoadMore) {\n              newValues = mergeListValues(asyncListValues, nValues, false);\n              assumeHasMore = newValues.length > asyncListValues.length;\n            } else {\n              newValues = nValues;\n              if (useLoadMore) {\n                assumeHasMore = newValues.length > 0;\n              }\n            }\n\n            // save new meta\n            realNewMeta = hasMore != null || newMeta != null || assumeHasMore != null ? _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, assumeHasMore != null ? {\n              hasMore: assumeHasMore\n            } : {}), hasMore != null ? {\n              hasMore: hasMore\n            } : {}), newMeta != null ? newMeta : {}), {}, {\n              filter: filter\n            }) : undefined;\n            if (realNewMeta) {\n              setAsyncFetchMeta(realNewMeta);\n            }\n            return _context.abrupt(\"return\", newValues);\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n    return function fetchListValues() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var loadListValues = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var filter,\n        isLoadMore,\n        list,\n        _args2 = arguments;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            filter = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : null;\n            isLoadMore = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : false;\n            setLoadingCnt(function (x) {\n              return x + 1;\n            });\n            setIsLoadingMore(isLoadMore);\n            _context2.next = 6;\n            return fetchListValues(filter, isLoadMore);\n          case 6:\n            list = _context2.sent;\n            if (componentIsMounted.current) {\n              _context2.next = 9;\n              break;\n            }\n            return _context2.abrupt(\"return\");\n          case 9:\n            if (list != null) {\n              // tip: null can be used for reject (eg, if user don't want to filter by input)\n              setAsyncListValues(list);\n            }\n            setLoadingCnt(function (x) {\n              return x - 1;\n            });\n            setIsLoadingMore(false);\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function loadListValues() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var loadListValuesDebounced = React.useCallback(debounce(loadListValues, debounceTimeout), []);\n\n  // Unmount\n  React.useEffect(function () {\n    return function () {\n      componentIsMounted.current = false;\n    };\n  }, []);\n\n  // Initial loading\n  React.useEffect(function () {\n    if (canInitialLoad && loadingCnt == 0 && asyncFectchCnt.current == 0) {\n      _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return loadListValues();\n            case 2:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }))();\n    }\n  }, [canInitialLoad]);\n\n  // Event handlers\n  var onOpen = function onOpen() {\n    setOpen(true);\n  };\n  var onClose = function onClose(_e) {\n    if (isSelectedLoadMore.current) {\n      isSelectedLoadMore.current = false;\n      if (multiple) {\n        setOpen(false);\n      }\n    } else {\n      setOpen(false);\n    }\n  };\n  var onDropdownVisibleChange = function onDropdownVisibleChange(open) {\n    if (open) {\n      onOpen();\n    } else {\n      onClose();\n    }\n  };\n  var isSpecialValue = function isSpecialValue(option) {\n    var specialValue = (option === null || option === void 0 ? void 0 : option.specialValue) || (option === null || option === void 0 ? void 0 : option.value);\n    return knownSpecialValues.includes(specialValue);\n  };\n  var onChange = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_e, option) {\n      var specialValue, _options, newSelectedListValues, newSelectedValues, v;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) switch (_context4.prev = _context4.next) {\n          case 0:\n            specialValue = (option === null || option === void 0 ? void 0 : option.specialValue) || (option === null || option === void 0 ? void 0 : option.value) || multiple && option.map(function (opt) {\n              return (opt === null || opt === void 0 ? void 0 : opt.specialValue) || (opt === null || opt === void 0 ? void 0 : opt.value);\n            }).find(function (v) {\n              return !!v;\n            });\n            if (!(specialValue == \"LOAD_MORE\")) {\n              _context4.next = 7;\n              break;\n            }\n            isSelectedLoadMore.current = true;\n            _context4.next = 5;\n            return loadListValues(inputValue, true);\n          case 5:\n            _context4.next = 8;\n            break;\n          case 7:\n            if (specialValue == \"LOADING_MORE\") {\n              isSelectedLoadMore.current = true;\n            } else {\n              if (multiple) {\n                _options = option;\n                newSelectedListValues = _options.map(function (o, i) {\n                  var item = o.value != null ? o : getListValue(o, listValues);\n                  // AntDesign puts array of labels in `_e` (`option` is array of objects, but custom option is always `{}`)\n                  // MUI puts array of labels in `option`\n                  var customItem = allowCustomValues && !item ? Array.isArray(_e) ? _e[i] : o : null;\n                  return item || customItem;\n                });\n                newSelectedValues = newSelectedListValues.filter(function (o) {\n                  return o !== undefined;\n                }).map(function (o) {\n                  return o.value !== undefined ? o.value : o;\n                });\n                if (!newSelectedValues.length) newSelectedValues = undefined; //not allow []\n                setValue(newSelectedValues, newSelectedListValues);\n              } else {\n                v = option == null ? undefined : option.value;\n                setValue(v, [option]);\n              }\n            }\n          case 8:\n          case \"end\":\n            return _context4.stop();\n        }\n      }, _callee4);\n    }));\n    return function onChange(_x, _x2) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  var onInputChange = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_e, newInputValue) {\n      var val, canSearchAsync;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) switch (_context5.prev = _context5.next) {\n          case 0:\n            val = newInputValue; //const isTypeToSearch = e.type == 'change';\n            if (!(val === loadMoreTitle || val === loadingMoreTitle)) {\n              _context5.next = 3;\n              break;\n            }\n            return _context5.abrupt(\"return\");\n          case 3:\n            setInputValue(val);\n            if (allowCustomValues) {\n              if (multiple) {\n                //todo\n              } else {\n                setValue(val, [val]);\n              }\n            }\n            canSearchAsync = useAsyncSearch && (forceAsyncSearch ? !!val : true);\n            if (!canSearchAsync) {\n              _context5.next = 11;\n              break;\n            }\n            _context5.next = 9;\n            return loadListValuesDebounced(val);\n          case 9:\n            _context5.next = 12;\n            break;\n          case 11:\n            if (useAsyncSearch && forceAsyncSearch) {\n              setAsyncListValues([]);\n            }\n          case 12:\n          case \"end\":\n            return _context5.stop();\n        }\n      }, _callee5);\n    }));\n    return function onInputChange(_x3, _x4) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n\n  // to keep compatibility with antD\n  var onSearch = /*#__PURE__*/function () {\n    var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(newInputValue) {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) switch (_context6.prev = _context6.next) {\n          case 0:\n            if (!(newInputValue === \"\" && !open)) {\n              _context6.next = 2;\n              break;\n            }\n            return _context6.abrupt(\"return\");\n          case 2:\n            _context6.next = 4;\n            return onInputChange(null, newInputValue);\n          case 4:\n          case \"end\":\n            return _context6.stop();\n        }\n      }, _callee6);\n    }));\n    return function onSearch(_x5) {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n\n  // Options\n  var extendOptions = function extendOptions(options) {\n    var filtered = _toConsumableArray(options);\n    if (useLoadMore) {\n      if (canShowLoadMore) {\n        filtered.push({\n          specialValue: \"LOAD_MORE\",\n          title: loadMoreTitle\n        });\n      } else if (isLoadingMore) {\n        filtered.push({\n          specialValue: \"LOADING_MORE\",\n          title: loadingMoreTitle,\n          disabled: true\n        });\n      }\n    }\n    return filtered;\n  };\n  var getOptionSelected = function getOptionSelected(option, valueOrOption) {\n    if (valueOrOption == null) return null;\n    var selectedValue = valueOrOption.value != undefined ? valueOrOption.value : valueOrOption;\n    return option.value === selectedValue;\n  };\n  var getOptionDisabled = function getOptionDisabled(valueOrOption) {\n    return valueOrOption && valueOrOption.disabled;\n  };\n  var getOptionLabel = function getOptionLabel(valueOrOption) {\n    if (valueOrOption == null) return null;\n    var option = valueOrOption.value != undefined ? valueOrOption : listValueToOption(getListValue(valueOrOption, listValues));\n    if (!option && valueOrOption.specialValue) {\n      // special last 'Load more...' item\n      return valueOrOption.title;\n    }\n    if (!option && allowCustomValues) {\n      // there is just string value, it's not item from list\n      return valueOrOption;\n    }\n    if (!option) {\n      // weird\n      return valueOrOption;\n    }\n    return option.title;\n  };\n  return {\n    options: options,\n    listValues: listValues,\n    hasValue: hasValue,\n    open: open,\n    onOpen: onOpen,\n    onClose: onClose,\n    onDropdownVisibleChange: onDropdownVisibleChange,\n    onChange: onChange,\n    inputValue: inputValue,\n    onInputChange: onInputChange,\n    onSearch: onSearch,\n    canShowLoadMore: canShowLoadMore,\n    isInitialLoading: isInitialLoading,\n    isLoading: isLoading,\n    isLoadingMore: isLoadingMore,\n    isSpecialValue: isSpecialValue,\n    extendOptions: extendOptions,\n    getOptionSelected: getOptionSelected,\n    getOptionDisabled: getOptionDisabled,\n    getOptionLabel: getOptionLabel,\n    // unused\n    //selectedListValue,\n    //selectedOption,\n    aPlaceholder: aPlaceholder\n  };\n};\nexport default useListValuesAutocomplete;"]},"metadata":{},"sourceType":"module"}